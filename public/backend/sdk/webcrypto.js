/*! For license information please see webcrypto.js.LICENSE.txt */
var _excluded=["name","optional","primitiveSchema"],_excluded2=["value"],_excluded3=["isHexOnly"],_excluded4=["value","isIndefiniteForm"],_excluded5=["value"],_excluded6=["isConstructed"],_excluded7=["idBlock","lenBlock"],_excluded8=["unusedBits","isConstructed"],_excluded9=["idBlock","lenBlock"],_excluded10=["value"],_excluded11=["valueDec","isFirstSid"],_excluded12=["value"],_excluded13=["valueDec"],_excluded14=["value"],_excluded15=["value","valueDate"],_excluded16=["value"],_excluded17=["value","local"];function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,e)})(e)}function _construct(e,t,r){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf(i,r.prototype),i}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _get5(){return(_get5="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}}).apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof h?t:h,a=Object.create(i.prototype),o=new C(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=k(o,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,o),a}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function h(){}function p(){}function f(){}var y={};s(y,i,(function(){return this}));var v=Object.getPrototypeOf,d=v&&v(v(x([])));d&&d!==t&&r.call(d,i)&&(y=d);var g=f.prototype=h.prototype=Object.create(y);function m(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(i,a,o,s){var u=c(e[i],e,a);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==_typeof(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(h).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function k(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function b(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function x(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return p.prototype=f,s(g,"constructor",f),s(f,"constructor",p),p.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},m(_.prototype),s(_.prototype,a,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},m(g),s(g,o,"Generator"),s(g,i,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=x,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),b(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;b(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:x(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function asyncGeneratorStep(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var WebcryptoSocket=function(e,t,r,n){"use strict";function i(e){return e&&"object"===_typeof(e)&&"default"in e?e:{default:e}}var a=i(r),o=i(n),s=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isArrayBuffer",value:function(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}},{key:"toArrayBuffer",value:function(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e).slice().buffer}},{key:"toUint8Array",value:function(e){return this.toView(e,Uint8Array)}},{key:"toView",value:function(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}},{key:"isBufferSource",value:function(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}},{key:"isArrayBufferView",value:function(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}},{key:"isEqual",value:function(t,r){var n=e.toUint8Array(t),i=e.toUint8Array(r);if(n.length!==i.byteLength)return!1;for(var a=0;a<n.length;a++)if(n[a]!==i[a])return!1;return!0}},{key:"concat",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Array.isArray(t[0])){var n,i=t[0],a=0,o=_createForOfIteratorHelper(i);try{for(o.s();!(n=o.n()).done;)a+=n.value.byteLength}catch(e){o.e(e)}finally{o.f()}var s,u=new Uint8Array(a),c=0,l=_createForOfIteratorHelper(i);try{for(l.s();!(s=l.n()).done;){var h=s.value,p=this.toUint8Array(h);u.set(p,c),c+=p.length}}catch(e){l.e(e)}finally{l.f()}return t[1]?this.toView(u,t[1]):u.buffer}return this.concat(t)}}]),e}(),u=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fromString",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r.buffer}},{key:"toString",value:function(e){for(var t=s.toUint8Array(e),r="",n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return decodeURIComponent(escape(r))}}]),e}(),c=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"toString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=s.toArrayBuffer(e),n=new DataView(r),i="",a=0;a<r.byteLength;a+=2){var o=n.getUint16(a,t);i+=String.fromCharCode(o)}return i}},{key:"fromString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new ArrayBuffer(2*e.length),n=new DataView(r),i=0;i<e.length;i++)n.setUint16(2*i,e.charCodeAt(i),t);return r}}]),e}(),l=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isHex",value:function(e){return"string"==typeof e&&/^[a-z0-9]+$/i.test(e)}},{key:"isBase64",value:function(e){return"string"==typeof e&&/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{key:"isBase64Url",value:function(e){return"string"==typeof e&&/^[a-zA-Z0-9-_]+$/i.test(e)}},{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=s.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return c.toString(r,!0);case"utf16":case"utf16be":return c.toString(r);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return c.fromString(e,!0);case"utf16":case"utf16be":return c.fromString(e);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"ToBase64",value:function(e){var t=s.toUint8Array(e);if("undefined"!=typeof btoa){var r=this.ToString(t,"binary");return btoa(r)}return Buffer.from(t).toString("base64")}},{key:"FromBase64",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64(r))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(r)):new Uint8Array(Buffer.from(r,"base64")).buffer}},{key:"FromBase64Url",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64Url(r))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(r.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.FromBinary(t);case"utf8":return u.fromString(t);case"utf16":case"utf16be":return c.fromString(t);case"utf16le":case"usc2":return c.fromString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"ToUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.ToBinary(t);case"utf8":return u.toString(t);case"utf16":case"utf16be":return c.toString(t);case"utf16le":case"usc2":return c.toString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}},{key:"ToBinary",value:function(e){for(var t=s.toUint8Array(e),r="",n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return r}},{key:"ToHex",value:function(e){for(var t=s.toUint8Array(e),r=[],n=t.length,i=0;i<n;i++){var a=t[i].toString(16).padStart(2,"0");r.push(a)}return r.join("")}},{key:"FromHex",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isHex(r))throw new TypeError("Argument 'hexString' is not HEX encoded");r.length%2&&(r="0".concat(r));for(var n=new Uint8Array(r.length/2),i=0;i<r.length;i+=2){var a=r.slice(i,i+2);n[i/2]=parseInt(a,16)}return n.buffer}},{key:"ToUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c.toString(e,t)}},{key:"FromUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c.fromString(e,t)}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}},{key:"formatString",value:function(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}]),e}();function h(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var i=arguments[0],a=1;a<arguments.length;a++){var o=arguments[a];for(var s in o)i[s]=o[s]}return i}function p(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.map((function(e){return e.byteLength})).reduce((function(e,t){return e+t})),i=new Uint8Array(n),a=0;return t.map((function(e){return new Uint8Array(e)})).forEach((function(e){var t,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;i[a++]=n}}catch(e){r.e(e)}finally{r.f()}})),i.buffer}function f(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),i=0;i<e.byteLength;i++)if(r[i]!==n[i])return!1;return!0}function y(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o}l.DEFAULT_UTF8_ENCODING="utf8";var v=function(){function e(){_classCallCheck(this,e)}var t,r;return _createClass(e,null,[{key:"set",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(t));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"get",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(t).buffer);case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();function d(e){return function(r){var n=r;n.localName=e.name||n.name||n.toString().match(/^function\s*([^\s(]+)/)[1],n.items=n.items||{},n.target=r,n.items=h({},n.items);var i=new t.Type(n.localName);for(var a in n.items){var o=n.items[a],s=void 0;o.repeated?s="repeated":o.required&&(s="required"),i.add(new t.Field(o.name,o.id,o.type,s))}n.protobuf=i}}function g(e){return function(t,r){var n=t.constructor,i=r;n.items=n.items||{},n.target!==n&&(n.items=h({},n.items),n.target=n),n.items[i]={id:e.id,type:e.type||"bytes",defaultValue:e.defaultValue,converter:e.converter||null,parser:e.parser||null},e.name=e.name||i,n.items[i].name=e.name,n.items[i].required=e.required||!1,n.items[i].repeated=e.repeated||!1,function(e,t,r){var n="_".concat(t),i={set:function(e){this[n]!==e&&(this.raw=null,this[n]=e)},get:function(){if(void 0===this[n]){var e=r.defaultValue;r.parser&&!r.repeated&&(e=new r.parser),this[n]=e}return this[n]},enumerable:!0};Object.defineProperty(e,n,{writable:!0,enumerable:!1}),Object.defineProperty(e,t,i)}(t,i,n.items[i])}}var m=function(){function e(){_classCallCheck(this,e)}var t,r,n,i,a;return _createClass(e,[{key:"isEmpty",value:function(){return void 0===this.raw}},{key:"hasChanged",value:function(){if(null===this.raw)return!0;var e=this.constructor,t=this;for(var r in e.items){var n=e.items[r];if(n.repeated){if(n.parser)return t[r].some((function(e){return e.hasChanged()}))}else if(n.parser&&t[r]&&t[r].hasChanged())return!0}return!1}},{key:"importProto",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function t(r){var n,i,a,o,s,u,c,l,h,p;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.constructor,i=this,!(r instanceof e)){t.next=8;break}return t.next=5,r.exportProto();case 5:o=t.sent,t.next=9;break;case 8:o=r;case 9:t.prev=9,a=n.protobuf.decode(new Uint8Array(o)),t.next=16;break;case 13:throw t.prev=13,t.t0=t.catch(9),new Error("Error: Cannot decode message for ".concat(n.localName,".\n$ProtobufError: ").concat(t.t0.message));case 16:t.t1=_regeneratorRuntime().keys(n.items);case 17:if((t.t2=t.t1()).done){t.next=52;break}s=t.t2.value,u=n.items[s],c=a[u.name],ArrayBuffer.isView(c)&&(c=new Uint8Array(c)),Array.isArray(c)||(u.repeated?i[s]=c=[]:c=[c]),u.repeated&&!i[s]&&(i[s]=[]),l=_createForOfIteratorHelper(c),t.prev=25,l.s();case 27:if((h=l.n()).done){t.next=42;break}if(p=h.value,!u.repeated){t.next=37;break}return t.t3=i[s],t.next=33,this.importItem(u,p);case 33:t.t4=t.sent,t.t3.push.call(t.t3,t.t4),t.next=40;break;case 37:return t.next=39,this.importItem(u,p);case 39:i[s]=t.sent;case 40:t.next=27;break;case 42:t.next=47;break;case 44:t.prev=44,t.t5=t.catch(25),l.e(t.t5);case 47:return t.prev=47,l.f(),t.finish(47);case 50:t.next=17;break;case 52:this.raw=o;case 53:case"end":return t.stop()}}),t,this,[[9,13],[25,44,47,50]])}))),function(e){return a.apply(this,arguments)})},{key:"exportProto",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,s,u,c,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasChanged()){e.next=2;break}return e.abrupt("return",this.raw);case 2:t=this.constructor,r=this,n={},e.t0=_regeneratorRuntime().keys(t.items);case 6:if((e.t1=e.t0()).done){e.next=32;break}i=e.t1.value,a=t.items[i],o=r[i],Array.isArray(o)||(o=void 0===o?[]:[o]),s=_createForOfIteratorHelper(o),e.prev=12,s.s();case 14:if((u=s.n()).done){e.next=22;break}return c=u.value,e.next=18,this.exportItem(a,c);case 18:l=e.sent,a.repeated?(n[a.name]||(n[a.name]=[]),n[a.name].push(l)):n[a.name]=l;case 20:e.next=14;break;case 22:e.next=27;break;case 24:e.prev=24,e.t2=e.catch(12),s.e(e.t2);case 27:return e.prev=27,s.f(),e.finish(27);case 30:e.next=6;break;case 32:return this.raw=new Uint8Array(t.protobuf.encode(n).finish()).buffer,e.abrupt("return",this.raw);case 34:case"end":return e.stop()}}),e,this,[[12,24,27,30]])}))),function(){return i.apply(this,arguments)})},{key:"exportItem",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,a,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.constructor,!t.parser){e.next=11;break}return a=r,e.next=5,a.exportProto();case 5:if(o=e.sent,!t.required||o){e.next=8;break}throw new Error("Error: Paramter '".concat(t.name,"' is required in '").concat(n.localName,"' protobuf message."));case 8:o&&(i=new Uint8Array(o)),e.next=22;break;case 11:if(!t.required||void 0!==r){e.next=13;break}throw new Error("Error: Paramter '".concat(t.name,"' is required in '").concat(n.localName,"' protobuf message."));case 13:if(!t.converter){e.next=20;break}if(void 0===r){e.next=18;break}return e.next=17,t.converter.set(r);case 17:i=e.sent;case 18:e.next=22;break;case 20:r instanceof ArrayBuffer&&(r=new Uint8Array(r)),i=r;case 22:return e.abrupt("return",i);case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"importItem",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.constructor,!t.parser){e.next=13;break}if(a=t.parser,!r||!r.byteLength){e.next=9;break}return e.next=6,a.importProto(new Uint8Array(r).buffer);case 6:i=e.sent,e.next=11;break;case 9:if(!t.required){e.next=11;break}throw new Error("Error: Parameter '".concat(t.name,"' is required in '").concat(n.localName,"' protobuf message."));case 11:e.next=25;break;case 13:if(!t.converter){e.next=24;break}if(!r||!r.byteLength){e.next=20;break}return e.next=17,t.converter.get(r);case 17:i=e.sent,e.next=22;break;case 20:if(!t.required){e.next=22;break}throw new Error("Error: Parameter '".concat(t.name,"' is required in '").concat(n.localName,"' protobuf message."));case 22:e.next=25;break;case 24:i=r;case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})}],[{key:"importProto",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new this,e.next=3,r.importProto(t);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function _(){}function k(){k.init.call(this)}function w(e){return void 0===e._maxListeners?k.defaultMaxListeners:e._maxListeners}function b(e,t,r,n){var i,a,o,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),o=a[t]):(a=e._events=new _,e._eventsCount=0),o){if("function"==typeof o?o=a[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),!o.warned&&(i=w(e))&&i>0&&o.length>i){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else o=a[t]=r,++e._eventsCount;return e}function C(e,t,r){var n=!1;function i(){e.removeListener(t,i),n||(n=!0,r.apply(e,arguments))}return i.listener=r,i}function x(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function S(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}_.prototype=Object.create(null),k.EventEmitter=k,k.usingDomains=!1,k.prototype.domain=void 0,k.prototype._events=void 0,k.prototype._maxListeners=void 0,k.defaultMaxListeners=10,k.init=function(){this.domain=null,k.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new _,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},k.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},k.prototype.getMaxListeners=function(){return w(this)},k.prototype.emit=function(e){var t,r,n,i,a,o,s,u="error"===e;if(o=this._events)u=u&&null==o.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(r=o[e]))return!1;var l="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,i=S(e,n),a=0;a<n;++a)i[a].call(r)}(r,l,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,a=S(e,i),o=0;o<i;++o)a[o].call(r,n)}(r,l,this,arguments[1]);break;case 3:!function(e,t,r,n,i){if(t)e.call(r,n,i);else for(var a=e.length,o=S(e,a),s=0;s<a;++s)o[s].call(r,n,i)}(r,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,i,a){if(t)e.call(r,n,i,a);else for(var o=e.length,s=S(e,o),u=0;u<o;++u)s[u].call(r,n,i,a)}(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),a=1;a<n;a++)i[a-1]=arguments[a];!function(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,a=S(e,i),o=0;o<i;++o)a[o].apply(r,n)}(r,l,this,i)}return!0},k.prototype.addListener=function(e,t){return b(this,e,t,!1)},k.prototype.on=k.prototype.addListener,k.prototype.prependListener=function(e,t){return b(this,e,t,!0)},k.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,C(this,e,t)),this},k.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,C(this,e,t)),this},k.prototype.removeListener=function(e,t){var r,n,i,a,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new _:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new _,this;delete n[e]}else!function(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}(r,i);n.removeListener&&this.emit("removeListener",e,o||t)}return this},k.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new _,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new _:delete r[e]),this;if(0===arguments.length){for(var n,i=Object.keys(r),a=0;a<i.length;++a)"removeListener"!==(n=i[a])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new _,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},k.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},k.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):x.call(e,t)},k.prototype.listenerCount=x,k.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var E="AES-CBC",A="SHA-256",N="HMAC",I=l.FromBinary("InfoText"),B=l.FromBinary("InfoRatchet"),R=l.FromBinary("InfoMessageKeys"),T=null;function D(){if(!T)throw new Error("WebCrypto engine is empty. Use setEngine to resolve it.");return T}"undefined"!=typeof self&&(T={crypto:self.crypto,name:"WebCrypto"});var O=function(){var e=function(){function e(){_classCallCheck(this,e)}var t,r,n,i;return _createClass(e,null,[{key:"generateKeyPair",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,a,o,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,i="ECDSA"===t?["sign","verify"]:["deriveKey","deriveBits"],e.next=4,D().crypto.subtle.generateKey({name:n,namedCurve:this.NAMED_CURVE},r,i);case 4:return a=e.sent,e.next=7,P.create(a.publicKey);case 7:return o=e.sent,s={privateKey:a.privateKey,publicKey:o},e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"deriveBytes",value:function(e,t){return D().crypto.subtle.deriveBits({name:"ECDH",public:t.key},e,256)}},{key:"verify",value:function(e,t,r){return D().crypto.subtle.verify({name:"ECDSA",hash:this.DIGEST_ALGORITHM},e.key,r,t)}},{key:"sign",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D().crypto.subtle.sign({name:"ECDSA",hash:this.DIGEST_ALGORITHM},t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"ecKeyPairToJson",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.privateKey,e.t1=t.publicKey.key,e.next=4,t.publicKey.thumbprint();case 4:return e.t2=e.sent,e.abrupt("return",{privateKey:e.t0,publicKey:e.t1,thumbprint:e.t2});case 6:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"ecKeyPairFromJson",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.privateKey,e.next=3,P.create(t.publicKey);case 3:return e.t1=e.sent,e.abrupt("return",{privateKey:e.t0,publicKey:e.t1});case 5:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();return e.NAMED_CURVE="P-256",e.DIGEST_ALGORITHM="SHA-512",e}(),K={name:"AES-CBC",length:256},U=function(){function e(){_classCallCheck(this,e)}var t,r;return _createClass(e,null,[{key:"randomBytes",value:function(e){var t=new Uint8Array(e);return D().crypto.getRandomValues(t),t.buffer}},{key:"digest",value:function(e,t){return D().crypto.subtle.digest(e,t)}},{key:"encrypt",value:function(e,t,r){return D().crypto.subtle.encrypt({name:E,iv:new Uint8Array(r)},e,t)}},{key:"decrypt",value:function(e,t,r){return D().crypto.subtle.decrypt({name:E,iv:new Uint8Array(r)},e,t)}},{key:"importHMAC",value:function(e){return D().crypto.subtle.importKey("raw",e,{name:N,hash:{name:A}},!1,["sign","verify"])}},{key:"importAES",value:function(e){return D().crypto.subtle.importKey("raw",e,K,!1,["encrypt","decrypt"])}},{key:"sign",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D().crypto.subtle.sign({name:N,hash:A},t,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"HKDF",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,a,o,s,u,c=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:1,n=c.length>2?c[2]:void 0,i=c.length>3&&void 0!==c[3]?c[3]:new ArrayBuffer(0),n){e.next=7;break}return e.next=6,this.importHMAC(new Uint8Array(32).buffer);case 6:n=e.sent;case 7:return e.next=9,this.sign(n,t);case 9:return a=e.sent,new ArrayBuffer(32+i.byteLength+1),e.next=13,this.importHMAC(a);case 13:o=e.sent,s=[new ArrayBuffer(0)],u=0;case 16:if(!(u<r)){e.next=23;break}return e.next=19,this.sign(o,p(s[u],i,new Uint8Array([u+1]).buffer));case 19:s[u+1]=e.sent;case 20:u++,e.next=16;break;case 23:return e.abrupt("return",s.slice(1));case 24:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),P=function(){function e(){_classCallCheck(this,e)}var t,r,n,i;return _createClass(e,[{key:"serialize",value:function(){return this.serialized}},{key:"thumbprint",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serialize();case 2:return t=e.sent,e.next=5,U.digest("SHA-256",t);case 5:return r=e.sent,e.abrupt("return",l.ToHex(r));case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"isEqual",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function t(r){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&r instanceof e){t.next=2;break}return t.abrupt("return",!1);case 2:return t.abrupt("return",f(this.serialized,r.serialized));case 3:case"end":return t.stop()}}),t,this)}))),function(e){return n.apply(this,arguments)})}],[{key:"create",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,a,o,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new this,"ECDH"===(n=t.algorithm.name.toUpperCase())||"ECDSA"===n){e.next=4;break}throw new Error("Error: Unsupported asymmetric key algorithm.");case 4:if("public"===t.type){e.next=6;break}throw new Error("Error: Expected key type to be public but it was not.");case 6:return r.key=t,e.next=9,D().crypto.subtle.exportKey("jwk",t);case 9:if((i=e.sent).x&&i.y){e.next=12;break}throw new Error("Wrong JWK data for EC public key. Parameters x and y are required.");case 12:return a=l.FromBase64Url(i.x),o=l.FromBase64Url(i.y),s=l.ToBinary(a)+l.ToBinary(o),r.serialized=l.FromBinary(s),e.next=18,r.thumbprint();case 18:return r.id=e.sent,e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"importKey",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function t(r,n){var i,a,o,s,u,c;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=l.ToBase64Url(r.slice(0,32)),a=l.ToBase64Url(r.slice(32)),o={crv:O.NAMED_CURVE,kty:"EC",x:i,y:a},s="ECDSA"===n?["verify"]:[],t.next=6,D().crypto.subtle.importKey("jwk",o,{name:n,namedCurve:O.NAMED_CURVE},!0,s);case 6:return u=t.sent,t.next=9,e.create(u);case 9:return c=t.sent,t.abrupt("return",c);case 11:case"end":return t.stop()}}),t)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),X=function(){function e(t,r,n){_classCallCheck(this,e),this.id=t,this.signingKey=r,this.exchangeKey=n,this.preKeys=[],this.signedPreKeys=[]}var t,r,n,i;return _createClass(e,[{key:"toJSON",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,s,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=[],n=_createForOfIteratorHelper(this.preKeys),e.prev=3,n.s();case 5:if((i=n.n()).done){e.next=14;break}return a=i.value,e.t0=t,e.next=10,O.ecKeyPairToJson(a);case 10:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t2=e.catch(3),n.e(e.t2);case 19:return e.prev=19,n.f(),e.finish(19);case 22:o=_createForOfIteratorHelper(this.signedPreKeys),e.prev=23,o.s();case 25:if((s=o.n()).done){e.next=34;break}return u=s.value,e.t3=r,e.next=30,O.ecKeyPairToJson(u);case 30:e.t4=e.sent,e.t3.push.call(e.t3,e.t4);case 32:e.next=25;break;case 34:e.next=39;break;case 36:e.prev=36,e.t5=e.catch(23),o.e(e.t5);case 39:return e.prev=39,o.f(),e.finish(39);case 42:return e.t6=this.createdAt.toISOString(),e.next=45,O.ecKeyPairToJson(this.exchangeKey);case 45:return e.t7=e.sent,e.t8=this.id,e.t9=t,e.t10=r,e.next=51,O.ecKeyPairToJson(this.signingKey);case 51:return e.t11=e.sent,e.abrupt("return",{createdAt:e.t6,exchangeKey:e.t7,id:e.t8,preKeys:e.t9,signedPreKeys:e.t10,signingKey:e.t11});case 53:case"end":return e.stop()}}),e,this,[[3,16,19,22],[23,36,39,42]])}))),function(){return i.apply(this,arguments)})},{key:"fromJSON",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,a,o,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.id=t.id,e.next=3,O.ecKeyPairFromJson(t.signingKey);case 3:return this.signingKey=e.sent,e.next=6,O.ecKeyPairFromJson(t.exchangeKey);case 6:this.exchangeKey=e.sent,this.preKeys=[],r=_createForOfIteratorHelper(t.preKeys),e.prev=9,r.s();case 11:if((n=r.n()).done){e.next=20;break}return i=n.value,e.t0=this.preKeys,e.next=16,O.ecKeyPairFromJson(i);case 16:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 18:e.next=11;break;case 20:e.next=25;break;case 22:e.prev=22,e.t2=e.catch(9),r.e(e.t2);case 25:return e.prev=25,r.f(),e.finish(25);case 28:this.signedPreKeys=[],a=_createForOfIteratorHelper(t.signedPreKeys),e.prev=30,a.s();case 32:if((o=a.n()).done){e.next=41;break}return s=o.value,e.t3=this.signedPreKeys,e.next=37,O.ecKeyPairFromJson(s);case 37:e.t4=e.sent,e.t3.push.call(e.t3,e.t4);case 39:e.next=32;break;case 41:e.next=46;break;case 43:e.prev=43,e.t5=e.catch(30),a.e(e.t5);case 46:return e.prev=46,a.f(),e.finish(46);case 49:case"end":return e.stop()}}),e,this,[[9,22,25,28],[30,43,46,49]])}))),function(e){return n.apply(this,arguments)})}],[{key:"fromJSON",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.ecKeyPairFromJson(t.signingKey);case 2:return r=e.sent,e.next=5,O.ecKeyPairFromJson(t.exchangeKey);case 5:return n=e.sent,(i=new this(t.id,r,n)).createdAt=new Date(t.createdAt),e.next=10,i.fromJSON(t);case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"create",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function t(r){var n,i,a,o,s,u,c,l,h=arguments;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=h.length>1&&void 0!==h[1]?h[1]:0,i=h.length>2&&void 0!==h[2]?h[2]:0,a=h.length>3&&void 0!==h[3]&&h[3],t.next=5,O.generateKeyPair("ECDSA",a);case 5:return o=t.sent,t.next=8,O.generateKeyPair("ECDH",a);case 8:s=t.sent,(u=new e(r,o,s)).createdAt=new Date,c=0;case 12:if(!(c<i)){t.next=21;break}return t.t0=u.preKeys,t.next=16,O.generateKeyPair("ECDH",a);case 16:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 18:c++,t.next=12;break;case 21:l=0;case 22:if(!(l<n)){t.next=31;break}return t.t2=u.signedPreKeys,t.next=26,O.generateKeyPair("ECDH",a);case 26:t.t3=t.sent,t.t2.push.call(t.t2,t.t3);case 28:l++,t.next=22;break;case 31:return t.abrupt("return",u);case 32:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]),e}(),L=function(){function e(){_classCallCheck(this,e)}var t,r,n;return _createClass(e,[{key:"fill",value:function(e){this.signingKey=e.signingKey,this.exchangeKey=e.exchangeKey,this.signature=e.signature,this.createdAt=e.createdAt}},{key:"verify",value:function(){return O.verify(this.signingKey,this.exchangeKey.serialize(),this.signature)}},{key:"toJSON",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.createdAt.toISOString(),e.next=3,this.exchangeKey.key;case 3:return e.t1=e.sent,e.t2=this.id,e.t3=this.signature,e.next=8,this.signingKey.key;case 8:return e.t4=e.sent,e.next=11,this.signingKey.thumbprint();case 11:return e.t5=e.sent,e.abrupt("return",{createdAt:e.t0,exchangeKey:e.t1,id:e.t2,signature:e.t3,signingKey:e.t4,thumbprint:e.t5});case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"fromJSON",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.id=t.id,this.signature=t.signature,e.next=4,P.create(t.signingKey);case 4:return this.signingKey=e.sent,e.next=7,P.create(t.exchangeKey);case 7:return this.exchangeKey=e.sent,this.createdAt=new Date(t.createdAt),e.next=11,this.verify();case 11:if(e.sent){e.next=14;break}throw new Error("Error: Wrong signature for RemoteIdentity");case 14:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}],[{key:"fill",value:function(t){var r=new e;return r.fill(t),r}},{key:"fromJSON",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new this,e.next=3,r.fromJSON(t);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),j=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(m);return y([g({id:0,type:"uint32",defaultValue:1})],e.prototype,"version",void 0),y([d({name:"Base"})],e)}(),H=function(){function e(){_classCallCheck(this,e)}var t,r;return _createClass(e,null,[{key:"set",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(t.serialize()));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"get",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",P.importKey(t.buffer,"ECDSA"));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),G=function(){function e(){_classCallCheck(this,e)}var t,r;return _createClass(e,null,[{key:"set",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(t.serialize()));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"get",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",P.importKey(t.buffer,"ECDH"));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),V=function(){function e(){_classCallCheck(this,e)}var t,r;return _createClass(e,null,[{key:"set",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(l.FromString(t.toISOString())));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"get",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Date(l.ToString(t)));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),M=function(){var e,t=e=function(t){_inherits(s,t);var r,n,i,a,o=_createSuper(s);function s(){return _classCallCheck(this,s),o.apply(this,arguments)}return _createClass(s,[{key:"sign",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.sign(t,this.exchangeKey.serialize());case 2:this.signature=e.sent;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"verify",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.verify(this.signingKey,this.exchangeKey.serialize(),this.signature);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"fill",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.signingKey=t.signingKey.publicKey,this.exchangeKey=t.exchangeKey.publicKey,this.createdAt=t.createdAt,e.next=5,this.sign(t.signingKey.privateKey);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}],[{key:"fill",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function t(r){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new e,t.next=3,n.fill(r);case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})}]),s}(j);return y([g({id:1,converter:H})],t.prototype,"signingKey",void 0),y([g({id:2,converter:G})],t.prototype,"exchangeKey",void 0),y([g({id:3})],t.prototype,"signature",void 0),y([g({id:4,converter:V})],t.prototype,"createdAt",void 0),e=y([d({name:"Identity"})],t)}(),q=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(j);return y([g({id:1,converter:G,required:!0})],e.prototype,"senderRatchetKey",void 0),y([g({id:2,type:"uint32",required:!0})],e.prototype,"counter",void 0),y([g({id:3,type:"uint32",required:!0})],e.prototype,"previousCounter",void 0),y([g({id:4,converter:v,required:!0})],e.prototype,"cipherText",void 0),y([d({name:"Message"})],e)}(),F=function(){var e=function(e){_inherits(o,e);var t,r,n,i,a=_createSuper(o);function o(){return _classCallCheck(this,o),a.apply(this,arguments)}return _createClass(o,[{key:"sign",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signHMAC(t);case 2:this.signature=e.sent;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"verify",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signHMAC(t);case 2:return r=e.sent,e.abrupt("return",f(r,this.signature));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getSignedRaw",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.receiverKey.serialize(),r=this.senderKey.serialize(),e.next=4,this.message.exportProto();case 4:return n=e.sent,i=p(t,r,n),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"signHMAC",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSignedRaw();case 2:return r=e.sent,e.next=5,U.sign(t,r);case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),o}(j);return y([g({id:1,converter:H,required:!0})],e.prototype,"senderKey",void 0),y([g({id:2,parser:q,required:!0})],e.prototype,"message",void 0),y([g({id:3,required:!0})],e.prototype,"signature",void 0),y([d({name:"MessageSigned"})],e)}(),J=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(j);return y([g({id:1,type:"uint32",required:!0})],e.prototype,"registrationId",void 0),y([g({id:2,type:"uint32"})],e.prototype,"preKeyId",void 0),y([g({id:3,type:"uint32",required:!0})],e.prototype,"preKeySignedId",void 0),y([g({id:4,converter:G,required:!0})],e.prototype,"baseKey",void 0),y([g({id:5,parser:M,required:!0})],e.prototype,"identity",void 0),y([g({id:6,parser:F,required:!0})],e.prototype,"signedMessage",void 0),y([d({name:"PreKeyMessage"})],e)}(),z=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(j);return y([g({id:1,type:"uint32",required:!0})],e.prototype,"id",void 0),y([g({id:2,converter:G,required:!0})],e.prototype,"key",void 0),y([d({name:"PreKey"})],e)}(),W=function(){var e=function(e){_inherits(n,e);var t,r=_createSuper(n);function n(){return _classCallCheck(this,n),r.apply(this,arguments)}return _createClass(n,[{key:"sign",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.sign(t,this.key.serialize());case 2:this.signature=e.sent;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"verify",value:function(e){return O.verify(e,this.key.serialize(),this.signature)}}]),n}(z);return y([g({id:3,converter:v,required:!0})],e.prototype,"signature",void 0),y([d({name:"PreKeySigned"})],e)}(),Y=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(j);return y([g({id:1,type:"uint32",required:!0})],e.prototype,"registrationId",void 0),y([g({id:2,parser:M,required:!0})],e.prototype,"identity",void 0),y([g({id:3,parser:z})],e.prototype,"preKey",void 0),y([g({id:4,parser:W,required:!0})],e.prototype,"preKeySigned",void 0),y([d({name:"PreKeyBundle"})],e)}(),Z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;_classCallCheck(this,e),this.items=[],this.maxSize=t}var t,r;return _createClass(e,[{key:"length",get:function(){return this.items.length}},{key:"latest",get:function(){return this.items[this.length-1]}},{key:"push",value:function(e){this.length===this.maxSize&&(this.items=this.items.slice(1)),this.items.push(e)}},{key:"toJSON",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=_createForOfIteratorHelper(this.items),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=13;break}return i=n.value,e.t0=t,e.next=9,i.toJSON();case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t2=e.catch(2),r.e(e.t2);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}}),e,this,[[2,15,18,21]])}))),function(){return r.apply(this,arguments)})},{key:"fromJSON",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.items=t;case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),$=new Uint8Array([1]).buffer,Q=new Uint8Array([2]).buffer,ee=function(){function e(t){_classCallCheck(this,e),this.counter=0,this.rootKey=t}var t,r,n,i,a;return _createClass(e,[{key:"toJSON",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{counter:this.counter,rootKey:this.rootKey});case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"fromJSON",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.counter=t.counter,this.rootKey=t.rootKey;case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"calculateKey",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.sign(t,$);case 2:return r=e.sent,e.next=5,U.sign(t,Q);case 5:return n=e.sent,e.t0=r,e.next=9,U.importHMAC(n);case 9:return e.t1=e.sent,i={cipher:e.t0,rootKey:e.t1},e.abrupt("return",i);case 12:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"click",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.rootKey,e.next=3,this.calculateKey(t);case 3:return r=e.sent,this.rootKey=r.rootKey,this.counter++,e.abrupt("return",r.cipher);case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}],[{key:"fromJSON",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new this(t.rootKey)).fromJSON(t),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),te=function(e){_inherits(n,e);var t,r=_createSuper(n);function n(){return _classCallCheck(this,n),r.apply(this,arguments)}return _createClass(n,[{key:"encrypt",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,a,o,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.click();case 2:return r=e.sent,e.next=5,U.HKDF(r,3,void 0,R);case 5:return n=e.sent,e.next=8,U.importAES(n[0]);case 8:return i=e.sent,e.next=11,U.importHMAC(n[1]);case 11:return a=e.sent,o=n[2].slice(0,16),e.next=15,U.encrypt(i,t,o);case 15:return s=e.sent,e.abrupt("return",{cipherText:s,hmacKey:a});case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),n}(ee),re=function(e){_inherits(o,e);var t,r,n,i,a=_createSuper(o);function o(){var e;return _classCallCheck(this,o),(e=a.apply(this,arguments)).keys=[],e}return _createClass(o,[{key:"toJSON",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_get5(_getPrototypeOf(o.prototype),"toJSON",this).call(this);case 2:return(t=e.sent).keys=this.keys,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"fromJSON",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_get5(_getPrototypeOf(o.prototype),"fromJSON",this).call(this,t);case 2:this.keys=t.keys;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"decrypt",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,a,o,s,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getKey(r);case 2:return n=e.sent,e.next=5,U.HKDF(n,3,void 0,R);case 5:return i=e.sent,e.next=8,U.importAES(i[0]);case 8:return a=e.sent,e.next=11,U.importHMAC(i[1]);case 11:return o=e.sent,s=i[2].slice(0,16),e.next=15,U.decrypt(a,t,s);case 15:return u=e.sent,e.abrupt("return",{cipherText:u,hmacKey:o});case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"getKey",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.counter<=t)){e.next=7;break}return e.next=3,this.click();case 3:r=e.sent,this.keys.push(r),e.next=0;break;case 7:return n=this.keys[t],e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),o}(ee);function ne(e,t,r,n,i){return ie.apply(this,arguments)}function ie(){return(ie=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,a){var o,s,u,c,l,h,f,y,v;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.deriveBytes(t.exchangeKey.privateKey,i);case 2:return o=e.sent,e.next=5,O.deriveBytes(r.privateKey,n);case 5:return s=e.sent,e.next=8,O.deriveBytes(r.privateKey,i);case 8:if(u=e.sent,c=new ArrayBuffer(0),!a){e.next=14;break}return e.next=13,O.deriveBytes(r.privateKey,a);case 13:c=e.sent;case 14:for(l=new Uint8Array(32),h=0;h<l.length;h++)l[h]=255;return f=l.buffer,y=p(f,o,s,u,c),e.next=20,U.HKDF(y,1,void 0,I);case 20:return v=e.sent,e.next=23,U.importHMAC(v[0]);case 23:return e.abrupt("return",e.sent);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e,t,r,n,i){return oe.apply(this,arguments)}function oe(){return(oe=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,a){var o,s,u,c,l,h,f,y,v;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.deriveBytes(r.privateKey,n);case 2:return o=e.sent,e.next=5,O.deriveBytes(t.exchangeKey.privateKey,i);case 5:return s=e.sent,e.next=8,O.deriveBytes(r.privateKey,i);case 8:if(u=e.sent,c=new ArrayBuffer(0),!a){e.next=14;break}return e.next=13,O.deriveBytes(a,i);case 13:c=e.sent;case 14:for(l=new Uint8Array(32),h=0;h<l.length;h++)l[h]=255;return f=l.buffer,y=p(f,o,s,u,c),e.next=20,U.HKDF(y,1,void 0,I);case 20:return v=e.sent,e.next=23,U.importHMAC(v[0]);case 23:return e.abrupt("return",e.sent);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var se=function(e){_inherits(l,e);var t,r,n,i,a,o,s,u,c=_createSuper(l);function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,l),(e=c.call(this)).options=t,e.counter=0,e.currentStep=new ue,e.steps=new ce(20),e.promises={},e}return _createClass(l,[{key:"on",value:function(e,t){return _get5(_getPrototypeOf(l.prototype),"on",this).call(this,e,t)}},{key:"once",value:function(e,t){return _get5(_getPrototypeOf(l.prototype),"once",this).call(this,e,t)}},{key:"decrypt",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.queuePromise("encrypt",_asyncToGenerator(_regeneratorRuntime().mark((function e(){var n,i,a,o,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.message.senderRatchetKey,i=t.message,!(t.message.previousCounter<r.counter-20)){e.next=4;break}throw new Error("Error: Too old message");case 4:if((a=r.steps.getStep(n))||((o=new ue).remoteRatchetKey=n,r.steps.push(o),r.currentStep=o,a=o),a.receivingChain){e.next=10;break}return e.next=9,r.createChain(r.currentRatchetKey.privateKey,n,re);case 9:a.receivingChain=e.sent;case 10:return e.next=12,a.receivingChain.decrypt(i.cipherText,i.counter);case 12:return s=e.sent,r.update(),t.senderKey=r.remoteIdentity.signingKey,t.receiverKey=r.identity.signingKey.publicKey,e.next=18,t.verify(s.hmacKey);case 18:if(e.sent){e.next=20;break}throw new Error("Error: The Message did not successfully verify!");case 20:return e.abrupt("return",s.cipherText);case 21:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"encrypt",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.queuePromise("encrypt",_asyncToGenerator(_regeneratorRuntime().mark((function e(){var n,i,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.currentStep.receivingChain||r.currentStep.sendingChain){e.next=5;break}return r.counter++,e.next=4,r.generateRatchetKey();case 4:r.currentRatchetKey=e.sent;case 5:if(r.currentStep.sendingChain){e.next=11;break}if(r.currentStep.remoteRatchetKey){e.next=8;break}throw new Error("currentStep has empty remoteRatchetKey");case 8:return e.next=10,r.createChain(r.currentRatchetKey.privateKey,r.currentStep.remoteRatchetKey,te);case 10:r.currentStep.sendingChain=e.sent;case 11:return e.next=13,r.currentStep.sendingChain.encrypt(t);case 13:if(n=e.sent,r.update(),0!==r.steps.length||r.currentStep.receivingChain||1!==r.currentStep.sendingChain.counter){e.next=23;break}return(i=new J).registrationId=r.identity.id,i.preKeyId=r.remotePreKeyId,i.preKeySignedId=r.remotePreKeySignedId,i.baseKey=r.currentRatchetKey.publicKey,e.next=23,i.identity.fill(r.identity);case 23:return(a=new F).receiverKey=r.remoteIdentity.signingKey,a.senderKey=r.identity.signingKey.publicKey,a.message.cipherText=n.cipherText,a.message.counter=r.currentStep.sendingChain.counter-1,a.message.previousCounter=r.counter,a.message.senderRatchetKey=r.currentRatchetKey.publicKey,e.next=32,a.sign(n.hmacKey);case 32:if(!i){e.next=37;break}return i.signedMessage=a,e.abrupt("return",i);case 37:return e.abrupt("return",a);case 38:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"hasRatchetKey",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof P){e.next=6;break}return e.next=3,P.create(t);case 3:r=e.sent,e.next=7;break;case 6:r=t;case 7:n=_createForOfIteratorHelper(this.steps.items),e.prev=8,n.s();case 10:if((i=n.n()).done){e.next=18;break}return a=i.value,e.next=14,a.remoteRatchetKey.isEqual(r);case 14:if(!e.sent){e.next=16;break}return e.abrupt("return",!0);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),n.e(e.t0);case 23:return e.prev=23,n.f(),e.finish(23);case 26:return e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,this,[[8,20,23,26]])}))),function(e){return o.apply(this,arguments)})},{key:"toJSON",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.counter,e.next=3,O.ecKeyPairToJson(this.currentRatchetKey);case 3:return e.t1=e.sent,e.next=6,this.remoteIdentity.signingKey.thumbprint();case 6:return e.t2=e.sent,e.t3=this.rootKey,e.next=10,this.steps.toJSON();case 10:return e.t4=e.sent,e.abrupt("return",{counter:e.t0,ratchetKey:e.t1,remoteIdentity:e.t2,rootKey:e.t3,steps:e.t4});case 12:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"fromJSON",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.ecKeyPairFromJson(t.ratchetKey);case 2:this.currentRatchetKey=e.sent,this.counter=t.counter,this.rootKey=t.rootKey,r=_createForOfIteratorHelper(t.steps),e.prev=6,r.s();case 8:if((n=r.n()).done){e.next=16;break}return i=n.value,e.next=12,ue.fromJSON(i);case 12:this.currentStep=e.sent,this.steps.push(this.currentStep);case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),r.e(e.t0);case 21:return e.prev=21,r.f(),e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[6,18,21,24]])}))),function(e){return i.apply(this,arguments)})},{key:"update",value:function(){this.emit("update")}},{key:"generateRatchetKey",value:function(){return O.generateKeyPair("ECDH",!!this.options.exportableKeys)}},{key:"createChain",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,a,o,s,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.deriveBytes(t,r);case 2:return i=e.sent,e.next=5,U.HKDF(i,2,this.rootKey,B);case 5:return a=e.sent,e.next=8,U.importHMAC(a[0]);case 8:return o=e.sent,e.next=11,U.importHMAC(a[1]);case 11:return s=e.sent,u=new n(s),this.rootKey=o,e.abrupt("return",u);case 15:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"queuePromise",value:function(e,t){var r=this,n=this.promises[e]||Promise.resolve(),i=this.promises[e]=n.then(t,t);return i.then((function(){r.promises[e]===i&&delete r.promises[e]})),i}}],[{key:"create",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,a,o,s=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=new l(s.length>2&&void 0!==s[2]?s[2]:{}),!(r instanceof Y)){e.next=24;break}return e.next=5,r.identity.verify();case 5:if(e.sent){e.next=7;break}throw new Error("Error: Remote client's identity key is invalid.");case 7:return e.next=9,r.preKeySigned.verify(r.identity.signingKey);case 9:if(e.sent){e.next=11;break}throw new Error("Error: Remote client's signed prekey is invalid.");case 11:return e.next=13,i.generateRatchetKey();case 13:return i.currentRatchetKey=e.sent,i.currentStep.remoteRatchetKey=r.preKeySigned.key,i.remoteIdentity=L.fill(r.identity),i.remoteIdentity.id=r.registrationId,i.remotePreKeyId=r.preKey.id,i.remotePreKeySignedId=r.preKeySigned.id,e.next=21,ne(t,i.currentRatchetKey,r.identity.exchangeKey,r.preKeySigned.key,r.preKey.key);case 21:n=e.sent,e.next=37;break;case 24:return e.next=26,r.identity.verify();case 26:if(e.sent){e.next=28;break}throw new Error("Error: Remote client's identity key is invalid.");case 28:if(a=t.signedPreKeys[r.preKeySignedId]){e.next=31;break}throw new Error("Error: PreKey with id ".concat(r.preKeySignedId," not found"));case 31:return void 0!==r.preKeyId&&(o=t.preKeys[r.preKeyId]),i.remoteIdentity=L.fill(r.identity),i.currentRatchetKey=a,e.next=36,ae(t,i.currentRatchetKey,r.identity.exchangeKey,r.signedMessage.message.senderRatchetKey,o&&o.privateKey);case 36:n=e.sent;case 37:return i.identity=t,i.id=t.id,i.rootKey=n,e.abrupt("return",i);case 41:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"fromJSON",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new l).identity=t,i.remoteIdentity=r,e.next=5,i.fromJSON(n);case 5:return e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)}))),function(e,r,n){return t.apply(this,arguments)})}]),l}(k),ue=function(){function e(){_classCallCheck(this,e)}var t,r,n;return _createClass(e,[{key:"toJSON",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},this.remoteRatchetKey&&(t.remoteRatchetKey=this.remoteRatchetKey.key),!this.sendingChain){e.next=6;break}return e.next=5,this.sendingChain.toJSON();case 5:t.sendingChain=e.sent;case 6:if(!this.receivingChain){e.next=10;break}return e.next=9,this.receivingChain.toJSON();case 9:t.receivingChain=e.sent;case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"fromJSON",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.remoteRatchetKey){e.next=4;break}return e.next=3,P.create(t.remoteRatchetKey);case 3:this.remoteRatchetKey=e.sent;case 4:if(!t.sendingChain){e.next=8;break}return e.next=7,te.fromJSON(t.sendingChain);case 7:this.sendingChain=e.sent;case 8:if(!t.receivingChain){e.next=12;break}return e.next=11,re.fromJSON(t.receivingChain);case 11:this.receivingChain=e.sent;case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}],[{key:"fromJSON",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new this,e.next=3,r.fromJSON(t);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),ce=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"getStep",value:function(e){var t;return this.items.some((function(r){return r.remoteRatchetKey.id===e.id&&(t=r),!!t})),t}}]),r}(Z);function le(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o}var he,pe,fe,ye,ve,de,ge,me,_e,ke=function(){function e(){_classCallCheck(this,e)}var t,r;return _createClass(e,null,[{key:"set",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(l.FromUtf8String(t.toISOString())));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"get",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Date(l.ToUtf8String(t)));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),we=function(){function e(){_classCallCheck(this,e)}var t,r;return _createClass(e,null,[{key:"set",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(l.FromHex(t)));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"get",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l.ToHex(t));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),be=function(){function e(){_classCallCheck(this,e)}var t,r;return _createClass(e,null,[{key:"set",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(l.FromUtf8String(t.toString(10))));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"get",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",parseInt(l.ToUtf8String(t),10));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),Ce=he=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).version=0,e}return _createClass(r)}(m);Ce.INDEX=1,le([g({id:he.INDEX++,type:"uint32",required:!0,defaultValue:1})],Ce.prototype,"version",void 0);var xe=pe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this)).actionId="",e.action=e.constructor.ACTION,e}return _createClass(r)}(Ce=he=le([d({name:"BaseMessage"})],Ce));xe.INDEX=Ce.INDEX,xe.ACTION="action",le([g({id:pe.INDEX++,type:"string",required:!0})],xe.prototype,"action",void 0),le([g({id:pe.INDEX++,type:"string",required:!1})],xe.prototype,"actionId",void 0),xe=pe=le([d({name:"Action"})],xe);var Se=fe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="",e}return _createClass(r,[{key:"isEmpty",value:function(){return!this.name}},{key:"toAlgorithm",value:function(){return{name:this.name}}},{key:"fromAlgorithm",value:function(e){this.name=e.name}}]),r}(Ce);Se.INDEX=Ce.INDEX,le([g({id:fe.INDEX++,type:"string",required:!0})],Se.prototype,"name",void 0),Se=fe=le([d({name:"BaseAlgorithm"})],Se);var Ee=ye=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"toAlgorithm",value:function(){var e={},t=this.constructor;for(var r in t.items)if("version"!==r){var n=this[r];"labelStr"!==r?void 0!==n&&(n instanceof Se?n.isEmpty()||(e[r]=n.toAlgorithm()):e[r]=n):e.label=n}return e}},{key:"fromAlgorithm",value:function(e){e instanceof ye&&(e=e.toAlgorithm());var t=this.constructor;for(var r in e)if(t.items&&r in t.items){var n=t.items[r];if(n.parser){if(n.parser!==Se)throw new Error("Unsupported parser '".concat(n.parser.name,"'"));this[r].fromAlgorithm(e[r])}else"label"===r&&"string"==typeof e.label?this.labelStr=e.label:this[r]=e[r]}}}]),r}(Se);Ee.INDEX=Se.INDEX,le([g({id:ye.INDEX++,type:"bytes",parser:Se})],Ee.prototype,"hash",void 0),le([g({id:ye.INDEX++,type:"bytes"})],Ee.prototype,"publicExponent",void 0),le([g({id:ye.INDEX++,type:"uint32"})],Ee.prototype,"modulusLength",void 0),le([g({id:ye.INDEX++,type:"uint32"})],Ee.prototype,"saltLength",void 0),le([g({id:ye.INDEX++,type:"bytes"})],Ee.prototype,"label",void 0),le([g({id:ye.INDEX++,type:"string"})],Ee.prototype,"namedCurve",void 0),le([g({id:ye.INDEX++,converter:v})],Ee.prototype,"public",void 0),le([g({id:ye.INDEX++,type:"uint32"})],Ee.prototype,"length",void 0),le([g({id:ye.INDEX++})],Ee.prototype,"iv",void 0),le([g({id:ye.INDEX++,type:"bool"})],Ee.prototype,"token",void 0),le([g({id:ye.INDEX++,type:"bool"})],Ee.prototype,"sensitive",void 0),le([g({id:ye.INDEX++,type:"string"})],Ee.prototype,"labelStr",void 0),Ee=ye=le([d({name:"Algorithm"})],Ee);var Ae=ve=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).providerID="",e.id="",e.type="",e}return _createClass(r)}(Ce);Ae.INDEX=Ce.INDEX,le([g({id:ve.INDEX++,type:"string",required:!0})],Ae.prototype,"providerID",void 0),le([g({id:ve.INDEX++,type:"bytes",required:!0,converter:we})],Ae.prototype,"id",void 0),le([g({id:ve.INDEX++,type:"string",required:!0})],Ae.prototype,"type",void 0),Ae=ve=le([d({name:"CryptoItem"})],Ae);var Ne=function(){function e(){_classCallCheck(this,e)}var t,r;return _createClass(e,null,[{key:"set",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new Ee).fromAlgorithm(t),e.next=4,r.exportProto();case 4:return n=e.sent,e.abrupt("return",new Uint8Array(n));case 6:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"get",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee,e.next=3,r.importProto(t);case 3:return n=r.toAlgorithm(),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),Ie=de=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).type="secret",e.algorithm={name:""},e.extractable=!1,e.usages=[],e}return _createClass(r)}(Ae);Ie.INDEX=Ae.INDEX,le([g({id:de.INDEX++,type:"bytes",required:!0,converter:Ne})],Ie.prototype,"algorithm",void 0),le([g({id:de.INDEX++,type:"bool"})],Ie.prototype,"extractable",void 0),le([g({id:de.INDEX++,type:"string",repeated:!0})],Ie.prototype,"usages",void 0),Ie=de=le([d({name:"CryptoKey"})],Ie);var Be=ge=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).privateKey=new Ie,e.publicKey=new Ie,e}return _createClass(r)}(Ce);Be.INDEX=Ce.INDEX,le([g({id:ge.INDEX++,name:"privateKey",type:"bytes",required:!0,parser:Ie})],Be.prototype,"privateKey",void 0),le([g({id:ge.INDEX++,name:"publicKey",type:"bytes",parser:Ie})],Be.prototype,"publicKey",void 0),Be=ge=le([d({name:"CryptoKeyPair"})],Be);var Re=me=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"error";return _classCallCheck(this,r),(n=t.call(this)).code=0,n.type="error",n.message="",n.name="Error",n.stack="",e&&(n.message=e,n.code=i,n.type=a),n}return _createClass(r)}(Ce);Re.INDEX=Ce.INDEX,le([g({id:me.INDEX++,type:"uint32",defaultValue:0})],Re.prototype,"code",void 0),le([g({id:me.INDEX++,type:"string",defaultValue:"error"})],Re.prototype,"type",void 0),le([g({id:me.INDEX++,type:"string",defaultValue:""})],Re.prototype,"message",void 0),le([g({id:me.INDEX++,type:"string",defaultValue:"Error"})],Re.prototype,"name",void 0),le([g({id:me.INDEX++,type:"string",defaultValue:""})],Re.prototype,"stack",void 0),Re=me=le([d({name:"Error"})],Re);var Te=_e=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this)).status=!1,e&&(n.actionId=e.actionId,n.action=e.action),n}return _createClass(r)}(xe);Te.INDEX=xe.INDEX,le([g({id:_e.INDEX++,type:"bool",defaultValue:!1})],Te.prototype,"status",void 0),le([g({id:_e.INDEX++,type:"bytes",parser:Re})],Te.prototype,"error",void 0),le([g({id:_e.INDEX++,type:"bytes",converter:v})],Te.prototype,"data",void 0),Te=_e=le([d({name:"Result"})],Te);var De=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(xe);De.INDEX=xe.INDEX,De.ACTION="auth",De=le([d({name:"AuthRequest"})],De);var Oe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(xe);Oe.INDEX=xe.INDEX,Oe.ACTION="server/login",Oe=le([d({})],Oe);var Ke,Ue=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(xe);Ue.INDEX=xe.INDEX,Ue.ACTION="server/isLoggedIn",Ue=le([d({})],Ue);var Pe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(xe);Pe.INDEX=xe.INDEX,Pe.ACTION="cardReader",Pe=le([d({})],Pe);var Xe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(xe);Xe.INDEX=xe.INDEX,Xe.ACTION="cardReader/readers",Xe=le([d({})],Xe);var Le=Ke=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var i;return _classCallCheck(this,r),(i=t.call(this)).reader="",i.atr="",e&&n&&(i.reader=e,i.atr=n),i}return _createClass(r)}(Pe);Le.INDEX=Pe.INDEX,le([g({id:Ke.INDEX++,required:!0,type:"string",defaultValue:""})],Le.prototype,"reader",void 0),le([g({id:Ke.INDEX++,required:!0,converter:we})],Le.prototype,"atr",void 0);var je=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Le=Ke=le([d({})],Le));je.INDEX=Le.INDEX,je.ACTION=Le.ACTION+"/insert",je=le([d({})],je);var He,Ge=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Le);Ge.INDEX=Le.INDEX,Ge.ACTION=Le.ACTION+"/remove",Ge=le([d({})],Ge);var Ve=He=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).providerID="",e}return _createClass(r)}(xe);Ve.INDEX=xe.INDEX,Ve.ACTION="crypto",le([g({id:He.INDEX++,required:!0,type:"string"})],Ve.prototype,"providerID",void 0);var Me=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Ve=He=le([d({})],Ve));Me.INDEX=Ve.INDEX,Me.ACTION="crypto/login",Me=le([d({})],Me);var qe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Ve);qe.INDEX=Ve.INDEX,qe.ACTION="crypto/logout",qe=le([d({})],qe);var Fe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Ve);Fe.INDEX=Ve.INDEX,Fe.ACTION="crypto/isLoggedIn",Fe=le([d({})],Fe);var Je,ze,We,Ye,Ze,$e,Qe,et,tt,rt,nt,it,at,ot,st,ut=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Ve);ut.INDEX=Ve.INDEX,ut.ACTION="crypto/reset",ut=le([d({})],ut);var ct=Je=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).id="",e.publicKey=new Ie,e.type="x509",e.label="",e.token=!1,e.sensitive=!1,e}return _createClass(r)}(Ae);ct.INDEX=Ae.INDEX,le([g({id:Je.INDEX++,required:!0,converter:we})],ct.prototype,"id",void 0),le([g({id:Je.INDEX++,required:!0,parser:Ie})],ct.prototype,"publicKey",void 0),le([g({id:Je.INDEX++,required:!0,type:"string"})],ct.prototype,"type",void 0),le([g({id:Je.INDEX++,type:"string",defaultValue:""})],ct.prototype,"label",void 0),le([g({id:Je.INDEX++,type:"bool",defaultValue:!1})],ct.prototype,"token",void 0),le([g({id:Je.INDEX++,type:"bool",defaultValue:!1})],ct.prototype,"sensitive",void 0);var lt=ze=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).type="x509",e.serialNumber="",e.issuerName="",e.subjectName="",e.notBefore=new Date,e.notAfter=new Date,e}return _createClass(r)}(ct=Je=le([d({})],ct));lt.INDEX=ct.INDEX,le([g({id:ze.INDEX++,required:!0,converter:we})],lt.prototype,"serialNumber",void 0),le([g({id:ze.INDEX++,required:!0,type:"string"})],lt.prototype,"issuerName",void 0),le([g({id:ze.INDEX++,required:!0,type:"string"})],lt.prototype,"subjectName",void 0),le([g({id:ze.INDEX++,required:!0,converter:ke})],lt.prototype,"notBefore",void 0),le([g({id:ze.INDEX++,required:!0,converter:ke})],lt.prototype,"notAfter",void 0),lt=ze=le([d({})],lt);var ht=We=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).type="request",e.subjectName="",e}return _createClass(r)}(ct);ht.INDEX=ct.INDEX,le([g({id:We.INDEX++,required:!0,type:"string"})],ht.prototype,"subjectName",void 0),ht=We=le([d({})],ht);var pt=Ye=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).type="",e.value=new ArrayBuffer(0),e}return _createClass(r)}(Ce);pt.INDEX=Ce.INDEX,le([g({id:Ye.INDEX++,required:!0,type:"string"})],pt.prototype,"type",void 0),le([g({id:Ye.INDEX++,required:!0,converter:v})],pt.prototype,"value",void 0),pt=Ye=le([d({})],pt);var ft=Ze=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).items=[],e}return _createClass(r)}(Ce);ft.INDEX=Ce.INDEX,le([g({id:Ze.INDEX++,required:!0,repeated:!0,parser:pt})],ft.prototype,"items",void 0),ft=Ze=le([d({})],ft);var yt=$e=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).item=new ct,e}return _createClass(r)}(Ve);yt.INDEX=Ve.INDEX,yt.ACTION="crypto/certificateStorage/setItem",le([g({id:$e.INDEX++,required:!0,parser:ct})],yt.prototype,"item",void 0),yt=$e=le([d({})],yt);var vt=Qe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).key="",e.algorithm=new Ee,e.keyUsages=[],e}return _createClass(r)}(Ve);vt.INDEX=Ve.INDEX,vt.ACTION="crypto/certificateStorage/getItem",le([g({id:Qe.INDEX++,required:!0,type:"string"})],vt.prototype,"key",void 0),le([g({id:Qe.INDEX++,parser:Ee})],vt.prototype,"algorithm",void 0),le([g({id:Qe.INDEX++,repeated:!0,type:"string"})],vt.prototype,"keyUsages",void 0),vt=Qe=le([d({})],vt);var dt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Ve);dt.INDEX=Ve.INDEX,dt.ACTION="crypto/certificateStorage/keys",dt=le([d({})],dt);var gt=et=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).key="",e}return _createClass(r)}(Ve);gt.INDEX=Ve.INDEX,gt.ACTION="crypto/certificateStorage/getValue",le([g({id:et.INDEX++,required:!0,type:"string"})],gt.prototype,"key",void 0),gt=et=le([d({})],gt);var mt=tt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).key="",e}return _createClass(r)}(Ve);mt.INDEX=Ve.INDEX,mt.ACTION="crypto/certificateStorage/removeItem",le([g({id:tt.INDEX++,required:!0,type:"string"})],mt.prototype,"key",void 0),mt=tt=le([d({})],mt);var _t=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Ve);_t.INDEX=Ve.INDEX,_t.ACTION="crypto/certificateStorage/clear",_t=le([d({})],_t);var kt=rt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).format="raw",e.data=new ArrayBuffer(0),e.algorithm=new Ee,e.keyUsages=[],e}return _createClass(r)}(Ve);kt.INDEX=Ve.INDEX,kt.ACTION="crypto/certificateStorage/import",le([g({id:rt.INDEX++,required:!0,type:"string"})],kt.prototype,"format",void 0),le([g({id:rt.INDEX++,required:!0,converter:v})],kt.prototype,"data",void 0),le([g({id:rt.INDEX++,required:!0,parser:Ee})],kt.prototype,"algorithm",void 0),le([g({id:rt.INDEX++,repeated:!0,type:"string"})],kt.prototype,"keyUsages",void 0),kt=rt=le([d({})],kt);var wt=nt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).format="raw",e.item=new ct,e}return _createClass(r)}(Ve);wt.INDEX=Ve.INDEX,wt.ACTION="crypto/certificateStorage/export",le([g({id:nt.INDEX++,required:!0,type:"string"})],wt.prototype,"format",void 0),le([g({id:nt.INDEX++,required:!0,parser:ct})],wt.prototype,"item",void 0),wt=nt=le([d({})],wt);var bt=it=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).item=new ct,e}return _createClass(r)}(Ve);bt.INDEX=Ve.INDEX,bt.ACTION="crypto/certificateStorage/indexOf",le([g({id:it.INDEX++,required:!0,parser:ct})],bt.prototype,"item",void 0),bt=it=le([d({})],bt);var Ct=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).item=new ct,e}return _createClass(r)}(Ve);Ct.INDEX=Ve.INDEX,Ct.ACTION="crypto/certificateStorage/getChain",le([g({id:yt.INDEX++,required:!0,parser:ct})],Ct.prototype,"item",void 0),Ct=le([d({})],Ct);var xt=at=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).url="",e}return _createClass(r)}(Ve);xt.INDEX=Ve.INDEX,xt.ACTION="crypto/certificateStorage/getCRL",le([g({id:at.INDEX++,required:!0,type:"string"})],xt.prototype,"url",void 0),xt=at=le([d({})],xt);var St=ot=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).method="get",e}return _createClass(r)}(Ce);St.INDEX=Ce.INDEX,le([g({id:ot.INDEX++,required:!1,type:"string",defaultValue:"get"})],St.prototype,"method",void 0),St=ot=le([d({})],St);var Et,At,Nt,It,Bt=st=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).url="",e.request=new ArrayBuffer(0),e.options=new St,e}return _createClass(r)}(Ve);Bt.INDEX=Ve.INDEX,Bt.ACTION="crypto/certificateStorage/getOCSP",le([g({id:st.INDEX++,required:!0,type:"string"})],Bt.prototype,"url",void 0),le([g({id:st.INDEX++,required:!0,converter:v})],Bt.prototype,"request",void 0),le([g({id:st.INDEX++,required:!1,parser:St})],Bt.prototype,"options",void 0),Bt=st=le([d({})],Bt);var Rt=Et=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).item=new Ie,e}return _createClass(r)}(Ve);Rt.INDEX=Ve.INDEX,Rt.ACTION="crypto/keyStorage/setItem",le([g({id:Et.INDEX++,required:!0,parser:Ie})],Rt.prototype,"item",void 0),Rt=Et=le([d({})],Rt);var Tt=At=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).key="",e.algorithm=new Ee,e.extractable=!1,e.keyUsages=[],e}return _createClass(r)}(Ve);Tt.INDEX=Ve.INDEX,Tt.ACTION="crypto/keyStorage/getItem",le([g({id:At.INDEX++,required:!0,type:"string"})],Tt.prototype,"key",void 0),le([g({id:At.INDEX++,parser:Ee})],Tt.prototype,"algorithm",void 0),le([g({id:At.INDEX++,type:"bool"})],Tt.prototype,"extractable",void 0),le([g({id:At.INDEX++,repeated:!0,type:"string"})],Tt.prototype,"keyUsages",void 0),Tt=At=le([d({})],Tt);var Dt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Ve);Dt.INDEX=Ve.INDEX,Dt.ACTION="crypto/keyStorage/keys",Dt=le([d({})],Dt);var Ot=Nt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).key="",e}return _createClass(r)}(Ve);Ot.INDEX=Ve.INDEX,Ot.ACTION="crypto/keyStorage/removeItem",le([g({id:Nt.INDEX++,required:!0,type:"string"})],Ot.prototype,"key",void 0),Ot=Nt=le([d({})],Ot);var Kt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Ve);Kt.INDEX=Ve.INDEX,Kt.ACTION="crypto/keyStorage/clear",Kt=le([d({})],Kt);var Ut,Pt,Xt,Lt,jt,Ht,Gt=It=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).item=new Ie,e}return _createClass(r)}(Ve);Gt.INDEX=Ve.INDEX,Gt.ACTION="crypto/keyStorage/indexOf",le([g({id:It.INDEX++,required:!0,parser:Ie})],Gt.prototype,"item",void 0),Gt=It=le([d({})],Gt);var Vt=Ut=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this)).major=0,n.minor=0,e&&h(_assertThisInitialized(n),e),n}return _createClass(r)}(Ce);Vt.INDEX=Ce.INDEX,le([g({id:Ut.INDEX++,required:!0,type:"uint32"})],Vt.prototype,"major",void 0),le([g({id:Ut.INDEX++,required:!0,type:"uint32"})],Vt.prototype,"minor",void 0),Vt=Ut=le([d({})],Vt);var Mt=Pt=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this)).label="",n.manufacturerID="",n.model="",n.serialNumber="",n.flags=0,n.hardwareVersion=new Vt,n.firmwareVersion=new Vt,n.maxSessionCount=0,n.sessionCount=0,n.maxRwSessionCount=0,n.rwSessionCount=0,n.maxPinLen=0,n.minPinLen=0,n.totalPublicMemory=0,n.freePublicMemory=0,n.totalPrivateMemory=0,n.freePrivateMemory=0,e&&(h(_assertThisInitialized(n),e),n.firmwareVersion=new Vt(e.firmwareVersion),n.hardwareVersion=new Vt(e.hardwareVersion)),n}return _createClass(r)}(Ce);Mt.INDEX=Ce.INDEX,le([g({id:Pt.INDEX++,required:!0,type:"string"})],Mt.prototype,"label",void 0),le([g({id:Pt.INDEX++,required:!0,type:"string"})],Mt.prototype,"manufacturerID",void 0),le([g({id:Pt.INDEX++,required:!0,type:"string"})],Mt.prototype,"model",void 0),le([g({id:Pt.INDEX++,required:!0,type:"string"})],Mt.prototype,"serialNumber",void 0),le([g({id:Pt.INDEX++,required:!0,type:"uint32"})],Mt.prototype,"flags",void 0),le([g({id:Pt.INDEX++,required:!0,parser:Vt})],Mt.prototype,"hardwareVersion",void 0),le([g({id:Pt.INDEX++,required:!0,parser:Vt})],Mt.prototype,"firmwareVersion",void 0),le([g({id:Pt.INDEX++,required:!0,type:"uint32"})],Mt.prototype,"maxSessionCount",void 0),le([g({id:Pt.INDEX++,required:!0,type:"uint32"})],Mt.prototype,"sessionCount",void 0),le([g({id:Pt.INDEX++,required:!0,type:"uint32"})],Mt.prototype,"maxRwSessionCount",void 0),le([g({id:Pt.INDEX++,required:!0,type:"uint32"})],Mt.prototype,"rwSessionCount",void 0),le([g({id:Pt.INDEX++,required:!0,type:"uint32"})],Mt.prototype,"maxPinLen",void 0),le([g({id:Pt.INDEX++,required:!0,type:"uint32"})],Mt.prototype,"minPinLen",void 0),le([g({id:Pt.INDEX++,required:!0,converter:be})],Mt.prototype,"totalPublicMemory",void 0),le([g({id:Pt.INDEX++,required:!0,converter:be})],Mt.prototype,"freePublicMemory",void 0),le([g({id:Pt.INDEX++,required:!0,converter:be})],Mt.prototype,"totalPrivateMemory",void 0),le([g({id:Pt.INDEX++,required:!0,converter:be})],Mt.prototype,"freePrivateMemory",void 0),Mt=Pt=le([d({})],Mt);var qt=Xt=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this)).id="",n.name="",n.readOnly=!1,n.algorithms=[],n.isRemovable=!1,n.atr="",n.isHardware=!1,n.card="",e&&(h(_assertThisInitialized(n),e),e.token&&(n.token=new Mt(e.token))),n}return _createClass(r)}(Ce);qt.INDEX=Ce.INDEX,le([g({id:Xt.INDEX++,required:!0,type:"string"})],qt.prototype,"id",void 0),le([g({id:Xt.INDEX++,required:!0,type:"string"})],qt.prototype,"name",void 0),le([g({id:Xt.INDEX++,type:"bool",defaultValue:!1})],qt.prototype,"readOnly",void 0),le([g({id:Xt.INDEX++,repeated:!0,type:"string"})],qt.prototype,"algorithms",void 0),le([g({id:Xt.INDEX++,type:"bool",defaultValue:!1})],qt.prototype,"isRemovable",void 0),le([g({id:Xt.INDEX++,type:"string"})],qt.prototype,"atr",void 0),le([g({id:Xt.INDEX++,type:"bool",defaultValue:!1})],qt.prototype,"isHardware",void 0),le([g({id:Xt.INDEX++,type:"string"})],qt.prototype,"card",void 0),le([g({id:Xt.INDEX++,parser:Mt})],qt.prototype,"token",void 0),qt=Xt=le([d({})],qt);var Ft=Lt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="",e.providers=[],e}return _createClass(r)}(Ce);Ft.INDEX=Ce.INDEX,le([g({id:Lt.INDEX++,type:"string",required:!0})],Ft.prototype,"name",void 0),le([g({id:Lt.INDEX++,repeated:!0,parser:qt})],Ft.prototype,"providers",void 0),Ft=Lt=le([d({})],Ft);var Jt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(xe);Jt.INDEX=xe.INDEX,Jt.ACTION="provider/action/info",Jt=le([d({})],Jt);var zt=jt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).cryptoID="",e}return _createClass(r)}(xe);zt.INDEX=xe.INDEX,zt.ACTION="provider/action/getCrypto",le([g({id:jt.INDEX++,required:!0,type:"string"})],zt.prototype,"cryptoID",void 0),zt=jt=le([d({})],zt);var Wt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(xe);Wt.INDEX=xe.INDEX,Wt.ACTION="provider/event/authorized",Wt=le([d({})],Wt);var Yt,Zt,$t,Qt,er,tr,rr,nr,ir,ar,or=Ht=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this)).added=[],n.removed=[],e&&h(_assertThisInitialized(n),e),n}return _createClass(r)}(xe);or.INDEX=xe.INDEX,or.ACTION="provider/event/token",le([g({id:Ht.INDEX++,repeated:!0,parser:qt})],or.prototype,"added",void 0),le([g({id:Ht.INDEX++,repeated:!0,parser:qt})],or.prototype,"removed",void 0),le([g({id:Ht.INDEX++,type:"bytes",parser:Re})],or.prototype,"error",void 0),or=Ht=le([d({name:"ProviderTokenEvent"})],or);var sr=Yt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).algorithm=new Ee,e.data=new ArrayBuffer(0),e}return _createClass(r)}(Ve);sr.INDEX=Ve.INDEX,sr.ACTION="crypto/subtle/digest",le([g({id:Yt.INDEX++,required:!0,parser:Ee})],sr.prototype,"algorithm",void 0),le([g({id:Yt.INDEX++,required:!0,converter:v})],sr.prototype,"data",void 0),sr=Yt=le([d({})],sr);var ur=Zt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).algorithm=new Ee,e.extractable=!1,e.usage=[],e}return _createClass(r)}(Ve);ur.INDEX=Ve.INDEX,ur.ACTION="crypto/subtle/generateKey",le([g({id:Zt.INDEX++,type:"bytes",required:!0,parser:Ee})],ur.prototype,"algorithm",void 0),le([g({id:Zt.INDEX++,type:"bool",required:!0})],ur.prototype,"extractable",void 0),le([g({id:Zt.INDEX++,type:"string",repeated:!0})],ur.prototype,"usage",void 0),ur=Zt=le([d({})],ur);var cr=$t=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).algorithm=new Ee,e.key=new Ie,e.data=new ArrayBuffer(0),e}return _createClass(r)}(Ve);cr.INDEX=Ve.INDEX,cr.ACTION="crypto/subtle/sign",le([g({id:$t.INDEX++,required:!0,parser:Ee})],cr.prototype,"algorithm",void 0),le([g({id:$t.INDEX++,required:!0,parser:Ie})],cr.prototype,"key",void 0),le([g({id:$t.INDEX++,required:!0,converter:v})],cr.prototype,"data",void 0);var lr=Qt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).signature=new ArrayBuffer(0),e}return _createClass(r)}(cr=$t=le([d({})],cr));lr.INDEX=cr.INDEX,lr.ACTION="crypto/subtle/verify",le([g({id:Qt.INDEX++,required:!0,converter:v})],lr.prototype,"signature",void 0),lr=Qt=le([d({})],lr);var hr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(cr);hr.INDEX=cr.INDEX,hr.ACTION="crypto/subtle/encrypt",hr=le([d({})],hr);var pr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(cr);pr.INDEX=cr.INDEX,pr.ACTION="crypto/subtle/decrypt",pr=le([d({})],pr);var fr=er=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).algorithm=new Ee,e.key=new Ie,e.length=0,e}return _createClass(r)}(Ve);fr.INDEX=Ve.INDEX,fr.ACTION="crypto/subtle/deriveBits",le([g({id:er.INDEX++,required:!0,parser:Ee})],fr.prototype,"algorithm",void 0),le([g({id:er.INDEX++,required:!0,parser:Ie})],fr.prototype,"key",void 0),le([g({id:er.INDEX++,required:!0,type:"uint32"})],fr.prototype,"length",void 0),fr=er=le([d({})],fr);var yr=tr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).algorithm=new Ee,e.key=new Ie,e.derivedKeyType=new Ee,e.extractable=!1,e.usage=[],e}return _createClass(r)}(Ve);yr.INDEX=Ve.INDEX,yr.ACTION="crypto/subtle/deriveKey",le([g({id:tr.INDEX++,required:!0,parser:Ee})],yr.prototype,"algorithm",void 0),le([g({id:tr.INDEX++,required:!0,parser:Ie})],yr.prototype,"key",void 0),le([g({id:tr.INDEX++,required:!0,parser:Ee})],yr.prototype,"derivedKeyType",void 0),le([g({id:tr.INDEX++,type:"bool"})],yr.prototype,"extractable",void 0),le([g({id:tr.INDEX++,type:"string",repeated:!0})],yr.prototype,"usage",void 0),yr=tr=le([d({})],yr);var vr=rr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).format="raw",e.wrappedKey=new ArrayBuffer(0),e.unwrappingKey=new Ie,e.unwrapAlgorithm=new Ee,e.unwrappedKeyAlgorithm=new Ee,e.extractable=!1,e.keyUsage=[],e}return _createClass(r)}(Ve);vr.INDEX=Ve.INDEX,vr.ACTION="crypto/subtle/unwrapKey",le([g({id:rr.INDEX++,required:!0,type:"string"})],vr.prototype,"format",void 0),le([g({id:rr.INDEX++,required:!0,converter:v})],vr.prototype,"wrappedKey",void 0),le([g({id:rr.INDEX++,required:!0,parser:Ie})],vr.prototype,"unwrappingKey",void 0),le([g({id:rr.INDEX++,required:!0,parser:Ee})],vr.prototype,"unwrapAlgorithm",void 0),le([g({id:rr.INDEX++,required:!0,parser:Ee})],vr.prototype,"unwrappedKeyAlgorithm",void 0),le([g({id:rr.INDEX++,type:"bool"})],vr.prototype,"extractable",void 0),le([g({id:rr.INDEX++,type:"string",repeated:!0})],vr.prototype,"keyUsage",void 0),vr=rr=le([d({})],vr);var dr=nr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).format="raw",e.key=new Ie,e.wrappingKey=new Ie,e.wrapAlgorithm=new Ee,e}return _createClass(r)}(Ve);dr.INDEX=Ve.INDEX,dr.ACTION="crypto/subtle/wrapKey",le([g({id:nr.INDEX++,required:!0,type:"string"})],dr.prototype,"format",void 0),le([g({id:nr.INDEX++,required:!0,parser:Ie})],dr.prototype,"key",void 0),le([g({id:nr.INDEX++,required:!0,parser:Ie})],dr.prototype,"wrappingKey",void 0),le([g({id:nr.INDEX++,required:!0,parser:Ee})],dr.prototype,"wrapAlgorithm",void 0),dr=nr=le([d({})],dr);var gr=ir=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).format="raw",e.key=new Ie,e}return _createClass(r)}(Ve);gr.INDEX=Ve.INDEX,gr.ACTION="crypto/subtle/exportKey",le([g({id:ir.INDEX++,type:"string",required:!0})],gr.prototype,"format",void 0),le([g({id:ir.INDEX++,required:!0,parser:Ie})],gr.prototype,"key",void 0),gr=ir=le([d({})],gr);var mr=ar=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).format="raw",e.keyData=new ArrayBuffer(0),e.algorithm=new Ee,e.extractable=!1,e.keyUsages=[],e}return _createClass(r)}(Ve);mr.INDEX=Ve.INDEX,mr.ACTION="crypto/subtle/importKey",le([g({id:ar.INDEX++,type:"string",required:!0})],mr.prototype,"format",void 0),le([g({id:ar.INDEX++,required:!0,converter:v})],mr.prototype,"keyData",void 0),le([g({id:ar.INDEX++,required:!0,parser:Ee})],mr.prototype,"algorithm",void 0),le([g({id:ar.INDEX++,required:!0,type:"bool"})],mr.prototype,"extractable",void 0),le([g({id:ar.INDEX++,type:"string",repeated:!0})],mr.prototype,"keyUsages",void 0),mr=ar=le([d({})],mr);var _r=function(e){_inherits(n,e);var t,r=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),(t=r.call(this)).client=e,t.onEvent=t.onEvent.bind(_assertThisInitialized(t)),t.client.on("listening",(function(){t.client.on("event",t.onEvent)})).on("close",(function(){t.client.removeListener("event",t.onEvent)})),t}return _createClass(n,[{key:"readers",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.send(new Xe);case 2:return t=e.sent,e.abrupt("return",JSON.parse(l.ToString(t)));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"on",value:function(e,t){return _get5(_getPrototypeOf(n.prototype),"on",this).call(this,e,t)}},{key:"emit",value:function(e){for(var t,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return(t=_get5(_getPrototypeOf(n.prototype),"emit",this)).call.apply(t,[this,e].concat(i))}},{key:"onEvent",value:function(e){var t=this;_asyncToGenerator(_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e.action,r.next=r.t0===je.ACTION?3:r.t0===Ge.ACTION?9:15;break;case 3:return r.t1=t,r.next=6,je.importProto(e);case 6:return r.t2=r.sent,r.t1.onInsert.call(r.t1,r.t2),r.abrupt("break",15);case 9:return r.t3=t,r.next=12,Ge.importProto(e);case 12:return r.t4=r.sent,r.t3.onRemove.call(r.t3,r.t4),r.abrupt("break",15);case 15:case"end":return r.stop()}}),r)})))().catch((function(e){return t.emit("error",e)}))}},{key:"onInsert",value:function(e){this.emit("insert",e)}},{key:"onRemove",value:function(e){this.emit("remove",e)}}]),n}(k);function kr(e,t){return wr.apply(this,arguments)}function wr(){return(wr=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,a,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.thumbprint();case 2:return n=e.sent,e.next=5,r.thumbprint();case 5:return i=e.sent,a=l.FromHex(n+i),e.next=9,D().crypto.subtle.digest("SHA-256",a);case 9:return o=e.sent,e.abrupt("return",parseInt(l.ToHex(o),16).toString().substr(2,6));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var br=_createClass((function e(t,r){_classCallCheck(this,e),this.target=t,this.event=r})),Cr=function(e){_inherits(r,_wrapNativeSuper(Error));var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this,e.message)).name="CryptoServerError",n.code=e.code,n.type=e.type,n}return _createClass(r)}(),xr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(br),Sr=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i,a){var o;return _classCallCheck(this,r),(o=t.call(this,e,"close")).remoteAddress=n,o.reasonCode=i,o.description=a,o}return _createClass(r)}(xr),Er=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var i;return _classCallCheck(this,r),(i=t.call(this,e,"error")).error=n,i}return _createClass(r)}(xr),Ar=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var i;return _classCallCheck(this,r),(i=t.call(this,e,"listening")).address=n,i}return _createClass(r)}(xr);function Nr(){return"undefined"!=typeof self&&/firefox\/([\w\.-]+)$/i.test(self.navigator.userAgent)}function Ir(){return"undefined"!=typeof self&&/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i.test(self.navigator.userAgent)}function Br(){return"undefined"!=typeof self&&/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i.test(self.navigator.userAgent)}var Rr,Tr={name:"ECDH",namedCurve:"P-256"},Dr={name:"ECDSA",namedCurve:"P-256"},Or={name:"AES-CBC",iv:new ArrayBuffer(16)};function Kr(e){return Ur.apply(this,arguments)}function Ur(){return(Ur=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,a,o,s,u,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("ECDH"===(r=t.algorithm.name.toUpperCase())||"ECDSA"===r){e.next=3;break}throw new Error("Error: Unsupported asymmetric key algorithm.");case 3:if("public"===t.type){e.next=5;break}throw new Error("Error: Expected key type to be public but it was not.");case 5:return e.next=7,D().crypto.subtle.exportKey("jwk",t);case 7:if((n=e.sent).x&&n.y){e.next=10;break}throw new Error("Wrong JWK data for EC public key. Parameters x and y are required.");case 10:return i=l.FromBase64Url(n.x),a=l.FromBase64Url(n.y),o=l.ToBinary(i)+l.ToBinary(a),s=t,u=l.FromBinary(o),e.t0=l,e.next=18,D().crypto.subtle.digest("SHA-256",u);case 18:return e.t1=e.sent,c=e.t0.ToHex.call(e.t0,e.t1),e.abrupt("return",{id:c,key:s,serialized:u});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pr(e,t){return Xr.apply(this,arguments)}function Xr(){return(Xr=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Kr(r);case 2:n=e.sent,t.id=n.id,t.key=n.key,t.serialized=n.serialized;case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(Rr||(Rr={}));var Lr=function(e){_inherits(c,e);var t,r,n,i,s,u=_createSuper(c);function c(e){var t;return _classCallCheck(this,c),(t=u.call(this)).stack={},t.messageCounter=0,t.storage=e,t}return _createClass(c,[{key:"state",get:function(){return this.socket?this.socket.readyState:Rr.closed}},{key:"connect",value:function(e,t){var r=this;return this.getServerInfo(e).then((function(n){var i=_slicedToArray(n.version.split(".").map((function(e){return parseInt(e,10)})),3),a=i[0],s=i[1];if(i[2],a<1||1===a&&s<2)throw new Error("Current version of WebCryptoSocket doesn't work with WebCryptoServer v".concat(n.version,". Please update your client to the latest version."));r.serviceInfo=n;var u="wss://".concat(e);r.socket=t?new o.default(u,void 0,t):new o.default(u),r.socket.binaryType="arraybuffer",r.socket.onerror=function(e){r.emit("error",new Er(r,e.error))},r.socket.onopen=function(){_asyncToGenerator(_regeneratorRuntime().mark((function t(){var i,a,o;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.storage.loadIdentity();case 2:if(i=t.sent){t.next=9;break}return t.next=6,X.create(1,0,0,Br()||Ir()||Nr());case 6:return i=t.sent,t.next=9,r.storage.saveIdentity(i);case 9:return a="0",t.next=12,Y.importProto(l.FromBase64(n.preKey));case 12:return o=t.sent,t.next=15,se.create(i,o);case 15:return r.cipher=t.sent,t.next=18,r.storage.saveRemoteIdentity(a,r.cipher.remoteIdentity);case 18:r.emit("listening",new Ar(r,e));case 19:case"end":return t.stop()}}),t)})))().catch((function(e){return r.emit("error",new Er(r,e))}))},r.socket.onclose=function(t){for(var n in r.stack)r.stack[n].reject(new Error("Cannot finish operation. Session was closed"));r.emit("close",new Sr(r,e,t.code,t.reason))},r.socket.onmessage=function(e){e.data instanceof ArrayBuffer&&F.importProto(e.data).then((function(e){if(!r.cipher)throw new Error("Client cipher is not initialized");return r.cipher.decrypt(e)})).then((function(e){r.onMessage(e)})).catch((function(e){r.emit("error",new Er(r,e))}))}})).catch((function(e){r.emit("error",new Er(r,e))})),this}},{key:"close",value:function(){this.socket&&this.socket.close()}},{key:"on",value:function(e,t){return _get5(_getPrototypeOf(c.prototype),"on",this).call(this,e,t)}},{key:"once",value:function(e,t){return _get5(_getPrototypeOf(c.prototype),"once",this).call(this,e,t)}},{key:"challenge",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cipher){e.next=2;break}throw new Error("Client cipher is not initialized");case 2:return e.abrupt("return",kr(this.cipher.remoteIdentity.signingKey,this.cipher.identity.signingKey.publicKey));case 3:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"isLoggedIn",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ue,e.next=3,this.send(t);case 3:return r=e.sent,e.abrupt("return",!!r&&!!new Uint8Array(r)[0]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"login",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Oe,e.next=3,this.send(t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"send",value:function(e){var t=this;return new Promise((function(r,n){t.checkSocketState(),e||(e=new xe),e.action=e.action,e.actionId=(t.messageCounter++).toString(),e.exportProto().then((function(e){if(!t.cipher)throw new Error("Client cipher is not initialized");return t.cipher.encrypt(e).then((function(e){return e.exportProto()}))})).then((function(i){if(!t.socket)throw new Error("Client socket is not initialized");t.stack[e.actionId]={resolve:r,reject:n},t.socket.send(i)})).catch(n)}))}},{key:"getServerInfo",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://".concat(t).concat("/.well-known/webcrypto-socket"),e.next=3,a.default(r);case 3:if(200===(n=e.sent).status){e.next=8;break}throw new Error("Cannot get wellknown link");case 8:return e.next=10,n.json();case 10:return i=e.sent,e.abrupt("return",i);case 12:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"checkSocketState",value:function(){if(this.state!==Rr.open)throw new Error("Socket connection is not open")}},{key:"onMessage",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,a,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe.importProto(t);case 2:if(r=e.sent,!(n=this.stack[r.actionId])){e.next=16;break}return delete this.stack[r.actionId],e.t0=Te,e.next=9,r.exportProto();case 9:return e.t1=e.sent,e.next=12,e.t0.importProto.call(e.t0,e.t1);case 12:(i=e.sent).error&&i.error.message?(a=i.error,o=new Cr(a),n.reject(o)):n.resolve(i.data),e.next=17;break;case 16:this.emit("event",r);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),c}(k);function jr(e,t){var r=0;if(1===e.length)return e[0];for(var n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function Hr(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=e,i=0,a=Math.pow(2,t),o=1;o<8;o++){if(e<a){var s=void 0;if(r<0)s=new ArrayBuffer(o),i=o;else{if(r<o)return new ArrayBuffer(0);s=new ArrayBuffer(r),i=r}for(var u=new Uint8Array(s),c=o-1;c>=0;c--){var l=Math.pow(2,c*t);u[i-c-1]=Math.floor(n/l),n-=u[i-c-1]*l}return s}a*=Math.pow(2,t)}return new ArrayBuffer(0)}function Gr(){for(var e=0,t=0,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];for(var a=0,o=n;a<o.length;a++)e+=o[a].length;for(var s=new ArrayBuffer(e),u=new Uint8Array(s),c=0,l=n;c<l.length;c++){var h=l[c];u.set(h,t),t+=h.length}return u}function Vr(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}for(var n=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(n),a=0;a<this.valueHex.byteLength;a++)i[a]=0;i[0]=128&e[0];for(var o=jr(i,8),s=new ArrayBuffer(this.valueHex.byteLength),u=new Uint8Array(s),c=0;c<this.valueHex.byteLength;c++)u[c]=e[c];return u[0]&=127,jr(u,8)-o}function Mr(e,t){var r=e.toString(10);if(t<r.length)return"";for(var n=t-r.length,i=new Array(n),a=0;a<n;a++)i[a]="0";return i.join("").concat(r)}function qr(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Fr(e){for(var t=0,r=0,n=0;n<e.length;n++)t+=e[n].byteLength;for(var i=new Uint8Array(t),a=0;a<e.length;a++){var o=e[a];i.set(new Uint8Array(o),r),r+=o.byteLength}return i.buffer}function Jr(e,t,r,n){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0&&(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",1)):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var zr=function(){function e(){_classCallCheck(this,e),this.items=[]}return _createClass(e,[{key:"write",value:function(e){this.items.push(e)}},{key:"final",value:function(){return Fr(this.items)}}]),e}(),Wr=[new Uint8Array([1])],Yr="0123456789",Zr="name",$r="valueHexView",Qr="",en=new ArrayBuffer(0),tn=new Uint8Array(0),rn="EndOfContent",nn="OCTET STRING",an="BIT STRING";function on(e){var t;return(t=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n;_classCallCheck(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];e=t.call.apply(t,[this].concat(a));var u=a[0]||{};return e.isHexOnly=null!==(n=u.isHexOnly)&&void 0!==n&&n,e.valueHexView=u.valueHex?s.toUint8Array(u.valueHex):tn,e}return _createClass(r,[{key:"valueHex",get:function(){return this.valueHexView.slice().buffer},set:function(e){this.valueHexView=new Uint8Array(e)}},{key:"fromBER",value:function(e,t,r){var n=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!Jr(this,n,t,r))return-1;var i=t+r;return this.valueHexView=n.subarray(t,i),this.valueHexView.length?(this.blockLength=r,i):(this.warnings.push("Zero buffer length"),t)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",en)}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{isHexOnly:this.isHexOnly,valueHex:l.ToHex(this.valueHexView)})}}]),r}(e)).NAME="hexBlock",t}var sn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.blockLength,n=void 0===r?0:r,i=t.error,a=void 0===i?Qr:i,o=t.warnings,u=void 0===o?[]:o,c=t.valueBeforeDecode,l=void 0===c?tn:c;_classCallCheck(this,e),this.blockLength=n,this.error=a,this.warnings=u,this.valueBeforeDecodeView=s.toUint8Array(l)}return _createClass(e,[{key:"valueBeforeDecode",get:function(){return this.valueBeforeDecodeView.slice().buffer},set:function(e){this.valueBeforeDecodeView=new Uint8Array(e)}},{key:"toJSON",value:function(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:l.ToHex(this.valueBeforeDecodeView)}}}],[{key:"blockName",value:function(){return this.NAME}}]),e}();sn.NAME="baseBlock";var un=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"fromBER",value:function(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}},{key:"toBER",value:function(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}]),r}(sn);un.NAME="valueBlock";var cn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n,i,a,o,u=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).idBlock,c=void 0===u?{}:u;return _classCallCheck(this,r),e=t.call(this),c?(e.isHexOnly=null!==(n=c.isHexOnly)&&void 0!==n&&n,e.valueHexView=c.valueHex?s.toUint8Array(c.valueHex):tn,e.tagClass=null!==(i=c.tagClass)&&void 0!==i?i:-1,e.tagNumber=null!==(a=c.tagNumber)&&void 0!==a?a:-1,e.isConstructed=null!==(o=c.isConstructed)&&void 0!==o&&o):(e.tagClass=-1,e.tagNumber=-1,e.isConstructed=!1),e}return _createClass(r,[{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",en}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){var r=new Uint8Array(1);if(!e){var n=this.tagNumber;t|=n&=31,r[0]=t}return r.buffer}if(!this.isHexOnly){var i=Hr(this.tagNumber,7),a=new Uint8Array(i),o=i.byteLength,s=new Uint8Array(o+1);if(s[0]=31|t,!e){for(var u=0;u<o-1;u++)s[u+1]=128|a[u];s[o]=a[o-1]}return s.buffer}var c=new Uint8Array(this.valueHexView.byteLength+1);if(c[0]=31|t,!e){for(var l=this.valueHexView,h=0;h<l.length-1;h++)c[h+1]=128|l[h];c[this.valueHexView.byteLength]=l[l.length-1]}return c.buffer}},{key:"fromBER",value:function(e,t,r){var n=s.toUint8Array(e);if(!Jr(this,n,t,r))return-1;var i=n.subarray(t,t+r);if(0===i.length)return this.error="Zero buffer length",-1;switch(192&i[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&i[0]),this.isHexOnly=!1;var a=31&i[0];if(31!==a)this.tagNumber=a,this.blockLength=1;else{for(var o=1,u=this.valueHexView=new Uint8Array(255),c=255;128&i[o];){if(u[o-1]=127&i[o],++o>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(o===c){c+=255;for(var l=new Uint8Array(c),h=0;h<u.length;h++)l[h]=u[h];u=this.valueHexView=new Uint8Array(c)}}this.blockLength=o+1,u[o-1]=127&i[o];for(var p=new Uint8Array(o),f=0;f<o;f++)p[f]=u[f];(u=this.valueHexView=new Uint8Array(o)).set(p),this.blockLength<=9?this.tagNumber=jr(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed})}}]),r}(on(sn));cn.NAME="identificationBlock";var ln=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n,i,a,o=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).lenBlock,s=void 0===o?{}:o;return _classCallCheck(this,r),(e=t.call(this)).isIndefiniteForm=null!==(n=s.isIndefiniteForm)&&void 0!==n&&n,e.longFormUsed=null!==(i=s.longFormUsed)&&void 0!==i&&i,e.length=null!==(a=s.length)&&void 0!==a?a:0,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=s.toUint8Array(e);if(!Jr(this,n,t,r))return-1;var i=n.subarray(t,t+r);if(0===i.length)return this.error="Zero buffer length",-1;if(255===i[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===i[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&i[0]),!1===this.longFormUsed)return this.length=i[0],this.blockLength=1,t+this.blockLength;var a=127&i[0];if(a>8)return this.error="Too big integer",-1;if(a+1>i.length)return this.error="End of input reached before message was fully decoded",-1;var o=t+1,u=n.subarray(o,o+a);return 0===u[a-1]&&this.warnings.push("Needlessly long encoded length"),this.length=jr(u,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=a+1,t+this.blockLength}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=128),e;if(this.longFormUsed){var n=Hr(this.length,8);if(n.byteLength>127)return this.error="Too big length",en;if(e=new ArrayBuffer(n.byteLength+1),r)return e;var i=new Uint8Array(n);(t=new Uint8Array(e))[0]=128|n.byteLength;for(var a=0;a<n.byteLength;a++)t[a+1]=i[a];return e}return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=this.length),e}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length})}}]),r}(sn);ln.NAME="lengthBlock";var hn={},pn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.name,a=void 0===i?Qr:i,o=n.optional,s=void 0!==o&&o,u=n.primitiveSchema,c=_objectWithoutProperties(n,_excluded),l=arguments.length>1?arguments[1]:void 0;return _classCallCheck(this,r),(e=t.call(this,c)).name=a,e.optional=s,u&&(e.primitiveSchema=u),e.idBlock=new cn(c),e.lenBlock=new ln(c),e.valueBlock=l?new l(c):new un(c),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"toBER",value:function(e,t){var r=t||new zr;t||fn(this);var n=this.idBlock.toBER(e);if(r.write(n),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{var i=this.valueBlock.toBER(e);this.lenBlock.length=i.byteLength;var a=this.lenBlock.toBER(e);r.write(a),r.write(i)}return t?en:r.final()}},{key:"toJSON",value:function(){var e=_objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional});return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}},{key:"toString",value:function(){return"ascii"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ascii")?this.onAsciiEncoding():l.ToHex(this.toBER())}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(l.ToHex(this.valueBlock.valueBeforeDecodeView))}},{key:"isEqual",value:function(e){return this===e||e instanceof this.constructor&&function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),i=0;i<r.length;i++)if(r[i]!==n[i])return!1;return!0}(this.toBER(),e.toBER())}}]),r}(sn);function fn(e){if(e instanceof hn.Constructed){var t,r=_createForOfIteratorHelper(e.valueBlock.value);try{for(r.s();!(t=r.n()).done;)fn(t.value)&&(e.lenBlock.isIndefiniteForm=!0)}catch(e){r.e(e)}finally{r.f()}}return!!e.lenBlock.isIndefiniteForm}pn.NAME="BaseBlock";var yn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=void 0===i?Qr:i,o=_objectWithoutProperties(n,_excluded2),s=arguments.length>1?arguments[1]:void 0;return _classCallCheck(this,r),e=t.call(this,o,s),a&&e.fromString(a),e}return _createClass(r,[{key:"getValue",value:function(){return this.valueBlock.value}},{key:"setValue",value:function(e){this.valueBlock.value=e}},{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : '").concat(this.valueBlock.value,"'")}}]),r}(pn);yn.NAME="BaseStringBlock";var vn,dn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.isHexOnly,a=void 0===i||i,o=_objectWithoutProperties(n,_excluded3);return _classCallCheck(this,r),(e=t.call(this,o)).isHexOnly=a,e}return _createClass(r)}(on(un));dn.NAME="PrimitiveValueBlock";var gn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,dn)).idBlock.isConstructed=!1,e}return _createClass(r)}(pn);function mn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,n=t,i=new pn({},un),a=new sn;if(!Jr(a,e,t,r))return i.error=a.error,{offset:-1,result:i};if(!e.subarray(t,t+r).length)return i.error="Zero buffer length",{offset:-1,result:i};var o=i.idBlock.fromBER(e,t,r);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),-1===o)return i.error=i.idBlock.error,{offset:-1,result:i};if(t=o,r-=i.idBlock.blockLength,o=i.lenBlock.fromBER(e,t,r),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),-1===o)return i.error=i.lenBlock.error,{offset:-1,result:i};if(t=o,r-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};var s=pn;if(1===i.idBlock.tagClass){if(i.idBlock.tagNumber>=37&&!1===i.idBlock.isHexOnly)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};s=hn.EndOfContent;break;case 1:s=hn.Boolean;break;case 2:s=hn.Integer;break;case 3:s=hn.BitString;break;case 4:s=hn.OctetString;break;case 5:s=hn.Null;break;case 6:s=hn.ObjectIdentifier;break;case 10:s=hn.Enumerated;break;case 12:s=hn.Utf8String;break;case 13:s=hn.RelativeObjectIdentifier;break;case 14:s=hn.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:s=hn.Sequence;break;case 17:s=hn.Set;break;case 18:s=hn.NumericString;break;case 19:s=hn.PrintableString;break;case 20:s=hn.TeletexString;break;case 21:s=hn.VideotexString;break;case 22:s=hn.IA5String;break;case 23:s=hn.UTCTime;break;case 24:s=hn.GeneralizedTime;break;case 25:s=hn.GraphicString;break;case 26:s=hn.VisibleString;break;case 27:s=hn.GeneralString;break;case 28:s=hn.UniversalString;break;case 29:s=hn.CharacterString;break;case 30:s=hn.BmpString;break;case 31:s=hn.DATE;break;case 32:s=hn.TimeOfDay;break;case 33:s=hn.DateTime;break;case 34:s=hn.Duration;break;default:var u=i.idBlock.isConstructed?new hn.Constructed:new hn.Primitive;u.idBlock=i.idBlock,u.lenBlock=i.lenBlock,u.warnings=i.warnings,i=u}}else s=i.idBlock.isConstructed?hn.Constructed:hn.Primitive;return o=(i=function(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}(i,s)).fromBER(e,t,i.lenBlock.isIndefiniteForm?r:i.lenBlock.length),i.valueBeforeDecodeView=e.subarray(n,n+i.blockLength),{offset:o,result:i}}function _n(e){if(!e.byteLength){var t=new pn({},un);return t.error="Input buffer has zero length",{offset:-1,result:t}}return mn(s.toUint8Array(e).slice(),0,e.byteLength)}vn=gn,hn.Primitive=vn,gn.NAME="PRIMITIVE";var kn,wn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=void 0===i?[]:i,o=n.isIndefiniteForm,s=void 0!==o&&o,u=_objectWithoutProperties(n,_excluded4);return _classCallCheck(this,r),(e=t.call(this,u)).value=a,e.isIndefiniteForm=s,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=s.toUint8Array(e);if(!Jr(this,n,t,r))return-1;if(this.valueBeforeDecodeView=n.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;for(var i=t;(this.isIndefiniteForm?1:r)>0;){var a=mn(n,i,r);if(-1===a.offset)return this.error=a.result.error,this.warnings.concat(a.result.warnings),-1;if(i=a.offset,this.blockLength+=a.result.blockLength,r-=a.result.blockLength,this.value.push(a.result),this.isIndefiniteForm&&a.result.constructor.NAME===rn)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===rn?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}},{key:"toBER",value:function(e,t){for(var r=t||new zr,n=0;n<this.value.length;n++)this.value[n].toBER(e,r);return t?en:r.final()}},{key:"toJSON",value:function(){var e,t=_objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{isIndefiniteForm:this.isIndefiniteForm,value:[]}),n=_createForOfIteratorHelper(this.value);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.value.push(i.toJSON())}}catch(e){n.e(e)}finally{n.f()}return t}}]),r}(un);wn.NAME="ConstructedValueBlock";var bn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,wn)).idBlock.isConstructed=!0,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"onAsciiEncoding",value:function(){var e,t=[],r=_createForOfIteratorHelper(this.valueBlock.value);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.toString("ascii").split("\n").map((function(e){return"  ".concat(e)})).join("\n"))}}catch(e){r.e(e)}finally{r.f()}var i=3===this.idBlock.tagClass?"[".concat(this.idBlock.tagNumber,"]"):this.constructor.NAME;return t.length?"".concat(i," :\n").concat(t.join("\n")):"".concat(i," :")}}]),r}(pn);kn=bn,hn.Constructed=kn,bn.NAME="CONSTRUCTED";var Cn,xn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(e){return en}}]),r}(un);xn.override="EndOfContentValueBlock";var Sn,En=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,xn)).idBlock.tagClass=1,e.idBlock.tagNumber=0,e}return _createClass(r)}(pn);Cn=En,hn.EndOfContent=Cn,En.NAME=rn;var An=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,un)).idBlock.tagClass=1,e.idBlock.tagNumber=5,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}},{key:"toBER",value:function(e,t){var r=new ArrayBuffer(2);if(!e){var n=new Uint8Array(r);n[0]=5,n[1]=0}return t&&t.write(r),r}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME)}}]),r}(pn);Sn=An,hn.Null=Sn,An.NAME="NULL";var Nn,In=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=_objectWithoutProperties(n,_excluded5);return _classCallCheck(this,r),e=t.call(this,a),a.valueHex?e.valueHexView=s.toUint8Array(a.valueHex):e.valueHexView=new Uint8Array(1),i&&(e.value=i),e}return _createClass(r,[{key:"value",get:function(){var e,t=_createForOfIteratorHelper(this.valueHexView);try{for(t.s();!(e=t.n()).done;)if(e.value>0)return!0}catch(e){t.e(e)}finally{t.f()}return!1},set:function(e){this.valueHexView[0]=e?255:0}},{key:"fromBER",value:function(e,t,r){var n=s.toUint8Array(e);return Jr(this,n,t,r)?(this.valueHexView=n.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,Vr.call(this),this.blockLength=r,t+r):-1}},{key:"toBER",value:function(){return this.valueHexView.slice()}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{value:this.value})}}]),r}(on(un));In.NAME="BooleanValueBlock";var Bn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,In)).idBlock.tagClass=1,e.idBlock.tagNumber=1,e}return _createClass(r,[{key:"getValue",value:function(){return this.valueBlock.value}},{key:"setValue",value:function(e){this.valueBlock.value=e}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.getValue)}}]),r}(pn);Nn=Bn,hn.Boolean=Nn,Bn.NAME="BOOLEAN";var Rn,Tn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.isConstructed,a=void 0!==i&&i,o=_objectWithoutProperties(n,_excluded6);return _classCallCheck(this,r),(e=t.call(this,o)).isConstructed=a,e}return _createClass(r,[{key:"fromBER",value:function(e,t,n){var i=0;if(this.isConstructed){if(this.isHexOnly=!1,-1===(i=wn.prototype.fromBER.call(this,e,t,n)))return i;for(var a=0;a<this.value.length;a++){var o=this.value[a].constructor.NAME;if(o===rn){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==nn)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=_get5(_getPrototypeOf(r.prototype),"fromBER",this).call(this,e,t,n),this.blockLength=n;return i}},{key:"toBER",value:function(e,t){return this.isConstructed?wn.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{isConstructed:this.isConstructed})}}]),r}(on(wn));Tn.NAME="OctetStringValueBlock";var Dn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=a.idBlock,s=void 0===o?{}:o,u=a.lenBlock,c=void 0===u?{}:u,l=_objectWithoutProperties(a,_excluded7);return _classCallCheck(this,r),null!==(n=l.isConstructed)&&void 0!==n||(l.isConstructed=!!(null===(i=l.value)||void 0===i?void 0:i.length)),(e=t.call(this,_objectSpread({idBlock:_objectSpread({isConstructed:l.isConstructed},s),lenBlock:_objectSpread(_objectSpread({},c),{},{isIndefiniteForm:!!l.isIndefiniteForm})},l),Tn)).idBlock.tagClass=1,e.idBlock.tagNumber=4,e}return _createClass(r,[{key:"fromBER",value:function(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===n)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){var i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(i.byteLength){var a=mn(i,0,i.byteLength);-1!==a.offset&&a.offset===n&&(this.valueBlock.value=[a.result])}}catch(e){}}return _get5(_getPrototypeOf(r.prototype),"fromBER",this).call(this,e,t,n)}},{key:"onAsciiEncoding",value:function(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?bn.prototype.onAsciiEncoding.call(this):"".concat(this.constructor.NAME," : ").concat(l.ToHex(this.valueBlock.valueHexView))}},{key:"getValue",value:function(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;var e,t=[],n=_createForOfIteratorHelper(this.valueBlock.value);try{for(n.s();!(e=n.n()).done;){var i=e.value;i instanceof r&&t.push(i.valueBlock.valueHexView)}}catch(e){n.e(e)}finally{n.f()}return s.concat(t)}}]),r}(pn);Rn=Dn,hn.OctetString=Rn,Dn.NAME=nn;var On,Kn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.unusedBits,a=void 0===i?0:i,o=n.isConstructed,s=void 0!==o&&o,u=_objectWithoutProperties(n,_excluded8);return _classCallCheck(this,r),(e=t.call(this,u)).unusedBits=a,e.isConstructed=s,e.blockLength=e.valueHexView.byteLength,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){if(!r)return t;var n=-1;if(this.isConstructed){if(-1===(n=wn.prototype.fromBER.call(this,e,t,r)))return n;var i,a=_createForOfIteratorHelper(this.value);try{for(a.s();!(i=a.n()).done;){var o=i.value,u=o.constructor.NAME;if(u===rn){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(u!==an)return this.error="BIT STRING may consists of BIT STRINGs only",-1;var c=o.valueBlock;if(this.unusedBits>0&&c.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=c.unusedBits}}catch(e){a.e(e)}finally{a.f()}return n}var l=s.toUint8Array(e);if(!Jr(this,l,t,r))return-1;var h=l.subarray(t,t+r);if(this.unusedBits=h[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){var p=h.subarray(1);try{if(p.byteLength){var f=mn(p,0,p.byteLength);-1!==f.offset&&f.offset===r-1&&(this.value=[f.result])}}catch(e){}}return this.valueHexView=h.subarray(1),this.blockLength=h.length,t+r}},{key:"toBER",value:function(e,t){if(this.isConstructed)return wn.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return en;var r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{unusedBits:this.unusedBits,isConstructed:this.isConstructed})}}]),r}(on(wn));Kn.NAME="BitStringValueBlock";var Un,Pn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=a.idBlock,s=void 0===o?{}:o,u=a.lenBlock,c=void 0===u?{}:u,l=_objectWithoutProperties(a,_excluded9);return _classCallCheck(this,r),null!==(n=l.isConstructed)&&void 0!==n||(l.isConstructed=!!(null===(i=l.value)||void 0===i?void 0:i.length)),(e=t.call(this,_objectSpread({idBlock:_objectSpread({isConstructed:l.isConstructed},s),lenBlock:_objectSpread(_objectSpread({},c),{},{isIndefiniteForm:!!l.isIndefiniteForm})},l),Kn)).idBlock.tagClass=1,e.idBlock.tagNumber=3,e}return _createClass(r,[{key:"fromBER",value:function(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,_get5(_getPrototypeOf(r.prototype),"fromBER",this).call(this,e,t,n)}},{key:"onAsciiEncoding",value:function(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return bn.prototype.onAsciiEncoding.call(this);var e,t=[],r=_createForOfIteratorHelper(this.valueBlock.valueHexView);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.toString(2).padStart(8,"0"))}}catch(e){r.e(e)}finally{r.f()}var i=t.join("");return"".concat(this.constructor.NAME," : ").concat(i.substring(0,i.length-this.valueBlock.unusedBits))}}]),r}(pn);function Xn(e,t){for(var r=new Uint8Array([0]),n=new Uint8Array(e),i=new Uint8Array(t),a=n.slice(0),o=a.length-1,s=i.slice(0),u=s.length-1,c=0,l=0,h=u<o?o:u;h>=0;h--,l++)c=1==l<s.length?a[o-l]+s[u-l]+r[0]:a[o-l]+r[0],r[0]=c/10,1==l>=a.length?a=Gr(new Uint8Array([c%10]),a):a[o-l]=c%10;return r[0]>0&&(a=Gr(r,a)),a}function Ln(e){if(e>=Wr.length)for(var t=Wr.length;t<=e;t++){for(var r=new Uint8Array([0]),n=Wr[t-1].slice(0),i=n.length-1;i>=0;i--){var a=new Uint8Array([(n[i]<<1)+r[0]]);r[0]=a[0]/10,n[i]=a[0]%10}r[0]>0&&(n=Gr(r,n)),Wr.push(n)}return Wr[e]}function jn(e,t){for(var r,n=0,i=new Uint8Array(e),a=new Uint8Array(t),o=i.slice(0),s=o.length-1,u=a.slice(0),c=u.length-1,l=0,h=c;h>=0;h--,l++)1==(r=o[s-l]-u[c-l]-n)<0?(n=1,o[s-l]=r+10):(n=0,o[s-l]=r);if(n>0)for(var p=s-c+1;p>=0;p--,l++){if(!((r=o[s-l]-n)<0)){n=0,o[s-l]=r;break}n=1,o[s-l]=r+10}return o.slice()}On=Pn,hn.BitString=On,Pn.NAME=an;var Hn,Gn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=_objectWithoutProperties(n,_excluded10);return _classCallCheck(this,r),(e=t.call(this,a))._valueDec=0,void 0!==i&&(e.valueDec=i),e}return _createClass(r,[{key:"setValueHex",value:function(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=Vr.call(this)))}},{key:"valueDec",get:function(){return this._valueDec},set:function(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){for(var t=e<0?-1*e:e,r=128,n=1;n<8;n++){if(t<=r){if(e<0){var i=Hr(r-t,8,n);return new Uint8Array(i)[0]|=128,i}var a=Hr(t,8,n),o=new Uint8Array(a);if(128&o[0]){var s=a.slice(0),u=new Uint8Array(s);a=new ArrayBuffer(a.byteLength+1),o=new Uint8Array(a);for(var c=0;c<s.byteLength;c++)o[c+1]=u[c];o[0]=0}return a}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(e))}},{key:"fromDER",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.fromBER(e,t,r);if(-1===i)return i;var a=this.valueHexView;return 0===a[0]&&0!=(128&a[1])?this.valueHexView=a.subarray(1):0!==n&&a.length<n&&(n-a.length>1&&(n=a.length+1),this.valueHexView=a.subarray(n-a.length)),i}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.valueHexView;switch(!0){case 0!=(128&t[0]):var r=new Uint8Array(this.valueHexView.length+1);r[0]=0,r.set(t,1),this.valueHexView=r;break;case 0===t[0]&&0==(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}},{key:"fromBER",value:function(e,t,n){var i=_get5(_getPrototypeOf(r.prototype),"fromBER",this).call(this,e,t,n);return-1===i||this.setValueHex(),i}},{key:"toBER",value:function(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec})}},{key:"toString",value:function(){for(var e,t=8*this.valueHexView.length-1,r=new Uint8Array(8*this.valueHexView.length/3),n=0,i=this.valueHexView,a="",o=!1,s=i.byteLength-1;s>=0;s--){e=i[s];for(var u=0;u<8;u++)1==(1&e)&&(n===t?(r=jn(Ln(n),r),a="-"):r=Xn(r,Ln(n))),n++,e>>=1}for(var c=0;c<r.length;c++)r[c]&&(o=!0),o&&(a+=Yr.charAt(r[c]));return!1===o&&(a+=Yr.charAt(0)),a}}]),r}(on(un));Un=Gn,Gn.NAME="IntegerValueBlock",Object.defineProperty(Un.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var Vn,Mn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,Gn)).idBlock.tagClass=1,e.idBlock.tagNumber=2,e}return _createClass(r,[{key:"toBigInt",value:function(){return qr(),BigInt(this.valueBlock.toString())}},{key:"convertToDER",value:function(){var e=new r({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){return new r({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString())}}],[{key:"fromBigInt",value:function(e){qr();var t=BigInt(e),n=new zr,i=t.toString(16).replace(/^-/,""),a=new Uint8Array(l.FromHex(i));if(t<0){var o=new Uint8Array(a.length+(128&a[0]?1:0));o[0]|=128;var u=BigInt("0x".concat(l.ToHex(o)))+t,c=s.toUint8Array(l.FromHex(u.toString(16)));c[0]|=128,n.write(c)}else 128&a[0]&&n.write(new Uint8Array([0])),n.write(a);return new r({valueHex:n.final()})}}]),r}(pn);Hn=Mn,hn.Integer=Hn,Mn.NAME="INTEGER";var qn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=10,e}return _createClass(r)}(Mn);Vn=qn,hn.Enumerated=Vn,qn.NAME="ENUMERATED";var Fn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.valueDec,a=void 0===i?-1:i,o=n.isFirstSid,s=void 0!==o&&o,u=_objectWithoutProperties(n,_excluded11);return _classCallCheck(this,r),(e=t.call(this,u)).valueDec=a,e.isFirstSid=s,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){if(!r)return t;var n=s.toUint8Array(e);if(!Jr(this,n,t,r))return-1;var i=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(var a=0;a<r&&(this.valueHexView[a]=127&i[a],this.blockLength++,0!=(128&i[a]));a++);for(var o=new Uint8Array(this.blockLength),u=0;u<this.blockLength;u++)o[u]=this.valueHexView[u];return this.valueHexView=o,0!=(128&i[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=jr(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"valueBigInt",set:function(e){qr();for(var t=BigInt(e).toString(2);t.length%7;)t="0"+t;for(var r=new Uint8Array(t.length/7),n=0;n<r.length;n++)r[n]=parseInt(t.slice(7*n,7*n+7),2)+(n+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}},{key:"toBER",value:function(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);for(var t=this.valueHexView,r=new Uint8Array(this.blockLength),n=0;n<this.blockLength-1;n++)r[n]=128|t[n];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}var i=Hr(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",en;var a=new Uint8Array(i.byteLength);if(!e){for(var o=new Uint8Array(i),s=i.byteLength-1,u=0;u<s;u++)a[u]=128|o[u];a[s]=o[s]}return a}},{key:"toString",value:function(){var e="";if(this.isHexOnly)e=l.ToHex(this.valueHexView);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec,isFirstSid:this.isFirstSid})}}]),r}(on(un));Fn.NAME="sidBlock";var Jn,zn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=void 0===i?Qr:i,o=_objectWithoutProperties(n,_excluded12);return _classCallCheck(this,r),(e=t.call(this,o)).value=[],a&&e.fromString(a),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var i=new Fn;if(-1===(n=i.fromBER(e,n,r)))return this.blockLength=0,this.error=i.error,n;0===this.value.length&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,r-=i.blockLength,this.value.push(i)}return n}},{key:"toBER",value:function(e){for(var t=[],r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,en;t.push(n)}return Fr(t)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="",i=!1;do{if(n=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1,i){var a=this.value[0],o=0;switch(a.valueDec){case 0:break;case 1:o=40;break;case 2:o=80;break;default:return void(this.value=[])}var s=parseInt(n,10);if(isNaN(s))return;a.valueDec=s+o,i=!1}else{var u=new Fn;if(n>Number.MAX_SAFE_INTEGER){qr();var c=BigInt(n);u.valueBigInt=c}else if(u.valueDec=parseInt(n,10),isNaN(u.valueDec))return;this.value.length||(u.isFirstSid=!0,i=!0),this.value.push(u)}}while(-1!==r)}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),t?(n="{".concat(n,"}"),this.value[r].isFirstSid?e="2.{".concat(n," - 80}"):e+=n):e+=n}return e}},{key:"toJSON",value:function(){for(var e=_objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{value:this.toString(),sidArray:[]}),t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}]),r}(un);zn.NAME="ObjectIdentifierValueBlock";var Wn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,zn)).idBlock.tagClass=1,e.idBlock.tagNumber=6,e}return _createClass(r,[{key:"getValue",value:function(){return this.valueBlock.toString()}},{key:"setValue",value:function(e){this.valueBlock.fromString(e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{value:this.getValue()})}}]),r}(pn);Jn=Wn,hn.ObjectIdentifier=Jn,Wn.NAME="OBJECT IDENTIFIER";var Yn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.valueDec,a=void 0===i?0:i,o=_objectWithoutProperties(n,_excluded13);return _classCallCheck(this,r),(e=t.call(this,o)).valueDec=a,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var n=s.toUint8Array(e);if(!Jr(this,n,t,r))return-1;var i=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(var a=0;a<r&&(this.valueHexView[a]=127&i[a],this.blockLength++,0!=(128&i[a]));a++);for(var o=new Uint8Array(this.blockLength),u=0;u<this.blockLength;u++)o[u]=this.valueHexView[u];return this.valueHexView=o,0!=(128&i[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=jr(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);for(var t=this.valueHexView,r=new Uint8Array(this.blockLength),n=0;n<this.blockLength-1;n++)r[n]=128|t[n];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}var i=Hr(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",en;var a=new Uint8Array(i.byteLength);if(!e){for(var o=new Uint8Array(i),s=i.byteLength-1,u=0;u<s;u++)a[u]=128|o[u];a[s]=o[s]}return a.buffer}},{key:"toString",value:function(){return this.isHexOnly?l.ToHex(this.valueHexView):this.valueDec.toString()}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec})}}]),r}(on(sn));Yn.NAME="relativeSidBlock";var Zn,$n=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=void 0===i?Qr:i,o=_objectWithoutProperties(n,_excluded14);return _classCallCheck(this,r),(e=t.call(this,o)).value=[],a&&e.fromString(a),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var i=new Yn;if(-1===(n=i.fromBER(e,n,r)))return this.blockLength=0,this.error=i.error,n;this.blockLength+=i.blockLength,r-=i.blockLength,this.value.push(i)}return n}},{key:"toBER",value:function(e,t){for(var r=[],n=0;n<this.value.length;n++){var i=this.value[n].toBER(e);if(0===i.byteLength)return this.error=this.value[n].error,en;r.push(i)}return Fr(r)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="";do{n=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1;var i=new Yn;if(i.valueDec=parseInt(n,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),e+=t?n="{".concat(n,"}"):n}return e}},{key:"toJSON",value:function(){for(var e=_objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{value:this.toString(),sidArray:[]}),t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}]),r}(un);$n.NAME="RelativeObjectIdentifierValueBlock";var Qn,ei=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,$n)).idBlock.tagClass=1,e.idBlock.tagNumber=13,e}return _createClass(r,[{key:"getValue",value:function(){return this.valueBlock.toString()}},{key:"setValue",value:function(e){this.valueBlock.fromString(e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{value:this.getValue()})}}]),r}(pn);Zn=ei,hn.RelativeObjectIdentifier=Zn,ei.NAME="RelativeObjectIdentifier";var ti,ri=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=16,e}return _createClass(r)}(bn);Qn=ri,hn.Sequence=Qn,ri.NAME="SEQUENCE";var ni=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=17,e}return _createClass(r)}(bn);ti=ni,hn.Set=ti,ni.NAME="SET";var ii=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=_extends({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return _classCallCheck(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value=Qr,e}return _createClass(r,[{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{value:this.value})}}]),r}(on(un));ii.NAME="StringValueBlock";var ai=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(ii);ai.NAME="SimpleStringValueBlock";var oi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e=_extends({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return _classCallCheck(this,r),t.call(this,e,ai)}return _createClass(r,[{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,s.toUint8Array(e))}},{key:"fromString",value:function(e){for(var t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}]),r}(yn);oi.NAME="SIMPLE STRING";var si,ui=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"fromBuffer",value:function(e){this.valueBlock.valueHexView=s.toUint8Array(e);try{this.valueBlock.value=l.ToUtf8String(e)}catch(t){this.warnings.push('Error during "decodeURIComponent": '.concat(t,", using raw string")),this.valueBlock.value=l.ToBinary(e)}}},{key:"fromString",value:function(e){this.valueBlock.valueHexView=new Uint8Array(l.FromUtf8String(e)),this.valueBlock.value=e}}]),r}(oi);ui.NAME="Utf8StringValueBlock";var ci=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=12,e}return _createClass(r)}(ui);si=ci,hn.Utf8String=si,ci.NAME="UTF8String";var li,hi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"fromBuffer",value:function(e){this.valueBlock.value=l.ToUtf16String(e),this.valueBlock.valueHexView=s.toUint8Array(e)}},{key:"fromString",value:function(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(l.FromUtf16String(e))}}]),r}(oi);hi.NAME="BmpStringValueBlock";var pi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=_extends({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=30,e}return _createClass(r)}(hi);li=pi,hn.BmpString=li,pi.NAME="BMPString";var fi,yi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"fromBuffer",value:function(e){for(var t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=4)r[n]=r[n+3],r[n+1]=r[n+2],r[n+2]=0,r[n+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){for(var t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t),n=0;n<t;n++){var i=Hr(e.charCodeAt(n),8),a=new Uint8Array(i);if(!(a.length>4))for(var o=4-a.length,s=a.length-1;s>=0;s--)r[4*n+s+o]=a[s]}this.valueBlock.value=e}}]),r}(oi);yi.NAME="UniversalStringValueBlock";var vi,di=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=_extends({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=28,e}return _createClass(r)}(yi);fi=di,hn.UniversalString=fi,di.NAME="UniversalString";var gi,mi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=18,e}return _createClass(r)}(oi);vi=mi,hn.NumericString=vi,mi.NAME="NumericString";var _i,ki=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=19,e}return _createClass(r)}(oi);gi=ki,hn.PrintableString=gi,ki.NAME="PrintableString";var wi,bi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=20,e}return _createClass(r)}(oi);_i=bi,hn.TeletexString=_i,bi.NAME="TeletexString";var Ci,xi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=21,e}return _createClass(r)}(oi);wi=xi,hn.VideotexString=wi,xi.NAME="VideotexString";var Si,Ei=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=22,e}return _createClass(r)}(oi);Ci=Ei,hn.IA5String=Ci,Ei.NAME="IA5String";var Ai,Ni=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=25,e}return _createClass(r)}(oi);Si=Ni,hn.GraphicString=Si,Ni.NAME="GraphicString";var Ii,Bi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=26,e}return _createClass(r)}(oi);Ai=Bi,hn.VisibleString=Ai,Bi.NAME="VisibleString";var Ri,Ti=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=27,e}return _createClass(r)}(oi);Ii=Ti,hn.GeneralString=Ii,Ti.NAME="GeneralString";var Di,Oi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=29,e}return _createClass(r)}(oi);Ri=Oi,hn.CharacterString=Ri,Oi.NAME="CharacterString";var Ki,Ui=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=n.valueDate,o=_objectWithoutProperties(n,_excluded15);if(_classCallCheck(this,r),(e=t.call(this,o)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,i){e.fromString(i),e.valueBlock.valueHexView=new Uint8Array(i.length);for(var s=0;s<i.length;s++)e.valueBlock.valueHexView[s]=i.charCodeAt(s)}return a&&(e.fromDate(a),e.valueBlock.valueHexView=new Uint8Array(e.toBuffer())),e.idBlock.tagClass=1,e.idBlock.tagNumber=23,e}return _createClass(r,[{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,s.toUint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for conversion"}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){var t=new Array(7);return t[0]=Mr(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=Mr(this.month,2),t[2]=Mr(this.day,2),t[3]=Mr(this.hour,2),t[4]=Mr(this.minute,2),t[5]=Mr(this.second,2),t[6]="Z",t.join("")}return _get5(_getPrototypeOf(r.prototype),"toString",this).call(this,e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.toDate().toISOString())}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second})}}]),r}(Bi);Di=Ui,hn.UTCTime=Di,Ui.NAME="UTCTime";var Pi,Xi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),null!==(n=(e=t.call(this,i)).millisecond)&&void 0!==n||(e.millisecond=0),e.idBlock.tagClass=1,e.idBlock.tagNumber=24,e}return _createClass(r,[{key:"fromDate",value:function(e){_get5(_getPrototypeOf(r.prototype),"fromDate",this).call(this,e),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t,r=!1,n="",i="",a=0,o=0,s=0;if("Z"===e[e.length-1])n=e.substring(0,e.length-1),r=!0;else{var u=new Number(e[e.length-1]);if(isNaN(u.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(r){if(-1!==n.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==n.indexOf("-"))throw new Error("Wrong input string for conversion")}else{var c=1,l=n.indexOf("+"),h="";if(-1===l&&(l=n.indexOf("-"),c=-1),-1!==l){if(h=n.substring(l+1),n=n.substring(0,l),2!==h.length&&4!==h.length)throw new Error("Wrong input string for conversion");var p=parseInt(h.substring(0,2),10);if(isNaN(p.valueOf()))throw new Error("Wrong input string for conversion");if(o=c*p,4===h.length){if(p=parseInt(h.substring(2,4),10),isNaN(p.valueOf()))throw new Error("Wrong input string for conversion");s=c*p}}}var f=n.indexOf(".");if(-1===f&&(f=n.indexOf(",")),-1!==f){var y=new Number("0".concat(n.substring(f)));if(isNaN(y.valueOf()))throw new Error("Wrong input string for conversion");a=y.valueOf(),i=n.substring(0,f)}else i=n;switch(!0){case 8===i.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==f)throw new Error("Wrong input string for conversion");break;case 10===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==f){var v=60*a;this.minute=Math.floor(v),v=60*(v-this.minute),this.second=Math.floor(v),v=1e3*(v-this.second),this.millisecond=Math.floor(v)}break;case 12===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==f){var d=60*a;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case 14===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==f){var g=1e3*a;this.millisecond=Math.floor(g)}break;default:throw new Error("Wrong input string for conversion")}var m=t.exec(i);if(null===m)throw new Error("Wrong input string for conversion");for(var _=1;_<m.length;_++)switch(_){case 1:this.year=parseInt(m[_],10);break;case 2:this.month=parseInt(m[_],10);break;case 3:this.day=parseInt(m[_],10);break;case 4:this.hour=parseInt(m[_],10)+o;break;case 5:this.minute=parseInt(m[_],10)+s;break;case 6:this.second=parseInt(m[_],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){var k=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=k.getUTCFullYear(),this.month=k.getUTCMonth(),this.day=k.getUTCDay(),this.hour=k.getUTCHours(),this.minute=k.getUTCMinutes(),this.second=k.getUTCSeconds(),this.millisecond=k.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){var t=[];return t.push(Mr(this.year,4)),t.push(Mr(this.month,2)),t.push(Mr(this.day,2)),t.push(Mr(this.hour,2)),t.push(Mr(this.minute,2)),t.push(Mr(this.second,2)),0!==this.millisecond&&(t.push("."),t.push(Mr(this.millisecond,3))),t.push("Z"),t.join("")}return _get5(_getPrototypeOf(r.prototype),"toString",this).call(this,e)}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get5(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{millisecond:this.millisecond})}}]),r}(Ui);Ki=Xi,hn.GeneralizedTime=Ki,Xi.NAME="GeneralizedTime";var Li,ji=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=31,e}return _createClass(r)}(ci);Pi=ji,hn.DATE=Pi,ji.NAME="DATE";var Hi,Gi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=32,e}return _createClass(r)}(ci);Li=Gi,hn.TimeOfDay=Li,Gi.NAME="TimeOfDay";var Vi,Mi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=33,e}return _createClass(r)}(ci);Hi=Mi,hn.DateTime=Hi,Mi.NAME="DateTime";var qi,Fi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=34,e}return _createClass(r)}(ci);Vi=Fi,hn.Duration=Vi,Fi.NAME="Duration";var Ji=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=14,e}return _createClass(r)}(ci);qi=Ji,hn.TIME=qi,Ji.NAME="TIME";var zi=_createClass((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.name,n=void 0===r?Qr:r,i=t.optional,a=void 0!==i&&i;_classCallCheck(this,e),this.name=n,this.optional=a})),Wi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=void 0===i?[]:i,o=_objectWithoutProperties(n,_excluded16);return _classCallCheck(this,r),(e=t.call(this,o)).value=a,e}return _createClass(r)}(zi),Yi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=void 0===i?new zi:i,o=n.local,s=void 0!==o&&o,u=_objectWithoutProperties(n,_excluded17);return _classCallCheck(this,r),(e=t.call(this,u)).value=a,e.local=s,e}return _createClass(r)}(zi),Zi=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).data,r=void 0===t?tn:t;_classCallCheck(this,e),this.dataView=s.toUint8Array(r)}return _createClass(e,[{key:"data",get:function(){return this.dataView.slice().buffer},set:function(e){this.dataView=s.toUint8Array(e)}},{key:"fromBER",value:function(e,t,r){var n=t+r;return this.dataView=s.toUint8Array(e).subarray(t,n),n}},{key:"toBER",value:function(e){return this.dataView.slice().buffer}}]),e}();function $i(e,t,r){if(Buffer.from(""),r instanceof Wi){for(var n=0;n<r.value.length;n++)if($i(e,t,r.value[n]).verified)return{verified:!0,result:e};var i={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(Zr)&&(i.name=r.name),i}if(r instanceof zi)return r.hasOwnProperty(Zr)&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==0)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==0)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var a=r.idBlock.toBER(!1);if(0===a.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(a,0,a.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if(!("isHexOnly"in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(r.idBlock.isHexOnly){if($r in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var o=r.idBlock.valueHexView,s=t.idBlock.valueHexView;if(o.length!==s.length)return{verified:!1,result:e};for(var u=0;u<o.length;u++)if(o[u]!==s[1])return{verified:!1,result:e}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Qr),r.name&&(e[r.name]=t)),r instanceof hn.Constructed){var c=0,l={verified:!1,result:{error:"Unknown error"}},h=r.valueBlock.value.length;if(h>0&&r.valueBlock.value[0]instanceof Yi&&(h=t.valueBlock.value.length),0===h)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){for(var p=!0,f=0;f<r.valueBlock.value.length;f++)p=p&&(r.valueBlock.value[f].optional||!1);return p?{verified:!0,result:e}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Qr),r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(var y=0;y<h;y++)if(y-c>=t.valueBlock.value.length){if(!1===r.valueBlock.value[y].optional){var v={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Qr),r.name&&(delete e[r.name],v.name=r.name)),v}}else if(r.valueBlock.value[0]instanceof Yi){if(!1===(l=$i(e,t.valueBlock.value[y],r.valueBlock.value[0].value)).verified){if(!r.valueBlock.value[0].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Qr),r.name&&delete e[r.name]),l;c++}if(Zr in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var d={};void 0===(d="local"in r.valueBlock.value[0]&&r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(d[r.valueBlock.value[0].name]=[]),d[r.valueBlock.value[0].name].push(t.valueBlock.value[y])}}else if(!1===(l=$i(e,t.valueBlock.value[y-c],r.valueBlock.value[y])).verified){if(!r.valueBlock.value[y].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Qr),r.name&&delete e[r.name]),l;c++}if(!1===l.verified){var g={verified:!1,result:e};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Qr),r.name&&(delete e[r.name],g.name=r.name)),g}return{verified:!0,result:e}}if(r.primitiveSchema&&$r in t.valueBlock){var m=mn(t.valueBlock.valueHexView);if(-1===m.offset){var _={verified:!1,result:m.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Qr),r.name&&(delete e[r.name],_.name=r.name)),_}return $i(e,m.result,r.primitiveSchema)}return{verified:!0,result:e}}var Qi,ea,ta=Object.freeze({__proto__:null,Any:zi,BaseBlock:pn,BaseStringBlock:yn,BitString:Pn,BmpString:pi,Boolean:Bn,CharacterString:Oi,Choice:Wi,Constructed:bn,DATE:ji,DateTime:Mi,Duration:Fi,EndOfContent:En,Enumerated:qn,GeneralString:Ti,GeneralizedTime:Xi,GraphicString:Ni,HexBlock:on,IA5String:Ei,Integer:Mn,Null:An,NumericString:mi,ObjectIdentifier:Wn,OctetString:Dn,Primitive:gn,PrintableString:ki,RawData:Zi,RelativeObjectIdentifier:ei,Repeated:Yi,Sequence:ri,Set:ni,TIME:Ji,TeletexString:bi,TimeOfDay:Gi,UTCTime:Ui,UniversalString:di,Utf8String:ci,ValueBlock:un,VideotexString:xi,ViewWriter:zr,VisibleString:Bi,compareSchema:$i,fromBER:_n,verifySchema:function(e,t){if(t instanceof Object==0)return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};var r=mn(s.toUint8Array(e));return-1===r.offset?{verified:!1,result:r.result}:$i(r.result,r.result,t)}});!function(e){e[e.Sequence=0]="Sequence",e[e.Set=1]="Set",e[e.Choice=2]="Choice"}(Qi||(Qi={})),function(e){e[e.Any=1]="Any",e[e.Boolean=2]="Boolean",e[e.OctetString=3]="OctetString",e[e.BitString=4]="BitString",e[e.Integer=5]="Integer",e[e.Enumerated=6]="Enumerated",e[e.ObjectIdentifier=7]="ObjectIdentifier",e[e.Utf8String=8]="Utf8String",e[e.BmpString=9]="BmpString",e[e.UniversalString=10]="UniversalString",e[e.NumericString=11]="NumericString",e[e.PrintableString=12]="PrintableString",e[e.TeletexString=13]="TeletexString",e[e.VideotexString=14]="VideotexString",e[e.IA5String=15]="IA5String",e[e.GraphicString=16]="GraphicString",e[e.VisibleString=17]="VisibleString",e[e.GeneralString=18]="GeneralString",e[e.CharacterString=19]="CharacterString",e[e.UTCTime=20]="UTCTime",e[e.GeneralizedTime=21]="GeneralizedTime",e[e.DATE=22]="DATE",e[e.TimeOfDay=23]="TimeOfDay",e[e.DateTime=24]="DateTime",e[e.Duration=25]="Duration",e[e.TIME=26]="TIME",e[e.Null=27]="Null"}(ea||(ea={}));var ra={fromASN:function(e){return e instanceof An?null:e.valueBeforeDecode},toASN:function(e){if(null===e)return new An;var t=_n(e);if(t.result.error)throw new Error(t.result.error);return t.result}},na={fromASN:function(e){return e.valueBlock.valueHex.byteLength>4?e.valueBlock.toString():e.valueBlock.valueDec},toASN:function(e){return new Mn({value:e})}},ia={fromASN:function(e){return e.valueBlock.valueDec},toASN:function(e){return new qn({value:e})}},aa={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new Pn({valueHex:e})}},oa={fromASN:function(e){return e.valueBlock.toString()},toASN:function(e){return new Wn({value:e})}},sa={fromASN:function(e){return e.valueBlock.value},toASN:function(e){return new Bn({value:e})}},ua={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new Dn({valueHex:e})}};function ca(e){return{fromASN:function(e){return e.valueBlock.value},toASN:function(t){return new e({value:t})}}}var la=ca(ci),ha=ca(pi),pa=ca(di),fa=ca(mi),ya=ca(ki),va=ca(bi),da=ca(xi),ga=ca(Ei),ma=ca(Ni),_a=ca(Bi),ka=ca(Ti),wa=ca(Oi),ba={fromASN:function(e){return e.toDate()},toASN:function(e){return new Ui({valueDate:e})}},Ca={fromASN:function(e){return e.toDate()},toASN:function(e){return new Xi({valueDate:e})}},xa={fromASN:function(e){return null},toASN:function(e){return new An}};function Sa(e){switch(e){case ea.Any:return ra;case ea.BitString:return aa;case ea.BmpString:return ha;case ea.Boolean:return sa;case ea.CharacterString:return wa;case ea.Enumerated:return ia;case ea.GeneralString:return ka;case ea.GeneralizedTime:return Ca;case ea.GraphicString:return ma;case ea.IA5String:return ga;case ea.Integer:return na;case ea.Null:return xa;case ea.NumericString:return fa;case ea.ObjectIdentifier:return oa;case ea.OctetString:return ua;case ea.PrintableString:return ya;case ea.TeletexString:return va;case ea.UTCTime:return ba;case ea.UniversalString:return pa;case ea.Utf8String:return la;case ea.VideotexString:return da;case ea.VisibleString:return _a;default:return null}}function Ea(e){return e&&e.prototype?!(!e.prototype.toASN||!e.prototype.fromASN)||Ea(e.prototype):!!(e&&e.toASN&&e.fromASN)}function Aa(e){var t;if(e){var r=Object.getPrototypeOf(e);return(null===(t=null==r?void 0:r.prototype)||void 0===t?void 0:t.constructor)===Array||Aa(r)}return!1}function Na(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),i=0;i<e.byteLength;i++)if(r[i]!==n[i])return!1;return!0}var Ia,Ba=new(function(){function e(){_classCallCheck(this,e),this.items=new WeakMap}return _createClass(e,[{key:"has",value:function(e){return this.items.has(e)}},{key:"get",value:function(e){var t,r,n,i=this.items.get(e);if(!i)throw new Error("Cannot get schema for '".concat(null!==(n=null===(r=null===(t=null==e?void 0:e.prototype)||void 0===t?void 0:t.constructor)||void 0===r?void 0:r.name)&&void 0!==n?n:e,"' target"));return i}},{key:"cache",value:function(e){var t=this.get(e);t.schema||(t.schema=this.create(e,!0))}},{key:"createDefault",value:function(e){var t={type:Qi.Sequence,items:{}},r=this.findParentSchema(e);return r&&(Object.assign(t,r),t.items=Object.assign({},t.items,r.items)),t}},{key:"create",value:function(e,t){var r=this.items.get(e)||this.createDefault(e),n=[];for(var i in r.items){var a=r.items[i],o=t?i:"",s=void 0;if("number"==typeof a.type){var u=ea[a.type],c=ta[u];if(!c)throw new Error("Cannot get ASN1 class by name '".concat(u,"'"));s=new c({name:o})}else Ea(a.type)?s=(new a.type).toSchema(o):a.optional?this.get(a.type).type===Qi.Choice?s=new zi({name:o}):(s=this.create(a.type,!1)).name=o:s=new zi({name:o});var l=!!a.optional||void 0!==a.defaultValue;if(a.repeated&&(s.name="",s=new("set"===a.repeated?ni:ri)({name:"",value:[new Yi({name:o,value:s})]})),null!==a.context&&void 0!==a.context)if(a.implicit)if("number"==typeof a.type||Ea(a.type)){var h=a.repeated?bn:gn;n.push(new h({name:o,optional:l,idBlock:{tagClass:3,tagNumber:a.context}}))}else{this.cache(a.type);var p=!!a.repeated,f=p?s:this.get(a.type).schema;f=f.valueBlock?f.valueBlock.value:f.value,n.push(new bn({name:p?"":o,optional:l,idBlock:{tagClass:3,tagNumber:a.context},value:f}))}else n.push(new bn({optional:l,idBlock:{tagClass:3,tagNumber:a.context},value:[s]}));else s.optional=l,n.push(s)}switch(r.type){case Qi.Sequence:return new ri({value:n,name:""});case Qi.Set:return new ni({value:n,name:""});case Qi.Choice:return new Wi({value:n,name:""});default:throw new Error("Unsupported ASN1 type in use")}}},{key:"set",value:function(e,t){return this.items.set(e,t),this}},{key:"findParentSchema",value:function(e){var t=e.__proto__;return t?this.items.get(t)||this.findParentSchema(t):null}}]),e}()),Ra=function(e){return function(t){var r;Ba.has(t)?r=Ba.get(t):(r=Ba.createDefault(t),Ba.set(t,r)),Object.assign(r,e)}},Ta=function(e){return function(t,r){var n;Ba.has(t.constructor)?n=Ba.get(t.constructor):(n=Ba.createDefault(t.constructor),Ba.set(t.constructor,n));var i=Object.assign({},e);if("number"==typeof i.type&&!i.converter){var a=Sa(e.type);if(!a)throw new Error("Cannot get default converter for property '".concat(r,"' of ").concat(t.constructor.name));i.converter=a}n.items[r]=i}},Da=function(e){_inherits(r,_wrapNativeSuper(Error));var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).schemas=[],e}return _createClass(r)}(),Oa=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"parse",value:function(e,t){var r;if(e instanceof ArrayBuffer)r=e;else if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))r=new Uint8Array(e).buffer;else{if(!(ArrayBuffer.isView(e)||e.buffer instanceof ArrayBuffer))throw new TypeError("Wrong type of 'data' argument");r=e.buffer}var n=_n(r);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}},{key:"fromASN",value:function(e,t){var r,n=this;try{if(Ea(t))return(new t).fromASN(e);var i=Ba.get(t);Ba.cache(t);var a=i.schema;if(e.constructor===bn&&i.type!==Qi.Choice)for(var o in a=new bn({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:i.schema.valueBlock.value}),i.items)delete e[o];var s=$i(e,e,a);if(!s.verified)throw new Da("Data does not match to ".concat(t.name," ASN1 schema. ").concat(s.result.error));var u=new t;if(Aa(t)){if("number"==typeof i.itemType){var c=Sa(i.itemType);if(!c)throw new Error("Cannot get default converter for array item of ".concat(t.name," ASN1 schema"));return t.from(e.valueBlock.value,(function(e){return c.fromASN(e)}))}return t.from(e.valueBlock.value,(function(e){return n.fromASN(e,i.itemType)}))}var l=function(t){if(!e[t])return"continue";var a=i.items[t];if("number"==typeof a.type||Ea(a.type)){var o=null!==(r=a.converter)&&void 0!==r?r:Ea(a.type)?new a.type:null;if(!o)throw new Error("Converter is empty");if(a.repeated)if(a.implicit){var s=new("sequence"===a.repeated?ri:ni);s.valueBlock=e[t].valueBlock;var c=_n(s.toBER(!1)).result.valueBlock.value;u[t]=Array.from(c,(function(e){return o.fromASN(e)}))}else u[t]=Array.from(e[t],(function(e){return o.fromASN(e)}));else{var l=e[t];if(a.implicit){var h;if(Ea(a.type))h=(new a.type).toSchema("");else{var p=ea[a.type],f=ta[p];if(!f)throw new Error("Cannot get '".concat(p,"' class from asn1js module"));h=new f}h.valueBlock=l.valueBlock,l=_n(h.toBER(!1)).result}u[t]=o.fromASN(l)}}else a.repeated?u[t]=Array.from(e[t],(function(e){return n.fromASN(e,a.type)})):u[t]=n.fromASN(e[t],a.type)};for(var h in i.items)l(h);return u}catch(e){throw e instanceof Da&&e.schemas.push(t.name),e}}}]),e}(),Ka=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"serialize",value:function(e){return e instanceof pn?e.toBER(!1):this.toASN(e).toBER(!1)}},{key:"toASN",value:function(t){var r=this;if(t&&Ea(t.constructor))return t.toASN();var n=t.constructor,i=Ba.get(n);Ba.cache(n);var a,o=[];if(i.itemType)if("number"==typeof i.itemType){var s=Sa(i.itemType);if(!s)throw new Error("Cannot get default converter for array item of ".concat(n.name," ASN1 schema"));o=t.map((function(e){return s.toASN(e)}))}else o=t.map((function(e){return r.toAsnItem({type:i.itemType},"[]",n,e)}));else for(var u in i.items){var c=i.items[u],l=t[u];if(!(void 0===l||c.defaultValue===l||"object"===_typeof(c.defaultValue)&&"object"===_typeof(l)&&Na(this.serialize(c.defaultValue),this.serialize(l)))){var h=e.toAsnItem(c,u,n,l);if("number"==typeof c.context)if(c.implicit)if(c.repeated||"number"!=typeof c.type&&!Ea(c.type))o.push(new bn({optional:c.optional,idBlock:{tagClass:3,tagNumber:c.context},value:h.valueBlock.value}));else{var p={};p.valueHex=h instanceof An?h.valueBeforeDecode:h.valueBlock.toBER(),o.push(new gn(_objectSpread({optional:c.optional,idBlock:{tagClass:3,tagNumber:c.context}},p)))}else o.push(new bn({optional:c.optional,idBlock:{tagClass:3,tagNumber:c.context},value:[h]}));else c.repeated?o=o.concat(h):o.push(h)}}switch(i.type){case Qi.Sequence:a=new ri({value:o});break;case Qi.Set:a=new ni({value:o});break;case Qi.Choice:if(!o[0])throw new Error("Schema '".concat(n.name,"' has wrong data. Choice cannot be empty."));a=o[0]}return a}},{key:"toAsnItem",value:function(e,t,r,n){var i,a=this;if("number"==typeof e.type){var o=e.converter;if(!o)throw new Error("Property '".concat(t,"' doesn't have converter for type ").concat(ea[e.type]," in schema '").concat(r.name,"'"));if(e.repeated){var s=Array.from(n,(function(e){return o.toASN(e)}));i=new("sequence"===e.repeated?ri:ni)({value:s})}else i=o.toASN(n)}else if(e.repeated){var u=Array.from(n,(function(e){return a.toASN(e)}));i=new("sequence"===e.repeated?ri:ni)({value:u})}else i=this.toASN(n);return i}}]),e}(),Ua=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"serialize",value:function(e){return Ka.serialize(e)}},{key:"parse",value:function(e,t){return Oa.parse(e,t)}},{key:"toString",value:function(t){var r=_n(s.isBufferSource(t)?s.toArrayBuffer(t):e.serialize(t));if(-1===r.offset)throw new Error("Cannot decode ASN.1 data. ".concat(r.result.error));return r.result.toString()}}]),e}(),Pa=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(function(e){_inherits(r,_wrapNativeSuper(Error));var t=_createSuper(r);function r(e,n){var i;return _classCallCheck(this,r),(i=t.call(this,n?"".concat(e,". See the inner exception for more details."):e)).message=e,i.innerError=n,i}return _createClass(r)}());function Xa(e,t){if(!function(e,t){switch(t){case Ia.Boolean:return"boolean"==typeof e;case Ia.Number:return"number"==typeof e;case Ia.String:return"string"==typeof e}return!0}(e,t))throw new TypeError("Value must be ".concat(Ia[t]))}function La(e){return e&&e.prototype?!(!e.prototype.toJSON||!e.prototype.fromJSON)||La(e.prototype):!!(e&&e.toJSON&&e.fromJSON)}!function(e){e[e.Any=0]="Any",e[e.Boolean=1]="Boolean",e[e.Number=2]="Number",e[e.String=3]="String"}(Ia||(Ia={}));var ja=new(function(){function e(){_classCallCheck(this,e),this.items=new Map}return _createClass(e,[{key:"has",value:function(e){return this.items.has(e)||!!this.findParentSchema(e)}},{key:"get",value:function(e){var t=this.items.get(e)||this.findParentSchema(e);if(!t)throw new Error("Cannot get schema for current target");return t}},{key:"create",value:function(e){var t={names:{}},r=this.findParentSchema(e);if(r)for(var n in Object.assign(t,r),t.names={},r.names)t.names[n]=Object.assign({},r.names[n]);return t.target=e,t}},{key:"set",value:function(e,t){return this.items.set(e,t),this}},{key:"findParentSchema",value:function(e){var t=e.__proto__;return t?this.items.get(t)||this.findParentSchema(t):null}}]),e}()),Ha=function(){function e(t){_classCallCheck(this,e),this.pattern=new RegExp(t)}return _createClass(e,[{key:"validate",value:function(e){var t=new RegExp(this.pattern.source,this.pattern.flags);if("string"!=typeof e)throw new Pa("Incoming value must be string");if(!t.exec(e))throw new Pa("Value doesn't match to pattern '".concat(t.toString(),"'"))}}]),e}(),Ga=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.MIN_VALUE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;_classCallCheck(this,e),this.min=t,this.max=r}return _createClass(e,[{key:"validate",value:function(e){if(Xa(e,Ia.Number),!(this.min<=e&&e<=this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min,r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new Pa("Value doesn't match to diapason [".concat(t,",").concat(r,"]"))}}}]),e}(),Va=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.MIN_VALUE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;_classCallCheck(this,e),this.min=t,this.max=r}return _createClass(e,[{key:"validate",value:function(e){if(Xa(e,Ia.Number),!(this.min<e&&e<this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min,r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new Pa("Value doesn't match to diapason (".concat(t,",").concat(r,")"))}}}]),e}(),Ma=function(){function e(t,r,n){_classCallCheck(this,e),this.length=t,this.minLength=r,this.maxLength=n}return _createClass(e,[{key:"validate",value:function(e){if(void 0===this.length){if(void 0!==this.minLength&&e.length<this.minLength)throw new Pa("Value length must be more than ".concat(this.minLength,"."));if(void 0!==this.maxLength&&e.length>this.maxLength)throw new Pa("Value length must be less than ".concat(this.maxLength,"."))}else if(e.length!==this.length)throw new Pa("Value length must be exactly ".concat(this.length,"."))}}]),e}(),qa=function(){function e(t){_classCallCheck(this,e),this.enumeration=t}return _createClass(e,[{key:"validate",value:function(e){if(Xa(e,Ia.String),!this.enumeration.includes(e))throw new Pa("Value must be one of ".concat(this.enumeration.map((function(e){return"'".concat(e,"'")})).join(", ")))}}]),e}(),Fa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r){var n,i="Cannot set type for ".concat(r," property of ").concat(t.constructor.name," schema");ja.has(t.constructor)?(n=ja.get(t.constructor)).target!==t.constructor&&(n=ja.create(t.constructor),ja.set(t.constructor,n)):(n=ja.create(t.constructor),ja.set(t.constructor,n));var a={type:Ia.Any,validations:[]},o=Object.assign(a,e);if(o.validations=function(e){var t=[];return e.pattern&&t.push(new Ha(e.pattern)),e.type!==Ia.Number&&e.type!==Ia.Any||(void 0===e.minInclusive&&void 0===e.maxInclusive||t.push(new Ga(e.minInclusive,e.maxInclusive)),void 0===e.minExclusive&&void 0===e.maxExclusive||t.push(new Va(e.minExclusive,e.maxExclusive)),void 0!==e.enumeration&&t.push(new qa(e.enumeration))),(e.type===Ia.String||e.repeated||e.type===Ia.Any)&&(void 0===e.length&&void 0===e.minLength&&void 0===e.maxLength||t.push(new Ma(e.length,e.minLength,e.maxLength))),t}(o),"number"!=typeof o.type&&!ja.has(o.type)&&!La(o.type))throw new Error("".concat(i,". Assigning type doesn't have schema."));var s,u=_createForOfIteratorHelper(Array.isArray(e.schema)?e.schema:[e.schema||"default"]);try{for(u.s();!(s=u.n()).done;){var c=s.value;n.names[c]||(n.names[c]={}),n.names[c][r]=o}}catch(e){u.e(e)}finally{u.f()}}},Ja=function(e){_inherits(r,_wrapNativeSuper(Error));var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(),za=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Ja),Wa=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"toArrayBuffer",value:function(e){var t=e.replace(/-{5}(BEGIN|END) .*-{5}/g,"").replace("\r","").replace("\n","");return l.FromBase64(t)}},{key:"toUint8Array",value:function(e){var t=this.toArrayBuffer(e);return new Uint8Array(t)}},{key:"fromBufferSource",value:function(e,t){for(var r,n=l.ToBase64(e),i=0,a=[];(r=n.slice(i,i+=64)).length&&(a.push(r),!(r.length<64)););var o=t.toUpperCase();return"-----BEGIN ".concat(o,"-----\n").concat(a.join("\n"),"\n-----END ").concat(o,"-----")}},{key:"isPEM",value:function(e){return/-----BEGIN .+-----[A-Za-z0-9+\/\+\=\s\n]+-----END .+-----/i.test(e)}},{key:"getTagName",value:function(e){if(!this.isPEM(e))throw new Error("Bad parameter. Incoming data is not right PEM");var t=/-----BEGIN (.+)-----/.exec(e);if(!t)throw new Error("Cannot get tag from PEM");return t[1]}},{key:"hasTagName",value:function(e,t){var r=this.getTagName(e);return t.toLowerCase()===r.toLowerCase()}},{key:"isCertificate",value:function(e){return this.hasTagName(e,"certificate")}},{key:"isCertificateRequest",value:function(e){return this.hasTagName(e,"certificate request")}},{key:"isCRL",value:function(e){return this.hasTagName(e,"x509 crl")}},{key:"isPublicKey",value:function(e){return this.hasTagName(e,"public key")}}]),e}(),Ya=["secret","private","public"],Za=function(e){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:Symbol.toStringTag,get:function(){return"CryptoKey"}}],[{key:"create",value:function(e,t,r,n){var i=new this;return i.algorithm=e,i.type=t,i.extractable=r,i.usages=n,i}},{key:"isKeyType",value:function(e){return-1!==Ya.indexOf(e)}}]),t}(),$a=_createClass((function e(t){_classCallCheck(this,e),t&&(this.value=t)}));le([Ta({type:ea.ObjectIdentifier})],$a.prototype,"value",void 0),$a=le([Ra({type:Qi.Choice})],$a);var Qa=_createClass((function e(t){_classCallCheck(this,e),Object.assign(this,t)}));le([Ta({type:ea.ObjectIdentifier})],Qa.prototype,"algorithm",void 0),le([Ta({type:ea.Any,optional:!0})],Qa.prototype,"parameters",void 0);var eo=_createClass((function e(){_classCallCheck(this,e),this.version=0,this.privateKeyAlgorithm=new Qa,this.privateKey=new ArrayBuffer(0)}));le([Ta({type:ea.Integer})],eo.prototype,"version",void 0),le([Ta({type:Qa})],eo.prototype,"privateKeyAlgorithm",void 0),le([Ta({type:ea.OctetString})],eo.prototype,"privateKey",void 0),le([Ta({type:ea.Any,optional:!0})],eo.prototype,"attributes",void 0);var to=_createClass((function e(){_classCallCheck(this,e),this.publicKeyAlgorithm=new Qa,this.publicKey=new ArrayBuffer(0)}));le([Ta({type:Qa})],to.prototype,"publicKeyAlgorithm",void 0),le([Ta({type:ea.BitString})],to.prototype,"publicKey",void 0);var ro={fromJSON:function(e){return l.FromBase64Url(e)},toJSON:function(e){return l.ToBase64Url(new Uint8Array(e))}},no={fromASN:function(e){var t=e.valueBlock.valueHex;return new Uint8Array(t)[0]?e.valueBlock.valueHex:e.valueBlock.valueHex.slice(1)},toASN:function(e){var t=new Uint8Array(e)[0]>127?p(new Uint8Array([0]).buffer,e):e;return new Mn({valueHex:t})}},io=Object.freeze({__proto__:null,JsonBase64UrlArrayBufferConverter:ro,AsnIntegerArrayBufferConverter:no}),ao=_createClass((function e(){_classCallCheck(this,e),this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0)}));le([Ta({type:ea.Integer,converter:na})],ao.prototype,"version",void 0),le([Ta({type:ea.Integer,converter:no}),Fa({name:"n",converter:ro})],ao.prototype,"modulus",void 0),le([Ta({type:ea.Integer,converter:no}),Fa({name:"e",converter:ro})],ao.prototype,"publicExponent",void 0),le([Ta({type:ea.Integer,converter:no}),Fa({name:"d",converter:ro})],ao.prototype,"privateExponent",void 0),le([Ta({type:ea.Integer,converter:no}),Fa({name:"p",converter:ro})],ao.prototype,"prime1",void 0),le([Ta({type:ea.Integer,converter:no}),Fa({name:"q",converter:ro})],ao.prototype,"prime2",void 0),le([Ta({type:ea.Integer,converter:no}),Fa({name:"dp",converter:ro})],ao.prototype,"exponent1",void 0),le([Ta({type:ea.Integer,converter:no}),Fa({name:"dq",converter:ro})],ao.prototype,"exponent2",void 0),le([Ta({type:ea.Integer,converter:no}),Fa({name:"qi",converter:ro})],ao.prototype,"coefficient",void 0),le([Ta({type:ea.Any,optional:!0})],ao.prototype,"otherPrimeInfos",void 0);var oo=_createClass((function e(){_classCallCheck(this,e),this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0)}));le([Ta({type:ea.Integer,converter:no}),Fa({name:"n",converter:ro})],oo.prototype,"modulus",void 0),le([Ta({type:ea.Integer,converter:no}),Fa({name:"e",converter:ro})],oo.prototype,"publicExponent",void 0);var so=function(){function e(t){_classCallCheck(this,e),this.value=new ArrayBuffer(0),t&&(this.value=t)}return _createClass(e,[{key:"toJSON",value:function(){var e=new Uint8Array(this.value);if(4!==e[0])throw new Ja("Wrong ECPoint. Current version supports only Uncompressed (0x04) point");var t=(e=new Uint8Array(this.value.slice(1))).length/2;return{x:l.ToBase64Url(e.buffer.slice(0,0+t)),y:l.ToBase64Url(e.buffer.slice(0+t,0+t+t))}}},{key:"fromJSON",value:function(e){if(!("x"in e))throw new Error("x: Missing required property");if(!("y"in e))throw new Error("y: Missing required property");var t=l.FromBase64Url(e.x),r=l.FromBase64Url(e.y),n=p(new Uint8Array([4]).buffer,t,r);return this.value=new Uint8Array(n).buffer,this}}]),e}();le([Ta({type:ea.OctetString})],so.prototype,"value",void 0),so=le([Ra({type:Qi.Choice})],so);var uo=function(){function e(){_classCallCheck(this,e),this.version=1,this.privateKey=new ArrayBuffer(0)}return _createClass(e,[{key:"fromJSON",value:function(e){if(!("d"in e))throw new Error("d: Missing required property");if(this.privateKey=l.FromBase64Url(e.d),"x"in e){var t=new so;t.fromJSON(e),this.publicKey=Ka.toASN(t).valueBlock.valueHex}return this}},{key:"toJSON",value:function(){var e={};return e.d=l.ToBase64Url(this.privateKey),this.publicKey&&Object.assign(e,new so(this.publicKey).toJSON()),e}}]),e}();le([Ta({type:ea.Integer,converter:na})],uo.prototype,"version",void 0),le([Ta({type:ea.OctetString})],uo.prototype,"privateKey",void 0),le([Ta({context:0,type:ea.Any,optional:!0})],uo.prototype,"parameters",void 0),le([Ta({context:1,type:ea.BitString,optional:!0})],uo.prototype,"publicKey",void 0);var co={fromASN:function(e){var t=new Uint8Array(e.valueBlock.valueHex);return 0===t[0]?t.buffer.slice(1):t.buffer},toASN:function(e){var t=new Uint8Array(e);if(t[0]>127){var r=new Uint8Array(t.length+1);return r.set(t,1),new Mn({valueHex:r.buffer})}return new Mn({valueHex:e})}},lo=Object.freeze({__proto__:null,AsnIntegerWithoutPaddingConverter:co}),ho=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"decodePoint",value:function(e,t){var r=s.toUint8Array(e);if(0===r.length||4!==r[0])throw new Error("Only uncompressed point format supported");var n=(r.length-1)/2;if(n!==Math.ceil(t/8))throw new Error("Point does not match field size");return{x:r.slice(1,n+1),y:r.slice(n+1,n+1+n)}}},{key:"encodePoint",value:function(e,t){var r=Math.ceil(t/8);if(e.x.byteLength!==r||e.y.byteLength!==r)throw new Error("X,Y coordinates don't match point size criteria");var n=s.toUint8Array(e.x),i=s.toUint8Array(e.y),a=new Uint8Array(2*r+1);return a[0]=4,a.set(n,1),a.set(i,r+1),a}},{key:"getSize",value:function(e){return Math.ceil(e/8)}},{key:"encodeSignature",value:function(e,t){var r=this.getSize(t),n=s.toUint8Array(e.r),i=s.toUint8Array(e.s),a=new Uint8Array(2*r);return a.set(this.padStart(n,r)),a.set(this.padStart(i,r),r),a}},{key:"decodeSignature",value:function(e,t){var r=this.getSize(t),n=s.toUint8Array(e);if(n.length!==2*r)throw new Error("Incorrect size of the signature");var i=n.slice(0,r),a=n.slice(r);return{r:this.trimStart(i),s:this.trimStart(a)}}},{key:"trimStart",value:function(e){for(var t=0;t<e.length-1&&0===e[t];)t++;return 0===t?e:e.slice(t,e.length)}},{key:"padStart",value:function(e,t){if(t===e.length)return e;var r=new Uint8Array(t);return r.set(e,t-e.length),r}}]),e}(),po=function(){function e(){_classCallCheck(this,e),this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0)}return _createClass(e,[{key:"toWebCryptoSignature",value:function(e){return null!=e||(e=8*Math.max(this.r.byteLength,this.s.byteLength)),ho.encodeSignature(this,e).buffer}}],[{key:"fromWebCryptoSignature",value:function(t){var r=t.byteLength/2,n=ho.decodeSignature(t,8*r),i=new e;return i.r=s.toArrayBuffer(n.r),i.s=s.toArrayBuffer(n.s),i}}]),e}();le([Ta({type:ea.Integer,converter:co})],po.prototype,"r",void 0),le([Ta({type:ea.Integer,converter:co})],po.prototype,"s",void 0);var fo=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(eo);le([Ta({context:1,implicit:!0,type:ea.BitString,optional:!0})],fo.prototype,"publicKey",void 0);var yo=function(){function e(){_classCallCheck(this,e),this.value=new ArrayBuffer(0)}return _createClass(e,[{key:"fromJSON",value:function(e){if(!e.d)throw new Error("d: Missing required property");return this.value=l.FromBase64Url(e.d),this}},{key:"toJSON",value:function(){return{d:l.ToBase64Url(this.value)}}}]),e}();le([Ta({type:ea.OctetString})],yo.prototype,"value",void 0),yo=le([Ra({type:Qi.Choice})],yo);var vo=function(){function e(t){_classCallCheck(this,e),this.value=new ArrayBuffer(0),t&&(this.value=t)}return _createClass(e,[{key:"toJSON",value:function(){return{x:l.ToBase64Url(this.value)}}},{key:"fromJSON",value:function(e){if(!("x"in e))throw new Error("x: Missing required property");return this.value=l.FromBase64Url(e.x),this}}]),e}();le([Ta({type:ea.BitString})],vo.prototype,"value",void 0),vo=le([Ra({type:Qi.Choice})],vo);var go=_createClass((function e(){_classCallCheck(this,e)}));le([Ta({type:ea.OctetString}),Fa({type:Ia.String,converter:ro})],go.prototype,"d",void 0),go=le([Ra({type:Qi.Choice})],go);var mo="1.2.840.10045.3.1.7",_o="1.3.132.0",ko="".concat(_o,".34"),wo="".concat(_o,".35"),bo="".concat(_o,".10"),Co="1.3.36.3.3.2.8.1.1",xo="".concat(Co,".1"),So="".concat(Co,".2"),Eo="".concat(Co,".3"),Ao="".concat(Co,".4"),No="".concat(Co,".5"),Io="".concat(Co,".6"),Bo="".concat(Co,".7"),Ro="".concat(Co,".8"),To="".concat(Co,".9"),Do="".concat(Co,".10"),Oo="".concat(Co,".11"),Ko="".concat(Co,".12"),Uo="".concat(Co,".13"),Po="".concat(Co,".14");Object.freeze({__proto__:null,converters:lo,get ObjectIdentifier(){return $a},AlgorithmIdentifier:Qa,PrivateKeyInfo:eo,PublicKeyInfo:to,RsaPrivateKey:ao,RsaPublicKey:oo,EcPrivateKey:uo,get EcPublicKey(){return so},EcDsaSignature:po,OneAsymmetricKey:fo,get EdPrivateKey(){return yo},get EdPublicKey(){return vo},get CurvePrivateKey(){return go},idSecp256r1:mo,idEllipticCurve:_o,idSecp384r1:ko,idSecp521r1:wo,idSecp256k1:bo,idVersionOne:Co,idBrainpoolP160r1:xo,idBrainpoolP160t1:So,idBrainpoolP192r1:Eo,idBrainpoolP192t1:Ao,idBrainpoolP224r1:No,idBrainpoolP224t1:Io,idBrainpoolP256r1:Bo,idBrainpoolP256t1:Ro,idBrainpoolP320r1:To,idBrainpoolP320t1:Do,idBrainpoolP384r1:Oo,idBrainpoolP384t1:Ko,idBrainpoolP512r1:Uo,idBrainpoolP512t1:Po,idX25519:"1.3.101.110",idX448:"1.3.101.111",idEd25519:"1.3.101.112",idEd448:"1.3.101.113"});var Xo=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"register",value:function(e){var t=new $a;t.value=e.id;var r=Ua.serialize(t);this.items.push(_objectSpread(_objectSpread({},e),{},{raw:r})),this.names.push(e.name)}},{key:"find",value:function(e){e=e.toUpperCase();var t,r=_createForOfIteratorHelper(this.items);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.name.toUpperCase()===e||n.id.toUpperCase()===e)return n}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"get",value:function(e){var t=this.find(e);if(!t)throw new Error("Unsupported EC named curve '".concat(e,"'"));return t}}]),e}();Xo.items=[],Xo.names=[],Xo.register({name:"P-256",id:mo,size:256}),Xo.register({name:"P-384",id:ko,size:384}),Xo.register({name:"P-521",id:wo,size:521}),Xo.register({name:"K-256",id:bo,size:256}),Xo.register({name:"brainpoolP160r1",id:xo,size:160}),Xo.register({name:"brainpoolP160t1",id:So,size:160}),Xo.register({name:"brainpoolP192r1",id:Eo,size:192}),Xo.register({name:"brainpoolP192t1",id:Ao,size:192}),Xo.register({name:"brainpoolP224r1",id:No,size:224}),Xo.register({name:"brainpoolP224t1",id:Io,size:224}),Xo.register({name:"brainpoolP256r1",id:Bo,size:256}),Xo.register({name:"brainpoolP256t1",id:Ro,size:256}),Xo.register({name:"brainpoolP320r1",id:To,size:320}),Xo.register({name:"brainpoolP320t1",id:Do,size:320}),Xo.register({name:"brainpoolP384r1",id:Oo,size:384}),Xo.register({name:"brainpoolP384t1",id:Ko,size:384}),Xo.register({name:"brainpoolP512r1",id:Uo,size:512}),Xo.register({name:"brainpoolP512t1",id:Po,size:512});var Lo=function(e){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:Symbol.toStringTag,get:function(){return"Crypto"}},{key:"randomUUID",value:function(){var e=this.getRandomValues(new Uint8Array(16));e[6]=15&e[6]|64,e[8]=63&e[8]|128;var t=l.ToHex(e).toLowerCase();return"".concat(t.substring(0,8),"-").concat(t.substring(8,12),"-").concat(t.substring(12,16),"-").concat(t.substring(16))}}]),t}(),jo=function(){function e(){_classCallCheck(this,e),this.items={}}return _createClass(e,[{key:"get",value:function(e){return this.items[e.toLowerCase()]||null}},{key:"set",value:function(e){this.items[e.name.toLowerCase()]=e}},{key:"removeAt",value:function(e){var t=this.get(e.toLowerCase());return t&&delete this.items[e],t}},{key:"has",value:function(e){return!!this.get(e)}},{key:"length",get:function(){return Object.keys(this.items).length}},{key:"algorithms",get:function(){var e=[];for(var t in this.items){var r=this.items[t];e.push(r.name)}return e.sort()}}]),e}(),Ho=function(e){function t(){_classCallCheck(this,t),this.providers=new jo}var r,n,i,a,o,u,c,h,p,f,y,v;return _createClass(t,[{key:Symbol.toStringTag,get:function(){return"SubtleCrypto"}},{key:"digest",value:(v=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,c,l,h,p=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=p.length,r=new Array(t),n=0;n<t;n++)r[n]=p[n];return this.checkRequiredArguments(r,2,"digest"),i=r[0],a=r[1],o=r.slice(2),u=this.prepareAlgorithm(i),c=s.toArrayBuffer(a),l=this.getProvider(u.name),e.next=8,l.digest.apply(l,[u,c].concat(_toConsumableArray(o)));case 8:return h=e.sent,e.abrupt("return",h);case 10:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"generateKey",value:(y=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,s,u,c,l,h=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=h.length,r=new Array(t),n=0;n<t;n++)r[n]=h[n];return this.checkRequiredArguments(r,3,"generateKey"),i=r[0],a=r[1],o=r[2],s=r.slice(3),u=this.prepareAlgorithm(i),c=this.getProvider(u.name),e.next=7,c.generateKey.apply(c,[_objectSpread(_objectSpread({},u),{},{name:c.name}),a,o].concat(_toConsumableArray(s)));case 7:return l=e.sent,e.abrupt("return",l);case 9:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"sign",value:(f=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,c,l,h,p,f=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=f.length,r=new Array(t),n=0;n<t;n++)r[n]=f[n];return this.checkRequiredArguments(r,3,"sign"),i=r[0],a=r[1],o=r[2],u=r.slice(3),this.checkCryptoKey(a),c=this.prepareAlgorithm(i),l=s.toArrayBuffer(o),h=this.getProvider(c.name),e.next=9,h.sign.apply(h,[_objectSpread(_objectSpread({},c),{},{name:h.name}),a,l].concat(_toConsumableArray(u)));case 9:return p=e.sent,e.abrupt("return",p);case 11:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"verify",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,c,l,h,p,f,y,v=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=v.length,r=new Array(t),n=0;n<t;n++)r[n]=v[n];return this.checkRequiredArguments(r,4,"verify"),i=r[0],a=r[1],o=r[2],u=r[3],c=r.slice(4),this.checkCryptoKey(a),l=this.prepareAlgorithm(i),h=s.toArrayBuffer(u),p=s.toArrayBuffer(o),f=this.getProvider(l.name),e.next=10,f.verify.apply(f,[_objectSpread(_objectSpread({},l),{},{name:f.name}),a,p,h].concat(_toConsumableArray(c)));case 10:return y=e.sent,e.abrupt("return",y);case 12:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"encrypt",value:(h=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,c,l,h,p,f=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=f.length,r=new Array(t),n=0;n<t;n++)r[n]=f[n];return this.checkRequiredArguments(r,3,"encrypt"),i=r[0],a=r[1],o=r[2],u=r.slice(3),this.checkCryptoKey(a),c=this.prepareAlgorithm(i),l=s.toArrayBuffer(o),h=this.getProvider(c.name),e.next=9,h.encrypt.apply(h,[_objectSpread(_objectSpread({},c),{},{name:h.name}),a,l,{keyUsage:!0}].concat(_toConsumableArray(u)));case 9:return p=e.sent,e.abrupt("return",p);case 11:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"decrypt",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,c,l,h,p,f=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=f.length,r=new Array(t),n=0;n<t;n++)r[n]=f[n];return this.checkRequiredArguments(r,3,"decrypt"),i=r[0],a=r[1],o=r[2],u=r.slice(3),this.checkCryptoKey(a),c=this.prepareAlgorithm(i),l=s.toArrayBuffer(o),h=this.getProvider(c.name),e.next=9,h.decrypt.apply(h,[_objectSpread(_objectSpread({},c),{},{name:h.name}),a,l,{keyUsage:!0}].concat(_toConsumableArray(u)));case 9:return p=e.sent,e.abrupt("return",p);case 11:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"deriveBits",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,s,u,c,l,h=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=h.length,r=new Array(t),n=0;n<t;n++)r[n]=h[n];return this.checkRequiredArguments(r,3,"deriveBits"),i=r[0],a=r[1],o=r[2],s=r.slice(3),this.checkCryptoKey(a),u=this.prepareAlgorithm(i),c=this.getProvider(u.name),e.next=8,c.deriveBits.apply(c,[_objectSpread(_objectSpread({},u),{},{name:c.name}),a,o,{keyUsage:!0}].concat(_toConsumableArray(s)));case 8:return l=e.sent,e.abrupt("return",l);case 10:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"deriveKey",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,s,u,c,l,h,p,f,y=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=y.length,r=new Array(t),n=0;n<t;n++)r[n]=y[n];return this.checkRequiredArguments(r,5,"deriveKey"),i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],c=r.slice(5),l=this.prepareAlgorithm(o),this.getProvider(l.name).checkDerivedKeyParams(l),h=this.prepareAlgorithm(i),(p=this.getProvider(h.name)).checkCryptoKey(a,"deriveKey"),e.next=11,p.deriveBits.apply(p,[_objectSpread(_objectSpread({},h),{},{name:p.name}),a,o.length||512,{keyUsage:!1}].concat(_toConsumableArray(c)));case 11:return f=e.sent,e.abrupt("return",this.importKey.apply(this,["raw",f,o,s,u].concat(_toConsumableArray(c))));case 13:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"exportKey",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,s,u,c=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=c.length,r=new Array(t),n=0;n<t;n++)r[n]=c[n];return this.checkRequiredArguments(r,2,"exportKey"),i=r[0],a=r[1],o=r.slice(2),this.checkCryptoKey(a),s=this.getProvider(a.algorithm.name),e.next=7,s.exportKey.apply(s,[i,a].concat(_toConsumableArray(o)));case 7:return u=e.sent,e.abrupt("return",u);case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"importKey",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,c,l,h,p,f,y=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=y.length,r=new Array(t),n=0;n<t;n++)r[n]=y[n];if(this.checkRequiredArguments(r,5,"importKey"),i=r[0],a=r[1],o=r[2],u=r[3],c=r[4],l=r.slice(5),h=this.prepareAlgorithm(o),p=this.getProvider(h.name),-1===["pkcs8","spki","raw"].indexOf(i)){e.next=10;break}return f=s.toArrayBuffer(a),e.abrupt("return",p.importKey.apply(p,[i,f,_objectSpread(_objectSpread({},h),{},{name:p.name}),u,c].concat(_toConsumableArray(l))));case 10:if(a.kty){e.next=12;break}throw new TypeError("keyData: Is not JSON");case 12:return e.abrupt("return",p.importKey.apply(p,[i,a,_objectSpread(_objectSpread({},h),{},{name:p.name}),u,c].concat(_toConsumableArray(l))));case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"wrapKey",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i){var a,o,u,c,h,p,f,y,v=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=v.length,o=new Array(a>4?a-4:0),u=4;u<a;u++)o[u-4]=v[u];return e.next=3,this.exportKey.apply(this,[t,r].concat(o));case 3:return c=e.sent,"jwk"===t&&(h=JSON.stringify(c),c=l.FromUtf8String(h)),p=this.prepareAlgorithm(i),f=s.toArrayBuffer(c),y=this.getProvider(p.name),e.abrupt("return",y.encrypt.apply(y,[_objectSpread(_objectSpread({},p),{},{name:y.name}),n,f,{keyUsage:!1}].concat(o)));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"unwrapKey",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,a,o,u){var c,h,p,f,y,v,d,g,m=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(c=this.prepareAlgorithm(i),h=s.toArrayBuffer(r),p=this.getProvider(c.name),f=m.length,y=new Array(f>7?f-7:0),v=7;v<f;v++)y[v-7]=m[v];return e.next=6,p.decrypt.apply(p,[_objectSpread(_objectSpread({},c),{},{name:p.name}),n,h,{keyUsage:!1}].concat(y));case 6:if(d=e.sent,"jwk"!==t){e.next=17;break}e.prev=8,d=JSON.parse(l.ToUtf8String(d)),e.next=17;break;case 12:throw e.prev=12,e.t0=e.catch(8),(g=new TypeError("wrappedKey: Is not a JSON")).internal=e.t0,g;case 17:return e.abrupt("return",this.importKey.apply(this,[t,d,a,o,u].concat(y)));case 18:case"end":return e.stop()}}),e,this,[[8,12]])}))),function(e,t,n,i,a,o,s){return r.apply(this,arguments)})},{key:"checkRequiredArguments",value:function(e,t,r){if(e.length<t)throw new TypeError("Failed to execute '".concat(r,"' on 'SubtleCrypto': ").concat(t," arguments required, but only ").concat(e.length," present"))}},{key:"prepareAlgorithm",value:function(e){if("string"==typeof e)return{name:e};if(t.isHashedAlgorithm(e)){var r=_objectSpread({},e);return r.hash=this.prepareAlgorithm(e.hash),r}return _objectSpread({},e)}},{key:"getProvider",value:function(e){var t=this.providers.get(e);if(!t)throw new za("Unrecognized name");return t}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof Za))throw new TypeError("Key is not of type 'CryptoKey'")}}],[{key:"isHashedAlgorithm",value:function(e){return!!(e&&"object"===_typeof(e)&&"name"in e&&"hash"in e)}}]),t}();function Go(e){if(e instanceof Ee)return e;var t,r=new Ee;if("string"==typeof e)r.fromAlgorithm({name:e});else if((t=e)instanceof Object&&"name"in t&&"hash"in t){var n=_objectSpread({},e);n.hash=Go(e.hash),r.fromAlgorithm(n)}else r.fromAlgorithm(_objectSpread({},e));return r}function Vo(e,t){if(!e||"object"!==_typeof(e)&&"string"!=typeof e)throw new TypeError("".concat(t,": Is wrong type. Must be Object or String"));if("object"===_typeof(e)&&!("name"in e))throw new TypeError("".concat(t,": Required property 'name' is missed"))}function Mo(e,t){if(!function(e){return e instanceof Ie}(e))throw new TypeError("".concat(t,": Is not type CryptoKey"))}function qo(e,t){if(!function(e){return e instanceof ct}(e))throw new TypeError("".concat(t,": Is not type CryptoCertificate"))}function Fo(e,t){if(!s.isBufferSource(e))throw new TypeError("".concat(t,": Is wrong type. Must be ArrayBuffer or ArrayBuffer view"))}function Jo(e,t){if(!Array.isArray(e))throw new TypeError("".concat(t,": Is not type Array"))}function zo(e,t,r){if(_typeof(e)!==t)throw new TypeError("".concat(r,": Is not type '").concat(t,"'"))}Object.freeze({__proto__:null,converters:io});var Wo=["raw","pem","x509","request"],Yo=function(){function e(t){_classCallCheck(this,e),this.provider=t}var t,r,n,i,a,o,u,c,h,p,f,y,v,d,g;return _createClass(e,[{key:"indexOf",value:(g=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return qo(t,"item"),(r=new bt).providerID=this.provider.id,r.item=t,e.next=6,this.provider.client.send(r);case 6:return n=e.sent,e.abrupt("return",n?l.ToUtf8String(n):null);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"hasItem",value:(d=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.indexOf(t);case 2:return r=e.sent,e.abrupt("return",!!r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"exportCert",value:(v=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,a,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zo(t,"string","format"),qo(r,"item"),(n=new wt).providerID=this.provider.id,n.format="raw",n.item=r,e.next=8,this.provider.client.send(n);case 8:if(i=e.sent,"raw"!==t){e.next=13;break}return e.abrupt("return",i);case 13:a="",e.t0=r.type,e.next="x509"===e.t0?17:"request"===e.t0?19:21;break;case 17:return a="CERTIFICATE",e.abrupt("break",22);case 19:return a="CERTIFICATE REQUEST",e.abrupt("break",22);case 21:throw new Error("Cannot create PEM for unknown type of certificate item");case 22:return o=Wa.fromBufferSource(i,a),e.abrupt("return",o);case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"importCert",value:(y=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i){var a,o,u,c,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(zo(t,"string","format"),~Wo.indexOf(t)){e.next=3;break}throw new TypeError("format: Is invalid value. Must be ".concat(Wo.join(", ")));case 3:if("pem"===t?zo(r,"string","data"):Fo(r,"data"),Vo(n,"algorithm"),Jo(i,"keyUsages"),a=Go(n),!s.isBufferSource(r)){e.next=11;break}o=s.toArrayBuffer(r),e.next=16;break;case 11:if("string"!=typeof r){e.next=15;break}o=Wa.toArrayBuffer(r),e.next=16;break;case 15:throw new TypeError("data: Is not type String, ArrayBuffer or ArrayBufferView");case 16:return(u=new kt).providerID=this.provider.id,u.format="raw",u.data=o,u.algorithm=a,u.keyUsages=i,e.next=24,this.provider.client.send(u);case 24:return c=e.sent,e.next=27,ct.importProto(c);case 27:if(l=e.sent,"request"!==t&&"x509"!==t||l.type===t){e.next=30;break}throw new TypeError("Imported item is not ".concat(t));case 30:return e.abrupt("return",this.prepareCertItem(l));case 31:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return y.apply(this,arguments)})},{key:"keys",value:(f=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new dt).providerID=this.provider.id,e.next=4,this.provider.client.send(t);case 4:if(!(r=e.sent)){e.next=8;break}return n=l.ToUtf8String(r).split(","),e.abrupt("return",n);case 8:return e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"getValue",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zo(t,"string","key"),(r=new gt).providerID=this.provider.id,r.key=t,e.next=6,this.provider.client.send(r);case 6:if(!(n=e.sent)){e.next=9;break}return e.abrupt("return",n);case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"getItem",value:(h=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,a,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zo(t,"string","key"),r&&(Vo(r,"algorithm"),Jo(n,"keyUsages")),(i=new vt).providerID=this.provider.id,i.key=t,r&&(i.algorithm=Go(r),i.keyUsages=n),e.next=8,this.provider.client.send(i);case 8:if(!(a=e.sent)||!a.byteLength){e.next=14;break}return e.next=12,ct.importProto(a);case 12:return o=e.sent,e.abrupt("return",this.prepareCertItem(o));case 14:throw new Error("Cannot get CryptoCertificate from storage by index");case 15:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return h.apply(this,arguments)})},{key:"setItem",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return qo(t,"value"),(r=new yt).providerID=this.provider.id,r.item=t,e.next=6,this.provider.client.send(r);case 6:return n=e.sent,e.abrupt("return",l.ToUtf8String(n));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"removeItem",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zo(t,"string","key"),(r=new mt).providerID=this.provider.id,r.key=t,e.next=6,this.provider.client.send(r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"clear",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new _t).providerID=this.provider.id,e.next=4,this.provider.client.send(t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"getChain",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return qo(t,"value"),(r=new Ct).providerID=this.provider.id,r.item=t,e.next=6,this.provider.client.send(r);case 6:return n=e.sent,e.next=9,ft.importProto(n);case 9:return i=e.sent,e.abrupt("return",i.items);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getCRL",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zo(t,"string","url"),(r=new xt).providerID=this.provider.id,r.url=t,e.next=6,this.provider.client.send(r);case 6:return n=e.sent,e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getOCSP",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,a,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(zo(t,"string","url"),Fo(r,"request"),(i=new Bt).providerID=this.provider.id,i.url=t,i.request=s.toArrayBuffer(r),n)for(a in n)i.options[a]=n[a];return e.next=9,this.provider.client.send(i);case 9:return o=e.sent,e.abrupt("return",o);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"findPrivateKey",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,a,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=4;break}e.t0=t,e.next=7;break;case 4:return e.next=6,this.provider.certStorage.indexOf(t);case 6:e.t0=e.sent;case 7:return(r=e.t0)||(r=""),n=r.split("-"),i=_slicedToArray(n,3),a=i[2],e.next=12,this.provider.keyStorage.keys();case 12:if(o=e.sent.find((function(e){var t=_slicedToArray(e.split("-"),3),r=t[0],n=t[2];return"private"===r&&n===a}))){e.next=15;break}return e.abrupt("return",null);case 15:return e.next=17,this.provider.keyStorage.getItem(o);case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"prepareCertItem",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.exportProto();case 2:r=e.sent,e.t0=t.type,e.next="x509"===e.t0?6:"request"===e.t0?10:14;break;case 6:return e.next=8,lt.importProto(r);case 8:case 12:return n=e.sent,e.abrupt("break",15);case 10:return e.next=12,ht.importProto(r);case 14:throw new Error("Unsupported CertificateItem type '".concat(t.type,"'"));case 15:return n.provider=this.provider,e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"isX509Certificate",value:function(e){return e instanceof lt}},{key:"isCertificateRequest",value:function(e){return e instanceof ht}}]),e}(),Zo=function(){function e(t){_classCallCheck(this,e),this.service=t}var t,r,n,i,a,o,s;return _createClass(e,[{key:"keys",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new Dt).providerID=this.service.id,e.next=4,this.service.client.send(t);case 4:if(!(r=e.sent)){e.next=8;break}return n=l.ToUtf8String(r).split(","),e.abrupt("return",n);case 8:return e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"indexOf",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Mo(t,"item"),(r=new Gt).providerID=this.service.id,r.item=t,e.next=6,this.service.client.send(r);case 6:return n=e.sent,e.abrupt("return",n?l.ToUtf8String(n):null);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"hasItem",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.indexOf(t);case 2:return r=e.sent,e.abrupt("return",!!r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getItem",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i){var a,o,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zo(t,"string","key"),r&&(Vo(r,"algorithm"),zo(n,"boolean","extractable"),Jo(i,"usages")),(a=new Tt).providerID=this.service.id,a.key=t,r&&(a.algorithm=Go(r),a.extractable=n,a.keyUsages=i),e.next=8,this.service.client.send(a);case 8:if(!(o=e.sent)||!o.byteLength){e.next=15;break}return e.next=12,Ie.importProto(o);case 12:s=e.sent,e.next=16;break;case 15:throw new Error("Cannot get CryptoKey from key storage by index");case 16:return e.abrupt("return",s);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return i.apply(this,arguments)})},{key:"setItem",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Mo(t,"value"),(r=new Rt).providerID=this.service.id,r.item=t,e.next=6,this.service.client.send(r);case 6:return n=e.sent,e.abrupt("return",l.ToUtf8String(n));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"removeItem",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zo(t,"string","key"),(r=new Ot).providerID=this.service.id,r.key=t,e.next=6,this.service.client.send(r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"clear",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new Kt).providerID=this.service.id,e.next=4,this.service.client.send(t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),$o=function(e){_inherits(g,e);var t,r,n,i,a,o,u,c,h,p,f,y,v,d=_createSuper(g);function g(e){var t;return _classCallCheck(this,g),(t=d.call(this)).service=e,t}return _createClass(g,[{key:"encrypt",value:(v=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.encryptData(t,r,n,"encrypt"));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return v.apply(this,arguments)})},{key:"decrypt",value:(y=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.encryptData(t,r,n,"decrypt"));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return y.apply(this,arguments)})},{key:"deriveBits",value:(f=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,a,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Vo(t,"algorithm"),Mo(r,"baseKey"),zo(n,"number","length"),Mo((i=Go(t)).public,"algorithm.public"),e.next=7,i.public.exportProto();case 7:return i.public=e.sent,(a=new fr).providerID=this.service.id,a.algorithm=i,a.key=r,a.length=n,e.next=15,this.service.client.send(a);case 15:return o=e.sent,e.abrupt("return",o);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return f.apply(this,arguments)})},{key:"deriveKey",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,a){var o,s,u,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Vo(t,"algorithm"),Mo(r,"baseKey"),Vo(n,"algorithm"),zo(i,"boolean","extractable"),Jo(a,"keyUsages"),Mo((o=Go(t)).public,"algorithm.public"),e.next=9,o.public.exportProto();case 9:return o.public=e.sent,s=Go(n),(u=new yr).providerID=this.service.id,u.algorithm=o,u.derivedKeyType.fromAlgorithm(s),u.key=r,u.extractable=i,u.usage=a,e.next=20,this.service.client.send(u);case 20:return c=e.sent,e.next=23,Ie.importProto(c);case 23:return e.abrupt("return",e.sent);case 24:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,i){return p.apply(this,arguments)})},{key:"digest",value:(h=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D().crypto.subtle.digest(t,r));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return h.apply(this,arguments)})},{key:"generateKey",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,a,o,s,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Vo(t,"algorithm"),zo(r,"boolean","extractable"),Jo(n,"keyUsages"),i=Go(t),(a=new ur).providerID=this.service.id,a.algorithm=i,a.extractable=r,a.usage=n,e.next=11,this.service.client.send(a);case 11:return o=e.sent,e.prev=12,e.next=15,Be.importProto(o);case 15:return s=e.sent,e.abrupt("return",s);case 19:return e.prev=19,e.t0=e.catch(12),e.next=23,Ie.importProto(o);case 23:return u=e.sent,e.abrupt("return",u);case 25:case"end":return e.stop()}}),e,this,[[12,19]])}))),function(e,t,r){return c.apply(this,arguments)})},{key:"exportKey",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zo(t,"string","format"),Mo(r,"key"),(n=new gr).providerID=this.service.id,n.format=t,n.key=r,e.next=8,this.service.client.send(n);case 8:if(i=e.sent,"jwk"!==t){e.next=13;break}return e.abrupt("return",JSON.parse(l.ToBinary(i)));case 13:return e.abrupt("return",i);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"importKey",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,a){var o,u,c,h;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zo(t,"string","format"),Vo(n,"algorithm"),zo(i,"boolean","extractable"),Jo(a,"keyUsages"),o=Go(n),"jwk"===t?u=l.FromUtf8String(JSON.stringify(r)):(Fo(r,"keyData"),u=s.toArrayBuffer(r)),(c=new mr).providerID=this.service.id,c.algorithm=o,c.keyData=u,c.format=t,c.extractable=i,c.keyUsages=a,e.next=15,this.service.client.send(c);case 15:return h=e.sent,e.next=18,Ie.importProto(h);case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,i){return o.apply(this,arguments)})},{key:"sign",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,a,o,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Vo(t,"algorithm"),Mo(r,"key"),Fo(n,"data"),i=Go(t),a=s.toArrayBuffer(n),(o=new cr).providerID=this.service.id,o.algorithm=i,o.key=r,o.data=a,e.next=12,this.service.client.send(o);case 12:return u=e.sent,e.abrupt("return",u);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return a.apply(this,arguments)})},{key:"verify",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i){var a,o,u,c,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Vo(t,"algorithm"),Mo(r,"key"),Fo(n,"signature"),Fo(i,"data"),a=Go(t),o=s.toArrayBuffer(n),u=s.toArrayBuffer(i),(c=new lr).providerID=this.service.id,c.algorithm=a,c.key=r,c.data=u,c.signature=o,e.next=15,this.service.client.send(c);case 15:return l=e.sent,e.abrupt("return",!!new Uint8Array(l)[0]);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return i.apply(this,arguments)})},{key:"wrapKey",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i){var a,o,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zo(t,"string","format"),Mo(r,"key"),Mo(n,"wrappingKey"),Vo(i,"wrapAlgorithm"),a=Go(i),(o=new dr).providerID=this.service.id,o.wrapAlgorithm=a,o.key=r,o.wrappingKey=n,o.format=t,e.next=13,this.service.client.send(o);case 13:return s=e.sent,e.abrupt("return",s);case 15:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"unwrapKey",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,a,o,u){var c,l,h,p,f;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zo(t,"string","format"),Fo(r,"wrappedKey"),Mo(n,"unwrappingKey"),Vo(i,"unwrapAlgorithm"),Vo(a,"unwrappedKeyAlgorithm"),zo(o,"boolean","extractable"),Jo(u,"keyUsages"),c=Go(i),l=Go(a),h=s.toArrayBuffer(r),(p=new vr).providerID=this.service.id,p.format=t,p.unwrapAlgorithm=c,p.unwrappedKeyAlgorithm=l,p.unwrappingKey=n,p.wrappedKey=h,p.extractable=o,p.keyUsage=u,e.next=21,this.service.client.send(p);case 21:return f=e.sent,e.next=24,Ie.importProto(f);case 24:return e.abrupt("return",e.sent);case 25:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i,a,o,s){return r.apply(this,arguments)})},{key:"encryptData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i){var a,o,u,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Vo(t,"algorithm"),Mo(r,"key"),Fo(n,"data"),a=Go(t),o=s.toArrayBuffer(n),(u=new("encrypt"===i?hr:pr)).providerID=this.service.id,u.algorithm=a,u.key=r,u.data=o,e.next=13,this.service.client.send(u);case 13:return c=e.sent,e.abrupt("return",c);case 15:case"end":return e.stop()}}),e,this)}))),function(e,r,n,i){return t.apply(this,arguments)})}]),g}(Ho),Qo=function(e){_inherits(o,e);var t,r,n,i,a=_createSuper(o);function o(e,t){var r;return _classCallCheck(this,o),(r=a.call(this)).client=e,r.id=t,r.subtle=new $o(_assertThisInitialized(r)),r.keyStorage=new Zo(_assertThisInitialized(r)),r.certStorage=new Yo(_assertThisInitialized(r)),r}return _createClass(o,[{key:"getRandomValues",value:function(e){return D().crypto.getRandomValues(e)}},{key:"login",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new Me).providerID=this.id,e.abrupt("return",this.client.send(t));case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"logout",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new qe).providerID=this.id,e.abrupt("return",this.client.send(t));case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"reset",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new ut).providerID=this.id,e.abrupt("return",this.client.send(t));case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"isLoggedIn",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new Fe).providerID=this.id,e.next=4,this.client.send(t);case 4:return r=e.sent,e.abrupt("return",!!new Uint8Array(r)[0]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),o}(Lo),es=function(e){_inherits(s,e);var t,r,n,i,a,o=_createSuper(s);function s(e){var t;return _classCallCheck(this,s),(t=o.call(this)).client=new Lr(e.storage),t.cardReader=new _r(t.client),t}return _createClass(s,[{key:"state",get:function(){return this.client.state}},{key:"connect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.FORTIFY,r=arguments.length>1?arguments[1]:void 0;return this.removeAllListeners(),this.client.connect(t,r).on("error",(function(t){e.emit("error",t.error)})).on("event",(function(t){_asyncToGenerator(_regeneratorRuntime().mark((function r(){var n,i;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=t.action,r.next=r.t0===or.ACTION?3:r.t0===Wt.ACTION?11:19;break;case 3:return r.t1=or,r.next=6,t.exportProto();case 6:return r.t2=r.sent,r.next=9,r.t1.importProto.call(r.t1,r.t2);case 9:n=r.sent,e.emit("token",n);case 11:return r.t3=Wt,r.next=14,t.exportProto();case 14:return r.t4=r.sent,r.next=17,r.t3.importProto.call(r.t3,r.t4);case 17:i=r.sent,e.emit("auth",i);case 19:case"end":return r.stop()}}),r)})))()})).on("listening",(function(r){e.emit("listening",t)})).on("close",(function(t){e.emit("close",t.remoteAddress)})),this}},{key:"close",value:function(){this.client.close()}},{key:"on",value:function(e,t){return _get5(_getPrototypeOf(s.prototype),"on",this).call(this,e,t)}},{key:"once",value:function(e,t){return _get5(_getPrototypeOf(s.prototype),"once",this).call(this,e,t)}},{key:"info",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Jt,e.next=3,this.client.send(t);case 3:return r=e.sent,e.next=6,Ft.importProto(r);case 6:return n=e.sent,e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"challenge",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.challenge());case 1:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"isLoggedIn",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.isLoggedIn());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"login",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.login());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getCrypto",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new zt).cryptoID=t,e.next=4,this.client.send(r);case 4:return e.abrupt("return",new Qo(this.client,t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),s}(k);es.FORTIFY="127.0.0.1:31337";var ts=_createClass((function e(){_classCallCheck(this,e)}));function rs(e,t){return e(t={exports:{}},t.exports),t.exports}var ns=rs((function(e){!function(){function t(e){return new Promise((function(t,r){e.onsuccess=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function r(e,r,n){var i,a=new Promise((function(a,o){t(i=e[r].apply(e,n)).then(a,o)}));return a.request=i,a}function n(e,t,n){var i=r(e,t,n);return i.then((function(e){if(e)return new c(e,i.request)}))}function i(e,t,r){r.forEach((function(r){Object.defineProperty(e.prototype,r,{get:function(){return this[t][r]},set:function(e){this[t][r]=e}})}))}function a(e,t,n,i){i.forEach((function(i){i in n.prototype&&(e.prototype[i]=function(){return r(this[t],i,arguments)})}))}function o(e,t,r,n){n.forEach((function(n){n in r.prototype&&(e.prototype[n]=function(){return this[t][n].apply(this[t],arguments)})}))}function s(e,t,r,i){i.forEach((function(i){i in r.prototype&&(e.prototype[i]=function(){return n(this[t],i,arguments)})}))}function u(e){this._index=e}function c(e,t){this._cursor=e,this._request=t}function l(e){this._store=e}function h(e){this._tx=e,this.complete=new Promise((function(t,r){e.oncomplete=function(){t()},e.onerror=function(){r(e.error)},e.onabort=function(){r(e.error)}}))}function p(e,t,r){this._db=e,this.oldVersion=t,this.transaction=new h(r)}function f(e){this._db=e}i(u,"_index",["name","keyPath","multiEntry","unique"]),a(u,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),s(u,"_index",IDBIndex,["openCursor","openKeyCursor"]),i(c,"_cursor",["direction","key","primaryKey","value"]),a(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(e){e in IDBCursor.prototype&&(c.prototype[e]=function(){var r=this,n=arguments;return Promise.resolve().then((function(){return r._cursor[e].apply(r._cursor,n),t(r._request).then((function(e){if(e)return new c(e,r._request)}))}))})})),l.prototype.createIndex=function(){return new u(this._store.createIndex.apply(this._store,arguments))},l.prototype.index=function(){return new u(this._store.index.apply(this._store,arguments))},i(l,"_store",["name","keyPath","indexNames","autoIncrement"]),a(l,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),s(l,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(l,"_store",IDBObjectStore,["deleteIndex"]),h.prototype.objectStore=function(){return new l(this._tx.objectStore.apply(this._tx,arguments))},i(h,"_tx",["objectStoreNames","mode"]),o(h,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new l(this._db.createObjectStore.apply(this._db,arguments))},i(p,"_db",["name","version","objectStoreNames"]),o(p,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new h(this._db.transaction.apply(this._db,arguments))},i(f,"_db",["name","version","objectStoreNames"]),o(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(e){[l,u].forEach((function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t=function(e){return Array.prototype.slice.call(e)}(arguments),r=t[t.length-1],n=this._store||this._index,i=n[e].apply(n,t.slice(0,-1));i.onsuccess=function(){r(i.result)}})}))})),[u,l].forEach((function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var r=this,n=[];return new Promise((function(i){r.iterateCursor(e,(function(e){e?(n.push(e.value),void 0===t||n.length!=t?e.continue():i(n)):i(n)}))}))})}));var y={open:function(e,t,n){var i=r(indexedDB,"open",[e,t]),a=i.request;return a&&(a.onupgradeneeded=function(e){n&&n(new p(a.result,e.oldVersion,a.transaction))}),i.then((function(e){return new f(e)}))},delete:function(e){return r(indexedDB,"deleteDatabase",[e])}};e.exports=y,e.exports.default=e.exports}()})),is=rs((function(e){"undefined"!=typeof indexedDB?e.exports=ns:e.exports={open:function(){return Promise.reject("IDB requires a browser environment")},delete:function(){return Promise.reject("IDB requires a browser environment")}}}));is.open;var as=function(e){_inherits(h,e);var t,r,n,i,a,o,s,u,c,l=_createSuper(h);function h(e){var t;return _classCallCheck(this,h),(t=l.call(this)).db=e,t}return _createClass(h,[{key:"loadWrapKey",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.transaction(h.IDENTITY_STORAGE).objectStore(h.IDENTITY_STORAGE).get(h.WRAP_KEY);case 2:if(!(t=e.sent)){e.next=11;break}if(Or.iv=t.iv,!(t.key instanceof ArrayBuffer)){e.next=10;break}return e.next=8,D().crypto.subtle.importKey("raw",t.key,{name:Or.name,length:256},!0,["encrypt","decrypt","wrapKey","unwrapKey"]);case 8:return r=e.sent,e.abrupt("return",{key:r,iv:t.iv});case 10:return e.abrupt("return",{key:t.key,iv:t.iv});case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"saveWrapKey",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ir()&&!Br()){e.next=7;break}return e.next=3,D().crypto.subtle.exportKey("raw",t.key);case 3:n=e.sent,r={key:n,iv:t.iv},e.next=8;break;case 7:r=_objectSpread({},t);case 8:return e.next=10,this.db.transaction(h.IDENTITY_STORAGE,"readwrite").objectStore(h.IDENTITY_STORAGE).put(r,h.WRAP_KEY);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"loadIdentity",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.transaction(h.IDENTITY_STORAGE).objectStore(h.IDENTITY_STORAGE).get(h.IDENTITY);case 2:if(t=e.sent,r=null,!t){e.next=26;break}if(!(Nr()||Ir()||Br())){e.next=23;break}return e.next=8,this.loadWrapKey();case 8:if((n=e.sent)&&n.key.usages.some((function(e){return"encrypt"===e}))&&t.exchangeKey.privateKey instanceof ArrayBuffer){e.next=11;break}return e.abrupt("return",null);case 11:return e.next=13,D().crypto.subtle.unwrapKey("jwk",t.exchangeKey.privateKey,n.key,Or,Tr,!1,["deriveKey","deriveBits"]);case 13:return t.exchangeKey.privateKey=e.sent,e.next=16,D().crypto.subtle.unwrapKey("jwk",t.signingKey.privateKey,n.key,Or,Dr,!1,["sign"]);case 16:return t.signingKey.privateKey=e.sent,e.next=19,D().crypto.subtle.unwrapKey("jwk",t.exchangeKey.publicKey,n.key,Or,Tr,!0,[]);case 19:return t.exchangeKey.publicKey=e.sent,e.next=22,D().crypto.subtle.unwrapKey("jwk",t.signingKey.publicKey,n.key,Or,Dr,!0,["verify"]);case 22:t.signingKey.publicKey=e.sent;case 23:return e.next=25,X.fromJSON(t);case 25:r=e.sent;case 26:return e.abrupt("return",r);case 27:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"saveIdentity",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Nr()||Ir()||Br())){e.next=20;break}return e.next=3,D().crypto.subtle.generateKey({name:Or.name,length:256},Ir()||Br(),["wrapKey","unwrapKey","encrypt","decrypt"]);case 3:return e.t0=e.sent,e.t1=D().crypto.getRandomValues(new Uint8Array(Or.iv)).buffer,r={key:e.t0,iv:e.t1},e.next=8,this.saveWrapKey(r);case 8:return e.next=10,D().crypto.subtle.generateKey(t.exchangeKey.privateKey.algorithm,!0,["deriveKey","deriveBits"]);case 10:return n=e.sent,t.exchangeKey.privateKey=n.privateKey,e.next=14,Pr(t.exchangeKey.publicKey,n.publicKey);case 14:return e.next=16,D().crypto.subtle.generateKey(t.signingKey.privateKey.algorithm,!0,["sign","verify"]);case 16:return i=e.sent,t.signingKey.privateKey=i.privateKey,e.next=20,Pr(t.signingKey.publicKey,i.publicKey);case 20:return e.next=22,t.toJSON();case 22:if(a=e.sent,!r){e.next=36;break}return e.next=26,D().crypto.subtle.wrapKey("jwk",t.exchangeKey.privateKey,r.key,Or);case 26:return a.exchangeKey.privateKey=e.sent,e.next=29,D().crypto.subtle.wrapKey("jwk",t.signingKey.privateKey,r.key,Or);case 29:return a.signingKey.privateKey=e.sent,e.next=32,D().crypto.subtle.wrapKey("jwk",t.exchangeKey.publicKey.key,r.key,Or);case 32:return a.exchangeKey.publicKey=e.sent,e.next=35,D().crypto.subtle.wrapKey("jwk",t.signingKey.publicKey.key,r.key,Or);case 35:a.signingKey.publicKey=e.sent;case 36:return e.next=38,this.db.transaction(h.IDENTITY_STORAGE,"readwrite").objectStore(h.IDENTITY_STORAGE).put(a,h.IDENTITY);case 38:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"loadRemoteIdentity",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.transaction(h.REMOTE_STORAGE).objectStore(h.REMOTE_STORAGE).get(t);case 2:if(r=e.sent,n=null,!r){e.next=18;break}return e.next=7,this.loadWrapKey();case 7:if(!(i=e.sent)){e.next=15;break}return e.next=11,D().crypto.subtle.unwrapKey("jwk",r.exchangeKey,i.key,Or,Tr,!0,[]);case 11:return r.exchangeKey=e.sent,e.next=14,D().crypto.subtle.unwrapKey("jwk",r.signingKey,i.key,Or,Dr,!0,["verify"]);case 14:r.signingKey=e.sent;case 15:return e.next=17,L.fromJSON(r);case 17:n=e.sent;case 18:return e.abrupt("return",n);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"saveRemoteIdentity",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.toJSON();case 2:return n=e.sent,e.next=5,this.loadWrapKey();case 5:if(!(i=e.sent)){e.next=13;break}return e.next=9,D().crypto.subtle.wrapKey("jwk",n.exchangeKey,i.key,Or);case 9:return n.exchangeKey=e.sent,e.next=12,D().crypto.subtle.wrapKey("jwk",n.signingKey,i.key,Or);case 12:n.signingKey=e.sent;case 13:return e.next=15,this.db.transaction(h.REMOTE_STORAGE,"readwrite").objectStore(h.REMOTE_STORAGE).put(n,t);case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"loadSession",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.transaction(h.SESSION_STORAGE).objectStore(h.SESSION_STORAGE).get(t);case 2:if(r=e.sent,n=null,!r){e.next=18;break}return e.next=7,this.loadIdentity();case 7:if(i=e.sent){e.next=10;break}throw new Error("Identity is empty");case 10:return e.next=12,this.loadRemoteIdentity(t);case 12:if(a=e.sent){e.next=15;break}throw new Error("Remote identity is not found");case 15:return e.next=17,se.fromJSON(i,a,r);case 17:n=e.sent;case 18:return e.abrupt("return",n);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"saveSession",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.toJSON();case 2:return n=e.sent,e.next=5,this.db.transaction(h.SESSION_STORAGE,"readwrite").objectStore(h.SESSION_STORAGE).put(n,t);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})}],[{key:"create",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,is.open(this.STORAGE_NAME,2,(function(e){1===e.oldVersion&&(e.deleteObjectStore(r.SESSION_STORAGE),e.deleteObjectStore(r.IDENTITY_STORAGE),e.deleteObjectStore(r.REMOTE_STORAGE)),e.createObjectStore(r.SESSION_STORAGE),e.createObjectStore(r.IDENTITY_STORAGE),e.createObjectStore(r.REMOTE_STORAGE)}));case 2:return t=e.sent,e.abrupt("return",new h(t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),h}(ts);as.STORAGE_NAME="webcrypto-remote",as.IDENTITY_STORAGE="identity",as.SESSION_STORAGE="sessions",as.REMOTE_STORAGE="remoteIdentity",as.WRAP_KEY="wkey",as.IDENTITY="identity";var os=function(e){_inherits(u,e);var t,r,n,i,a,o,s=_createSuper(u);function u(){var e;return _classCallCheck(this,u),(e=s.apply(this,arguments)).remoteIdentities={},e.sessions={},e}return _createClass(u,[{key:"loadIdentity",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.identity||null);case 1:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"saveIdentity",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.identity=t;case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"loadRemoteIdentity",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.remoteIdentities[t]||null);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"saveRemoteIdentity",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.remoteIdentities[t]=r;case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"loadSession",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sessions[t]||null);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"saveSession",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sessions[t]=r;case 1:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),u}(ts);return e.BrowserStorage=as,e.CertificateStorage=Yo,e.CryptoServerError=Cr,e.KeyStorage=Zo,e.MemoryStorage=os,e.RatchetStorage=ts,e.SocketCrypto=Qo,e.SocketProvider=es,e.getEngine=D,e.setEngine=function(e,t){T={crypto:t,name:e}},Object.defineProperty(e,"__esModule",{value:!0}),e}({},protobuf,fetch.bind(self),WebSocket);